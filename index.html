<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blobming.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.18.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Personal Life record">
<meta property="og:type" content="website">
<meta property="og:title" content="Jiaming&#39;s Blog">
<meta property="og:url" content="https://blobming.github.io/index.html">
<meta property="og:site_name" content="Jiaming&#39;s Blog">
<meta property="og:description" content="Personal Life record">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Jiaming Xu">
<meta property="article:tag" content="Programming, Traveling">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://blobming.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Jiaming's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Jiaming's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Jiaming's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Jiaming Xu"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Jiaming Xu</p>
  <div class="site-description" itemprop="description">Personal Life record</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">23</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/blobming" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;blobming" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://blobming.github.io/2023/08/08/leetcode-8-8-2022/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Jiaming Xu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jiaming's Blog">
      <meta itemprop="description" content="Personal Life record">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Jiaming's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/08/08/leetcode-8-8-2022/" class="post-title-link" itemprop="url">LeetCode-08/08/2022</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-08 14:48:18" itemprop="dateCreated datePublished" datetime="2023-08-08T14:48:18-07:00">2023-08-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>This is a record of my craking process for Leetcode.</p>
<div class="toc">

<!-- toc -->

<ul>
<li><a href="#word-break-139-https-leetcode-com-problems-word-break">Word Break (<a href="%22https://leetcode.com/problems/word-break/%22">#139</a>)</a></li>
<li><a href="#unique-binary-search-trees-ii-95-https-leetcode-com-problems-unique-binary-search-trees-ii">Unique Binary Search Trees II(<a href="%22https://leetcode.com/problems/unique-binary-search-trees-ii/%22">#95</a>)</a></li>
<li><a href="#number-of-music-playlists-920-https-leetcode-com-problems-number-of-music-playlists">Number of Music Playlists(<a href="%22https://leetcode.com/problems/number-of-music-playlists/">#920</a>)</a></li>
<li><a href="#search-in-a-2d-matrix-74-https-leetcode-com-problems-search-a-2d-matrix">Search in a 2D matrix(<a href="%22https://leetcode.com/problems/search-a-2d-matrix/">#74</a>)</a></li>
</ul>
<!-- tocstop -->

</div>

<h2><span id="word-break-139">Word Break ()</span><a href="#word-break-139" class="header-anchor">#</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">wordBreak</span><span class="params">(String s, List&lt;String&gt; wordDict)</span> &#123;</span><br><span class="line">        HashSet&lt;String&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(wordDict);</span><br><span class="line">        <span class="keyword">if</span>(s.length() == <span class="number">0</span>) <span class="keyword">return</span> set.contains(s);</span><br><span class="line">        <span class="type">boolean</span>[] dp = <span class="keyword">new</span> <span class="title class_">boolean</span>[s.length()];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; s.length(); i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(set.contains(s.substring(<span class="number">0</span>, i + <span class="number">1</span>)))&#123;</span><br><span class="line">                dp[i] = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>(tmp &lt; i)&#123;</span><br><span class="line">                <span class="keyword">if</span>(dp[tmp] &amp;&amp; set.contains(s.substring(tmp + <span class="number">1</span>, i + <span class="number">1</span>)))&#123;</span><br><span class="line">                    dp[i] = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                tmp++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(dp[i]) <span class="keyword">continue</span>;</span><br><span class="line">            dp[i] = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[s.length() - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="unique-binary-search-trees-ii-95">Unique Binary Search Trees II()</span><a href="#unique-binary-search-trees-ii-95" class="header-anchor">#</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val) &#123; this.val = val; &#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val, TreeNode left, TreeNode right) &#123;</span></span><br><span class="line"><span class="comment"> *         this.val = val;</span></span><br><span class="line"><span class="comment"> *         this.left = left;</span></span><br><span class="line"><span class="comment"> *         this.right = right;</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;TreeNode&gt; <span class="title function_">generateTrees</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        Map&lt;Pair&lt;Integer, Integer&gt;, List&lt;TreeNode&gt;&gt; memo = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">return</span> generateTreesWithRoot(<span class="number">1</span>, n, memo);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> List&lt;TreeNode&gt; <span class="title function_">generateTreesWithRoot</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, Map&lt;Pair&lt;Integer, Integer&gt;, List&lt;TreeNode&gt;&gt; memo)</span> &#123;</span><br><span class="line">        List&lt;TreeNode&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(l &gt; r) &#123;</span><br><span class="line">            res.add(<span class="literal">null</span>);</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(memo.containsKey(<span class="keyword">new</span> <span class="title class_">Pair</span>&lt;&gt;(l, r))) &#123;</span><br><span class="line">            <span class="keyword">return</span> memo.get(<span class="keyword">new</span> <span class="title class_">Pair</span>&lt;&gt;(l, r));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> l; i &lt;= r; i++) &#123;</span><br><span class="line">            List&lt;TreeNode&gt; leftSubTrees = generateTreesWithRoot(l, i - <span class="number">1</span>, memo);</span><br><span class="line">            List&lt;TreeNode&gt; rightSubTrees = generateTreesWithRoot(i + <span class="number">1</span>, r, memo);</span><br><span class="line">            <span class="keyword">for</span> (TreeNode left: leftSubTrees) &#123;</span><br><span class="line">                <span class="keyword">for</span> (TreeNode right: rightSubTrees) &#123;</span><br><span class="line">                    <span class="type">TreeNode</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(i, left, right);</span><br><span class="line">                    res.add(root);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        memo.put(<span class="keyword">new</span> <span class="title class_">Pair</span>&lt;&gt;(l, r), res);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="number-of-music-playlists-920">Number of Music Playlists()</span><a href="#number-of-music-playlists-920" class="header-anchor">#</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">numMusicPlaylists</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> goal, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">MOD</span> <span class="operator">=</span> <span class="number">1_000_000_007</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Initialize the DP table</span></span><br><span class="line">        <span class="type">long</span>[][] dp = <span class="keyword">new</span> <span class="title class_">long</span>[goal + <span class="number">1</span>][n + <span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= goal; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= Math.min(i, n); j++) &#123;</span><br><span class="line">                <span class="comment">// The i-th song is a new song</span></span><br><span class="line">                dp[i][j] = dp[i - <span class="number">1</span>][j - <span class="number">1</span>] * (n - j + <span class="number">1</span>) % MOD;</span><br><span class="line">                <span class="comment">// The i-th song is a song we have played before</span></span><br><span class="line">                <span class="keyword">if</span> (j &gt; k) &#123;</span><br><span class="line">                    dp[i][j] = (dp[i][j] + dp[i - <span class="number">1</span>][j] * (j - k)) % MOD;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (<span class="type">int</span>) dp[goal][n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="search-in-a-2d-matrix-74">Search in a 2D matrix()</span><a href="#search-in-a-2d-matrix-74" class="header-anchor">#</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">searchMatrix</span><span class="params">(<span class="type">int</span>[][] matrix, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> matrix.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> matrix[<span class="number">0</span>].length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>, right = m * n - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(left &lt;= right) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> left + (right - left) / <span class="number">2</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid_row</span> <span class="operator">=</span> mid / n;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid_col</span> <span class="operator">=</span> mid - mid_row * n;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(matrix[mid_row][mid_col] == target) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(matrix[mid_row][mid_col] &lt; target)&#123;</span><br><span class="line">                left = mid + <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                right = mid - <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blobming.github.io/2021/06/03/leetcode-6-3-2021/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Jiaming Xu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jiaming's Blog">
      <meta itemprop="description" content="Personal Life record">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Jiaming's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/06/03/leetcode-6-3-2021/" class="post-title-link" itemprop="url">leetcode-6-3-2021</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-06-03 22:20:10" itemprop="dateCreated datePublished" datetime="2021-06-03T22:20:10-07:00">2021-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>This is a record of my craking process for Leetcode.</p>
<div class="toc">

<!-- toc -->

<ul>
<li><a href="#1-number-of-ways-to-paint-n-x-3-grid-1411">1. Number of Ways to Paint N × 3 Grid(#1411)</a><ul>
<li><a href="#1-1-soulution">1.1 Soulution</a></li>
</ul>
</li>
<li><a href="#2-robot-bounded-in-circle-1041">2. Robot Bounded In Circle (#1041)</a><ul>
<li><a href="#2-1-soulution">2.1 Soulution</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

</div>

<h2><span id="1-number-of-ways-to-paint-n-x-3-grid-1411">1. Number of Ways to Paint N × 3 Grid(#1411)</span><a href="#1-number-of-ways-to-paint-n-x-3-grid-1411" class="header-anchor">#</a></h2><h3><span id="1-1-soulution">1.1 Soulution</span><a href="#1-1-soulution" class="header-anchor">#</a></h3><p>Considering the base case (1 * 3) There are several possible choices. 121 212 213 232 312 313 (1 2 3 represents RGB 3 different colors). Then we can consider the next following posible choice in (2 * 3)</p>
<p>Let 121 represents head and tail have the same color and the middle pos varies</p>
<p>Let 123 represent every pos has different color</p>
<p>Then we can derive the following fomular<br>$$b_{121} &#x3D; a_{121} * 3 + a_{123} * 2$$<br>$$b_{123} &#x3D; a_{121} * 2 + a_{123} * 2$$</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">numOfWays</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">a121</span> <span class="operator">=</span> <span class="number">6</span>, a123 = <span class="number">6</span>, b121, b123, mod = (<span class="type">long</span>)<span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            b121 = a121 * <span class="number">3</span> + a123 * <span class="number">2</span>;</span><br><span class="line">            b123 = a121 * <span class="number">2</span> + a123 * <span class="number">2</span>;</span><br><span class="line">            a121 = b121 % mod;</span><br><span class="line">            a123 = b123 % mod;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">int</span>)((a121 + a123) % mod);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">num_of_ways</span>(n: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> (<span class="keyword">mut</span> r, <span class="keyword">mut</span> s) = (<span class="number">6_i64</span>, <span class="number">6_i64</span>) ; </span><br><span class="line">        <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">10_i64</span>.<span class="title function_ invoke__">pow</span>(<span class="number">9</span>) + <span class="number">7</span>; </span><br><span class="line">        <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">1</span>..n &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">_r</span> = r * <span class="number">3</span> + s * <span class="number">2</span>; </span><br><span class="line">            <span class="keyword">let</span> <span class="variable">_s</span> = r * <span class="number">2</span> + s * <span class="number">2</span>; </span><br><span class="line">            r = _r % x; </span><br><span class="line">            s = _s % x; </span><br><span class="line">        &#125;</span><br><span class="line">        ((r + s) % x) <span class="keyword">as</span> <span class="type">i32</span> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="2-robot-bounded-in-circle-1041">2. Robot Bounded In Circle (#1041)</span><a href="#2-robot-bounded-in-circle-1041" class="header-anchor">#</a></h2><h3><span id="2-1-soulution">2.1 Soulution</span><a href="#2-1-soulution" class="header-anchor">#</a></h3><p>The trick in this problem is to consider the impossible cases (The robot does not come back to original nor the bot face the initial position after iteration)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isRobotBounded</span><span class="params">(String instructions)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[][] directions = <span class="keyword">new</span> <span class="title class_">int</span>[][]&#123;&#123;<span class="number">0</span>, <span class="number">1</span>&#125;, &#123;<span class="number">1</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, -<span class="number">1</span>&#125;, &#123;-<span class="number">1</span>, <span class="number">0</span>&#125;&#125;;</span><br><span class="line">        <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">0</span>, y = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> i : instructions.toCharArray()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == <span class="string">&#x27;L&#x27;</span>)</span><br><span class="line">                idx = (idx + <span class="number">3</span>) % <span class="number">4</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (i == <span class="string">&#x27;R&#x27;</span>)</span><br><span class="line">                idx = (idx + <span class="number">1</span>) % <span class="number">4</span>;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                x += directions[idx][<span class="number">0</span>];</span><br><span class="line">                y += directions[idx][<span class="number">1</span>];</span><br><span class="line">            &#125;    </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (x == <span class="number">0</span> &amp;&amp; y == <span class="number">0</span>) || (idx != <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">is_robot_bounded</span>(instructions: <span class="type">String</span>) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">d</span> = (<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">p</span> = (<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">c</span> <span class="keyword">in</span> instructions.<span class="title function_ invoke__">chars</span>() &#123;</span><br><span class="line">            <span class="keyword">match</span> c &#123;</span><br><span class="line">                <span class="string">&#x27;G&#x27;</span> =&gt; p = (p.<span class="number">0</span> + d.<span class="number">0</span>, p.<span class="number">1</span> + d.<span class="number">1</span>),</span><br><span class="line">                <span class="string">&#x27;L&#x27;</span> =&gt; d = (-d.<span class="number">1</span>, d.<span class="number">0</span>),</span><br><span class="line">                <span class="string">&#x27;R&#x27;</span> =&gt; d = (d.<span class="number">1</span>, -d.<span class="number">0</span>),</span><br><span class="line">                _ =&gt; &#123;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        p == (<span class="number">0</span>, <span class="number">0</span>) || d != (<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blobming.github.io/2021/06/02/leetcode-6-2-2021/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Jiaming Xu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jiaming's Blog">
      <meta itemprop="description" content="Personal Life record">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Jiaming's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/06/02/leetcode-6-2-2021/" class="post-title-link" itemprop="url">leetcode-6-2-2021</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-06-02 21:18:10" itemprop="dateCreated datePublished" datetime="2021-06-02T21:18:10-07:00">2021-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>This is a record of my craking process for Leetcode.</p>
<div class="toc">

<!-- toc -->

<ul>
<li><a href="#1-leftmost-column-with-at-least-a-one-1428">1. Leftmost Column with at Least a One (#1428)</a><ul>
<li><a href="#1-1-soulution1">1.1 Soulution1</a></li>
<li><a href="#1-1-soulution2">1.1 Soulution2</a></li>
</ul>
</li>
<li><a href="#2-move-zeroes-283">2. Move Zeroes (#283)</a><ul>
<li><a href="#2-1-soulution1">2.1 Soulution1</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

</div>

<h2><span id="1-leftmost-column-with-at-least-a-one-1428">1. Leftmost Column with at Least a One (#1428)</span><a href="#1-leftmost-column-with-at-least-a-one-1428" class="header-anchor">#</a></h2><h3><span id="1-1-soulution1">1.1 Soulution1</span><a href="#1-1-soulution1" class="header-anchor">#</a></h3><p>The most simple way is two use brute-force (which takes $n^2$ time) But we can optimize it with binary-search</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">leftMostColumnWithOne</span><span class="params">(BinaryMatrix binaryMatrix)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">rows</span> <span class="operator">=</span> binaryMatrix.dimensions().get(<span class="number">0</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">columns</span> <span class="operator">=</span> binaryMatrix.dimensions().get(<span class="number">1</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> columns;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> <span class="number">0</span>; row &lt; rows; row++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">lo</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">hi</span> <span class="operator">=</span> columns - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span>(lo &lt; hi) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> lo + (hi - lo) / <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">if</span>(binaryMatrix.get(row, mid) == <span class="number">0</span>) &#123;</span><br><span class="line">                    lo = mid + <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    hi = mid;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(binaryMatrix.get(row, lo) == <span class="number">1</span>) &#123;</span><br><span class="line">                res = Math.min(lo, res);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res == columns ? -<span class="number">1</span> : res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::cmp;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">left_most_column_with_one</span>(binaryMatrix: &amp;BinaryMatrix) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">rows</span> = binaryMatrix.<span class="title function_ invoke__">dimensions</span>()[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">cols</span> = binaryMatrix.<span class="title function_ invoke__">dimensions</span>()[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">res</span> = cols;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">row</span> <span class="keyword">in</span> (<span class="number">0</span>..rows) &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">lo</span> = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">hi</span> = cols - <span class="number">1</span>;</span><br><span class="line">            <span class="title function_ invoke__">while</span>(lo &lt; hi) &#123;</span><br><span class="line">                <span class="keyword">let</span> <span class="variable">mid</span> = lo + (hi - lo) / <span class="number">2</span>;</span><br><span class="line">                <span class="title function_ invoke__">if</span>(binaryMatrix.<span class="title function_ invoke__">get</span>(row, mid) == <span class="number">0</span>) &#123;</span><br><span class="line">                    lo = mid + <span class="number">1</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    hi = mid;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title function_ invoke__">if</span>(binaryMatrix.<span class="title function_ invoke__">get</span>(row, lo) == <span class="number">1</span>) &#123;</span><br><span class="line">                res = cmp::<span class="title function_ invoke__">min</span>(res, lo);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">if</span>(res == cols)&#123;</span><br><span class="line">            -<span class="number">1</span></span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            res</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="1-1-soulution2">1.1 Soulution2</span><a href="#1-1-soulution2" class="header-anchor">#</a></h3><p>An alternate way is doing one loop (going thorugh the two-dimension table) starting from right-top corner.</p>
<p>When we reach a ‘1’ we choose to go left otherwise go down</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">leftMostColumnWithOne</span><span class="params">(BinaryMatrix binaryMatrix)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; dimensions = binaryMatrix.dimensions();</span><br><span class="line">        <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> dimensions.get(<span class="number">0</span>) - <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> dimensions.get(<span class="number">1</span>) - <span class="number">1</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (r &gt;= <span class="number">0</span> &amp;&amp; c &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (binaryMatrix.get(r, c) == <span class="number">0</span>) &#123;</span><br><span class="line">                r--;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                c--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (c == dimensions.get(<span class="number">1</span>) - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::cmp;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">left_most_column_with_one</span>(binaryMatrix: &amp;BinaryMatrix) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">rows</span> = binaryMatrix.<span class="title function_ invoke__">dimensions</span>()[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">cols</span> = binaryMatrix.<span class="title function_ invoke__">dimensions</span>()[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">current_row</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">current_col</span> = cols - <span class="number">1</span>;</span><br><span class="line">        <span class="title function_ invoke__">while</span>(current_row &lt; rows &amp;&amp; current_col &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">if</span>(binaryMatrix.<span class="title function_ invoke__">get</span>(current_row, current_col) == <span class="number">0</span>) &#123;</span><br><span class="line">                current_row += <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                current_col -= <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">if</span>(current_col == cols - <span class="number">1</span>) &#123;</span><br><span class="line">            -<span class="number">1</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            current_col + <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="2-move-zeroes-283">2. Move Zeroes (#283)</span><a href="#2-move-zeroes-283" class="header-anchor">#</a></h2><h3><span id="2-1-soulution1">2.1 Soulution1</span><a href="#2-1-soulution1" class="header-anchor">#</a></h3><p>A very straight-forward 2-point method</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">moveZeroes</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> <span class="number">0</span>, q = <span class="number">0</span>; p &lt; nums.length; p++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[p] != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> nums[p];</span><br><span class="line">                nums[p] = nums[q];</span><br><span class="line">                nums[q] = temp;</span><br><span class="line">                q++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">move_zeroes</span>(nums: &amp;<span class="keyword">mut</span> <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt;) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">i</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">j</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> i &lt; nums.<span class="title function_ invoke__">len</span>()&#123;</span><br><span class="line">            <span class="keyword">if</span> nums[i] != <span class="number">0</span>&#123;</span><br><span class="line">                <span class="keyword">let</span> <span class="variable">temp</span>: <span class="type">i32</span> = nums[j];</span><br><span class="line">                nums[j] = nums[i];</span><br><span class="line">                nums[i] = temp;</span><br><span class="line">                j += <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            i += <span class="number">1</span>; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blobming.github.io/2021/06/01/leetcode-6-1-2021/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Jiaming Xu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jiaming's Blog">
      <meta itemprop="description" content="Personal Life record">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Jiaming's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/06/01/leetcode-6-1-2021/" class="post-title-link" itemprop="url">leetcode-6-1-2021</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-06-01 22:21:52" itemprop="dateCreated datePublished" datetime="2021-06-01T22:21:52-07:00">2021-06-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>This is a record of my craking process for Leetcode.</p>
<div class="toc">

<!-- toc -->

<ul>
<li><a href="#1-pairs-of-songs-with-total-durations-divisible-by-60-1010">1. Pairs of Songs With Total Durations Divisible by 60 (#1010)</a><ul>
<li><a href="#1-1-problem-description">1.1 Problem Description</a></li>
<li><a href="#1-2-soulution">1.2 Soulution</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

</div>

<h2><span id="1-pairs-of-songs-with-total-durations-divisible-by-60-1010">1. Pairs of Songs With Total Durations Divisible by 60 (#1010)</span><a href="#1-pairs-of-songs-with-total-durations-divisible-by-60-1010" class="header-anchor">#</a></h2><h3><span id="1-1-problem-description">1.1 Problem Description</span><a href="#1-1-problem-description" class="header-anchor">#</a></h3><p>You are given a list of songs where the ith song has a duration of time[i] seconds.</p>
<p>Return the number of pairs of songs for which their total duration in seconds is divisible by 60. Formally, we want the number of indices i, j such that i &lt; j with (time[i] + time[j]) % 60 &#x3D;&#x3D; 0.</p>
<p><strong>Example 1:</strong></p>
<blockquote>
<p>Input: time &#x3D; [30,20,150,100,40]</p>
<p>Output: 3</p>
<p>Explanation: Three pairs have a total duration divisible by 60:</p>
<p>(time[0] &#x3D; 30, time[2] &#x3D; 150): total duration 180</p>
<p>(time[1] &#x3D; 20, time[3] &#x3D; 100): total duration 120</p>
<p>(time[1] &#x3D; 20, time[4] &#x3D; 40): total duration 60</p>
</blockquote>
<p><strong>Example 2:</strong></p>
<blockquote>
<p>Input: time &#x3D; [60,60,60]</p>
<p>Output: 3</p>
<p>Explanation: All three pairs have a total duration of 120, which is divisible by 60.</p>
</blockquote>
<h3><span id="1-2-soulution">1.2 Soulution</span><a href="#1-2-soulution" class="header-anchor">#</a></h3><p>The most straight-forward way to solve this problem is using two loops which takes $n^2$ time. To optimize it, we can use the same way with two sum, but do a small modification. Since we only need to output the pairs, we use an array (size of 60) to record the current value % 60. Then while in the for-loop, we can check 60 - current_value % 60, get its occurences.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">numPairsDivisibleBy60</span><span class="params">(<span class="type">int</span>[] time)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] remains = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">60</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> t : time) &#123;</span><br><span class="line">            <span class="keyword">if</span> (t % <span class="number">60</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                count += remains[<span class="number">0</span>];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                count += remains[<span class="number">60</span> - t % <span class="number">60</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            remains[t % <span class="number">60</span>]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">num_pairs_divisible_by60</span>(time: <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">remains</span> = <span class="built_in">vec!</span>[<span class="number">0</span>;<span class="number">60</span>];</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">count</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">t</span> <span class="keyword">in</span> time.<span class="title function_ invoke__">iter</span>() &#123;</span><br><span class="line">            <span class="title function_ invoke__">if</span> (t % <span class="number">60</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                count += remains[<span class="number">0</span>];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                count += remains[(<span class="number">60</span> - t % <span class="number">60</span>) <span class="keyword">as</span> <span class="type">usize</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            remains[(t % <span class="number">60</span>) <span class="keyword">as</span> <span class="type">usize</span>] += <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        count</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blobming.github.io/2021/05/21/Learning-Rust/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Jiaming Xu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jiaming's Blog">
      <meta itemprop="description" content="Personal Life record">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Jiaming's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/05/21/Learning-Rust/" class="post-title-link" itemprop="url">Learning Rust</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-05-21 10:11:46" itemprop="dateCreated datePublished" datetime="2021-05-21T10:11:46-07:00">2021-05-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Here is my personal notes for Rust</p>
<h2><span id="mutable-ref-and-immutable-ref">mutable ref and immutable ref</span><a href="#mutable-ref-and-immutable-ref" class="header-anchor">#</a></h2><p>one memory block can only have one mutable ref but it can have multiple immutable ref. Also, once a memory block has one mutable ref, all the immutable refs before that would be invalid.<br>For my understanding:<br>Mutable ref is like a “read and write” operation to memory block, while immutable ref is like a “read only” operation to the memory block. Once you have a “read and write” operation(mutable ref), all other “read only” operation(mutable ref) don’t know what happened to that memory block(might be changed by mutable block), so, the result from “read only” operation may not be valid. However, we have to re-create mutable refs.~</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blobming.github.io/2020/11/08/jvm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Jiaming Xu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jiaming's Blog">
      <meta itemprop="description" content="Personal Life record">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Jiaming's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/11/08/jvm/" class="post-title-link" itemprop="url">jvm</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-11-08 19:37:55" itemprop="dateCreated datePublished" datetime="2020-11-08T19:37:55-08:00">2020-11-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="jvm">Jvm</span><a href="#jvm" class="header-anchor">#</a></h1><h2><span id="java-ti-xi-jie-gou">Java 体系结构</span><a href="#java-ti-xi-jie-gou" class="header-anchor">#</a></h2><p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTIzNTExNTAxLnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTIzNTExNTAxLnBuZw"></p>
<h2><span id="java-de-zheng-ti-jie-gou">Java 的整体结构</span><a href="#java-de-zheng-ti-jie-gou" class="header-anchor">#</a></h2><ol>
<li>HotSpot VM是目前市面上高性能虚拟机的代表作之一。</li>
<li>它采用<strong>解释器与即时编译器并存的架构</strong>。</li>
<li>在今天，Java程序的运行性能早已脱胎换骨，已经达到了可以和C&#x2F;C++程序一较高下的地步。</li>
<li><strong>执行引擎包含三部分：解释器，即时编译器，垃圾回收器</strong></li>
</ol>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTMyMzMwNjgyLnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTMyMzMwNjgyLnBuZw"></p>
<h3><span id="java-dai-ma-zhi-xing-liu-cheng">Java 代码执行流程</span><a href="#java-dai-ma-zhi-xing-liu-cheng" class="header-anchor">#</a></h3><p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTMyMzM5MjQ2LnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTMyMzM5MjQ2LnBuZw"></p>
<h2><span id="jvm-jia-gou-mo-xing">JVM 架构模型</span><a href="#jvm-jia-gou-mo-xing" class="header-anchor">#</a></h2><p><strong>Java编译器输入的指令流基本上是一种基于栈的指令集架构</strong>，另外一种指令集架构则是基于寄存器的指令集架构。具体来说：这两种架构之间的区别：</p>
<h3><span id="ji-yu-zhan-de-zhi-ling-ji-jia-gou">基于栈的指令集架构</span><a href="#ji-yu-zhan-de-zhi-ling-ji-jia-gou" class="header-anchor">#</a></h3><ol>
<li>设计和实现更简单，适用于资源受限的系统；</li>
<li><strong>避开了寄存器的分配难题：使用零地址指令方式分配</strong></li>
<li>指令流中的指令大部分是零地址指令，其执行过程依赖于操作栈。<strong>指令集更小，编译器容易实现</strong></li>
<li><strong>不需要硬件支持，可移植性更好，更好实现跨平台</strong></li>
</ol>
<h3><span id="ji-yu-ji-cun-qi-de-zhi-ling-ji-jia-gou">基于寄存器的指令级架构</span><a href="#ji-yu-ji-cun-qi-de-zhi-ling-ji-jia-gou" class="header-anchor">#</a></h3><ol>
<li>典型的应用是x86的二进制指令集：比如传统的PC以及Android的Davlik虚拟机。</li>
<li><strong>指令集架构则完全依赖硬件，与硬件的耦合度高，可移植性差</strong></li>
<li>性能优秀和执行更高效</li>
<li>花费更少的指令去完成一项操作</li>
<li>在大部分情况下，<strong>基于寄存器架构的指令集往往都以一地址指令、二地址指令和三地址指令为主</strong>，而基于栈式架构的指令集却是以零地址指令为主</li>
</ol>
<h2><span id="fan-bian-yi-zi-jie-ma-wen-jian">反编译字节码文件</span><a href="#fan-bian-yi-zi-jie-ma-wen-jian" class="header-anchor">#</a></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javap -v StackStruTest.class</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">  public static void main(java.lang.String[]);</span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=2, locals=4, args_size=1</span><br><span class="line">         0: iconst_2	// 将常量 2 压入栈中</span><br><span class="line">         1: istore_1	// 将常量 2 保存至变量 i 中</span><br><span class="line">         2: iconst_3	// 将常量 3 压入栈中</span><br><span class="line">         3: istore_2	// 将常量 3 保存至变量 j 中</span><br><span class="line">         4: iload_1		// 加载变量 i</span><br><span class="line">         5: iload_2		// 加载变量 j</span><br><span class="line">         6: iadd		// 执行累加操作</span><br><span class="line">         7: istore_3	// 加法结果保存在变量 k 中</span><br><span class="line">         8: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 10: 0</span><br><span class="line">        line 11: 2</span><br><span class="line">        line 12: 4</span><br><span class="line">        line 22: 8</span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            0       9     0  args   [Ljava/lang/String;</span><br><span class="line">            2       7     1     i   I</span><br><span class="line">            4       5     2     j   I</span><br><span class="line">            8       1     3     k   I</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2><span id="jvm-sheng-ming-zhou-qi">JVM 生命周期</span><a href="#jvm-sheng-ming-zhou-qi" class="header-anchor">#</a></h2><h3><span id="xu-ni-ji-de-qi-dong">虚拟机的启动</span><a href="#xu-ni-ji-de-qi-dong" class="header-anchor">#</a></h3><p><strong>Java虚拟机的启动是通过引导类加载器（bootstrap class loader）创建一个初始类（initial class）来完成的</strong>，这个类是由虚拟机的具体实现指定的</p>
<h3><span id="xu-ni-ji-de-zhi-xing">虚拟机的执行</span><a href="#xu-ni-ji-de-zhi-xing" class="header-anchor">#</a></h3><ol>
<li>一个运行中的Java虚拟机有着一个清晰的任务：执行Java程序</li>
<li>程序开始执行时他才运行，程序结束时他就停止</li>
<li><strong>执行一个所谓的Java程序的时候，真真正正在执行的是一个叫做Java虚拟机的进程</strong></li>
</ol>
<h3><span id="xu-ni-ji-de-tui-chu">虚拟机的退出</span><a href="#xu-ni-ji-de-tui-chu" class="header-anchor">#</a></h3><ol>
<li>程序正常执行结束 &#x2F;&#x2F;jps 查看进程</li>
<li>程序在执行过程中遇到了异常或错误而异常终止</li>
<li>由于操作系统用现错误而导致Java虚拟机进程终止</li>
<li>某线程调用Runtime类或System类的exit()方法，或Runtime类的halt()方法，并且Java安全管理器也允许这次exit()或halt()操作。</li>
<li>除此之外，JNI（Java Native Interface）规范描述了用JNI Invocation API来加载或卸载 Java虚拟机时，Java虚拟机的退出情况。</li>
</ol>
<h1><span id="lei-jia-zai-zi-xi-tong">类加载子系统</span><a href="#lei-jia-zai-zi-xi-tong" class="header-anchor">#</a></h1><p>完整框图</p>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTQ1MzIxMjIyLnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTQ1MzIxMjIyLnBuZw"></p>
<ol>
<li><p><strong>类加载器子系统负责从文件系统或者网络中加载Class文件</strong>，class文件在文件开头有特定的文件标识。</p>
</li>
<li><p>ClassLoader只负责class文件的加载，至于它是否可以运行，则由Execution Engine决定。</p>
</li>
<li><p><strong>加载的类信息存放于一块称为方法区的内存空间</strong>。除了类的信息外，方法区中还会存放运行时常量池信息，可能还包括字符串字面量和数字常量（这部分常量信息是Class文件中常量池部分的内存映射）</p>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MDgxODEzNDA5LnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MDgxODEzNDA5LnBuZw"></p>
</li>
</ol>
<blockquote>
<p><strong>class –&gt; Java.lang.Class</strong></p>
</blockquote>
<ol>
<li><p>class file存在于本地硬盘上，可以理解为设计师画在纸上的模板，而最终这个模板在执行的时候是要加载到JVM当中来根据这个文件实例化出n个一模一样的实例。</p>
</li>
<li><p><strong>class file加载到JVM中，被称为DNA元数据模板，放在方法区</strong>。</p>
</li>
<li><p>在.class文件–&gt;JVM–&gt;最终成为元数据模板，此过程就要一个运输工具（类装载器Class Loader），扮演一个快递员的角色。</p>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MDgxOTEzNTM4LnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MDgxOTEzNTM4LnBuZw"></p>
</li>
</ol>
<h2><span id="lei-de-jia-zai-guo-cheng">类的加载过程</span><a href="#lei-de-jia-zai-guo-cheng" class="header-anchor">#</a></h2><h3><span id="lei-jia-zai-guo-cheng-gai-shu">类加载过程概述</span><a href="#lei-jia-zai-guo-cheng-gai-shu" class="header-anchor">#</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloLoader</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;谢谢ClassLoader加载我....&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;你的大恩大德，我下辈子再报！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>类的加载过程</p>
<ul>
<li><p>执行 main() 方法（静态方法）就需要先加载承载类 HelloLoader</p>
</li>
<li><p>加载成功，则进行链接、初始化等操作，完成后调用 HelloLoader 类中的静态方法 main</p>
</li>
<li><p>加载失败则抛出异常</p>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MDgyMjU1NzQ2LnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MDgyMjU1NzQ2LnBuZw"></p>
</li>
<li><p>完整的流程图如下所示：<strong>加载 –&gt; 链接（验证 –&gt; 准备 –&gt; 解析） –&gt; 初始化</strong></p>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MDgyNjAxNDQxLnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MDgyNjAxNDQxLnBuZw"></p>
</li>
</ul>
<h3><span id="jia-zai-liu-cheng">加载流程</span><a href="#jia-zai-liu-cheng" class="header-anchor">#</a></h3><ol>
<li><strong>通过一个类的全限定名获取定义此类的二进制字节流</strong></li>
<li>将这个字节流所代表的静态存储结构转化为<strong>方法区的运行时数据结构</strong></li>
<li><strong>在内存中生成一个代表这个类的java.lang.Class对象</strong>，作为方法区这个类的各种数据的访问入口</li>
</ol>
<h3><span id="jia-zai-class-wen-jian-de-fang-shi">加载class文件的方式</span><a href="#jia-zai-class-wen-jian-de-fang-shi" class="header-anchor">#</a></h3><ol>
<li>从本地系统中直接加载</li>
<li>通过网络获取，典型场景：Web Applet</li>
<li>从zip压缩包中读取，成为日后jar、war格式的基础</li>
<li>运行时计算生成，使用最多的是：动态代理技术</li>
<li>由其他文件生成，典型场景：JSP应用从专有数据库中提取.class文件，比较少见</li>
<li>从加密文件中获取，典型的防Class文件被反编译的保护措施</li>
</ol>
<h3><span id="lian-jie-jie-duan">链接阶段</span><a href="#lian-jie-jie-duan" class="header-anchor">#</a></h3><p>链接分为三个子阶段：验证 –&gt; 准备 –&gt; 解析</p>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTU0MDM5NjIwLnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTU0MDM5NjIwLnBuZw"><strong>验证</strong></p>
<ol>
<li><strong>目的在于确保Class文件的字节流中包含信息符合当前虚拟机要求，保证被加载类的正确性，不会危害虚拟机自身安全</strong></li>
<li>主要包括四种验证，文件格式验证，元数据验证，字节码验证，符号引用验证。</li>
</ol>
<p>举例</p>
<ul>
<li><p>使用 BinaryViewer 查看字节码文件，其开头均为 CAFE BABE ，如果出现不合法的字节码文件，那么将会验证不通过</p>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTU0NjUxOTY1LnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTU0NjUxOTY1LnBuZw"></p>
</li>
</ul>
<p>准备</p>
<ol>
<li><strong>为类变量分配内存并且设置该类变量的默认初始值，即零值</strong></li>
<li>这里不包含用final修饰的static，因为final在编译的时候就会分配好了默认值，准备阶段会显式初始化</li>
<li>注意：这里不会为实例变量分配初始化，类变量会分配在方法区中，而实例变量是会随着对象一起分配到Java堆中</li>
</ol>
<p>举例</p>
<ul>
<li>代码：变量a在准备阶段会赋初始值，但不是1，而是0，在初始化阶段会被赋值为 1</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloApp</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">1</span>;   <span class="comment">//prepare：a = 0 ---&gt; initial : a = 1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解析(Resolve)</p>
<p>解析</p>
<ol>
<li><strong>将常量池内的符号引用转换为直接引用的过程</strong></li>
<li>事实上，解析操作往往会伴随着JVM在执行完初始化之后再执行</li>
<li>符号引用就是一组符号来描述所引用的目标。符号引用的字面量形式明确定义在《java虚拟机规范》的class文件格式中。直接引用就是直接指向目标的指针、相对偏移量或一个间接定位到目标的句柄</li>
<li>解析动作主要针对类或接口、字段、类方法、接口方法、方法类型等。对应常量池中的CONSTANT Class info、CONSTANT Fieldref info、CONSTANT Methodref info等</li>
</ol>
<h2><span id="chu-shi-hua-jie-duan">初始化阶段</span><a href="#chu-shi-hua-jie-duan" class="header-anchor">#</a></h2><ol>
<li><strong>初始化阶段就是执行类构造器方法<code>&lt;clinit&gt;()</code>的过程</strong></li>
<li>此方法不需定义，是javac编译器自动收集类中的所有类变量的赋值动作和静态代码块中的语句合并而来。也就是说，<strong>当我们代码中包含static变量的时候，就会有clinit方法</strong></li>
<li><strong><code>&lt;clinit&gt;()</code>方法中的指令按语句在源文件中出现的顺序执行</strong></li>
<li><code>&lt;clinit&gt;()</code>不同于类的构造器。（关联：构造器是虚拟机视角下的<code>&lt;init&gt;()</code>）</li>
<li><strong>若该类具有父类，JVM会保证子类的<code>&lt;clinit&gt;()</code>执行前，父类的<code>&lt;clinit&gt;()</code>已经执行完毕</strong></li>
<li><strong>虚拟机必须保证一个类的<code>&lt;clinit&gt;()</code>方法在多线程下被同步加锁</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassInitTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> <span class="number">10</span>;      <span class="comment">//linking之prepare: number = 0 --&gt; initial: 10 --&gt; 20</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        num = <span class="number">2</span>;</span><br><span class="line">        number = <span class="number">20</span>;</span><br><span class="line">        System.out.println(num);</span><br><span class="line">        <span class="comment">//System.out.println(number);    //报错：非法的前向引用（可以赋值，但不能调用）</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(ClassInitTest.num);<span class="comment">//2</span></span><br><span class="line">        System.out.println(ClassInitTest.number);<span class="comment">//10</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>静态变量 number 的值变化过程如下</p>
<ul>
<li>准备阶段时：0</li>
<li>执行静态变量初始化：10</li>
<li>执行静态代码块：20</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">blic <span class="keyword">class</span> <span class="title class_">ClassInitTest</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">static</span>&#123;</span><br><span class="line">       num = <span class="number">2</span>;</span><br><span class="line">       number = <span class="number">20</span>;</span><br><span class="line">       System.out.println(num);</span><br><span class="line">       <span class="comment">//System.out.println(number);    //报错：非法的前向引用（可以赋值，但不能调用）</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> <span class="number">10</span>;      <span class="comment">//linking之prepare: number = 0 --&gt; initial: 20 --&gt; 10</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(ClassInitTest.num);		<span class="comment">//2</span></span><br><span class="line">        System.out.println(ClassInitTest.number);	<span class="comment">//10</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>静态变量 number 的值变化过程如下</p>
<ul>
<li>准备阶段时：0</li>
<li>执行静态代码块：20</li>
<li>执行静态变量初始化：10</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClinitTest</span> &#123;</span><br><span class="line">    <span class="comment">//任何一个类声明以后，内部至少存在一个类的构造器</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ClinitTest</span><span class="params">()</span>&#123;</span><br><span class="line">        a = <span class="number">10</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">d</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在构造器中：<ul>
<li>先将类变量 a 赋值为 10</li>
<li>再将局部变量赋值为 20</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClinitTest1</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Father</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">A</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">static</span>&#123;</span><br><span class="line">            A = <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Son</span> <span class="keyword">extends</span> <span class="title class_">Father</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">B</span> <span class="operator">=</span> A;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//加载Father类，其次加载Son类。</span></span><br><span class="line">        System.out.println(Son.B);<span class="comment">//2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如上代码，加载流程如下：</p>
<ul>
<li>首先，执行 main() 方法需要加载 ClinitTest1 类</li>
<li>获取 Son.B 静态变量，需要加载 Son 类</li>
<li>Son 类的父类是 Father 类，所以需要先执行 Father 类的加载，再执行 Son 类的加载</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeadThreadTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">r</span> <span class="operator">=</span> () -&gt; &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;开始&quot;</span>);</span><br><span class="line">            <span class="type">DeadThread</span> <span class="variable">dead</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeadThread</span>();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;结束&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(r, <span class="string">&quot;线程1&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(r, <span class="string">&quot;线程2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DeadThread</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;初始化当前类&quot;</span>);</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>程序卡死，分析原因：</p>
<ul>
<li>两个线程同时去加载 DeadThread 类，而 DeadThread 类中静态代码块中有一处死循环</li>
<li>先加载 DeadThread 类的线程抢到了同步锁，然后在类的静态代码块中执行死循环，而另一个线程在等待同步锁的释放</li>
<li>所以无论哪个线程先执行 DeadThread 类的加载，另外一个类也不会继续执行</li>
</ul>
<h2><span id="lei-jia-zai-qi-de-fen-lei">类加载器的分类</span><a href="#lei-jia-zai-qi-de-fen-lei" class="header-anchor">#</a></h2><h3><span id="lei-jia-zai-qi-gai-shu">类加载器概述</span><a href="#lei-jia-zai-qi-gai-shu" class="header-anchor">#</a></h3><p>类加载器的分类</p>
<ol>
<li><strong>JVM支持两种类型的类加载器 。分别为引导类加载器（Bootstrap ClassLoader）和自定义类加载器（User-Defined ClassLoader）</strong></li>
<li>从概念上来讲，自定义类加载器一般指的是程序中由开发人员自定义的一类类加载器，但是Java虚拟机规范却没有这么定义，而是<strong>将所有派生于抽象类ClassLoader的类加载器都划分为自定义类加载器</strong></li>
<li>无论类加载器的类型如何划分，在程序中我们最常见的类加载器始终只有3个，如下所示</li>
<li>这里的四者之间是包含关系，不是上层和下层，也不是子父类的继承关系。</li>
</ol>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MDk0MTQ5MjIzLnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MDk0MTQ5MjIzLnBuZw"></p>
<p>ExtClassLoader 继承树</p>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTcwODM3NTM4LnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTcwODM3NTM4LnBuZw"></p>
<ul>
<li>AppClassLoader 继承树<img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTcwOTE4MDM3LnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTcwOTE4MDM3LnBuZw"></li>
</ul>
<p><strong>代码</strong>：</p>
<ul>
<li>我们尝试获取引导类加载器，获取到的值为 null ，这并不代表引导类加载器不存在，<strong>因为引导类加载器右 C&#x2F;C++ 语言，我们获取不到</strong></li>
<li>两次获取系统类加载器的值都相同：sun.misc.Launcher$AppClassLoader@18b4aac2 ，这说明<strong>系统类加载器是全局唯一的</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassLoaderTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取系统类加载器</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">systemClassLoader</span> <span class="operator">=</span> ClassLoader.getSystemClassLoader();</span><br><span class="line">        System.out.println(systemClassLoader);<span class="comment">//sun.misc.Launcher$AppClassLoader@18b4aac2</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取其上层：扩展类加载器</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">extClassLoader</span> <span class="operator">=</span> systemClassLoader.getParent();</span><br><span class="line">        System.out.println(extClassLoader);<span class="comment">//sun.misc.Launcher$ExtClassLoader@1540e19d</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取其上层：获取不到引导类加载器</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">bootstrapClassLoader</span> <span class="operator">=</span> extClassLoader.getParent();</span><br><span class="line">        System.out.println(bootstrapClassLoader);<span class="comment">//null</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//对于用户自定义类来说：默认使用系统类加载器进行加载</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> ClassLoaderTest.class.getClassLoader();</span><br><span class="line">        System.out.println(classLoader);<span class="comment">//sun.misc.Launcher$AppClassLoader@18b4aac2</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//String类使用引导类加载器进行加载的。---&gt; Java的核心类库都是使用引导类加载器进行加载的。</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader1</span> <span class="operator">=</span> String.class.getClassLoader();</span><br><span class="line">        System.out.println(classLoader1);<span class="comment">//null</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3><span id="xu-ni-ji-zi-dai-de-jia-zai-qi">虚拟机自带的加载器</span><a href="#xu-ni-ji-zi-dai-de-jia-zai-qi" class="header-anchor">#</a></h3><h4><span id="qi-dong-lei-jia-zai-qi">启动类加载器</span><a href="#qi-dong-lei-jia-zai-qi" class="header-anchor">#</a></h4><p>启动类加载器（引导类加载器，Bootstrap ClassLoader）</p>
<ol>
<li><strong>这个类加载使用C&#x2F;C++语言实现的，嵌套在JVM内部</strong></li>
<li><strong>它用来加载Java的核心库（JAVA_HOME&#x2F;jre&#x2F;lib&#x2F;rt.jar、resources.jar或sun.boot.class.path路径下的内容），用于提供JVM自身需要的类</strong></li>
<li><strong>并不继承自java.lang.ClassLoader，没有父加载器</strong></li>
<li><strong>加载扩展类和应用程序类加载器，并作为他们的父类加载器（当他俩的爹）</strong></li>
<li><strong>出于安全考虑，Bootstrap启动类加载器只加载包名为java、javax、sun等开头的类</strong></li>
</ol>
<h4><span id="kuo-zhan-lei-jia-zai-qi">扩展类加载器</span><a href="#kuo-zhan-lei-jia-zai-qi" class="header-anchor">#</a></h4><p>扩展类加载器（Extension ClassLoader）</p>
<ol>
<li><strong>Java语言编写，由sun.misc.Launcher$ExtClassLoader实现</strong></li>
<li><strong>派生于ClassLoader类</strong></li>
<li><strong>父类加载器为启动类加载器</strong></li>
<li><strong>从java.ext.dirs系统属性所指定的目录中加载类库，或从JDK的安装目录的jre&#x2F;lib&#x2F;ext子目录（扩展目录）下加载类库。如果用户创建的JAR放在此目录下，也会自动由扩展类加载器加载</strong></li>
</ol>
<h4><span id="4-2-3-xi-tong-lei-jia-zai-qi">4.2.3、系统类加载器</span><a href="#4-2-3-xi-tong-lei-jia-zai-qi" class="header-anchor">#</a></h4><p>应用程序类加载器（系统类加载器，AppClassLoader）</p>
<ol>
<li><strong>Java语言编写，由sun.misc.LaunchersAppClassLoader实现</strong></li>
<li><strong>派生于ClassLoader类</strong></li>
<li><strong>父类加载器为扩展类加载器</strong></li>
<li><strong>它负责加载环境变量classpath或系统属性java.class.path指定路径下的类库</strong></li>
<li><strong>该类加载是程序中默认的类加载器，一般来说，Java应用的类都是由它来完成加载</strong></li>
<li><strong>通过classLoader.getSystemclassLoader()方法可以获取到该类加载器</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassLoaderTest1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;**********启动类加载器**************&quot;</span>);</span><br><span class="line">        <span class="comment">//获取BootstrapClassLoader能够加载的api的路径</span></span><br><span class="line">        URL[] urLs = sun.misc.Launcher.getBootstrapClassPath().getURLs();</span><br><span class="line">        <span class="keyword">for</span> (URL element : urLs) &#123;</span><br><span class="line">            System.out.println(element.toExternalForm());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//从上面的路径中随意选择一个类,来看看他的类加载器是什么:引导类加载器</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> Provider.class.getClassLoader();</span><br><span class="line">        System.out.println(classLoader);<span class="comment">//null</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;***********扩展类加载器*************&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">extDirs</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;java.ext.dirs&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String path : extDirs.split(<span class="string">&quot;;&quot;</span>)) &#123;</span><br><span class="line">            System.out.println(path);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//从上面的路径中随意选择一个类,来看看他的类加载器是什么:扩展类加载器</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader1</span> <span class="operator">=</span> CurveDB.class.getClassLoader();</span><br><span class="line">        System.out.println(classLoader1);<span class="comment">//sun.misc.Launcher$ExtClassLoader@1540e19d</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">**********启动类加载器**************</span><br><span class="line">file:/C:/Program%20Files/Java/jdk1.8.0_144/jre/lib/resources.jar</span><br><span class="line">file:/C:/Program%20Files/Java/jdk1.8.0_144/jre/lib/rt.jar</span><br><span class="line">file:/C:/Program%20Files/Java/jdk1.8.0_144/jre/lib/sunrsasign.jar</span><br><span class="line">file:/C:/Program%20Files/Java/jdk1.8.0_144/jre/lib/jsse.jar</span><br><span class="line">file:/C:/Program%20Files/Java/jdk1.8.0_144/jre/lib/jce.jar</span><br><span class="line">file:/C:/Program%20Files/Java/jdk1.8.0_144/jre/lib/charsets.jar</span><br><span class="line">file:/C:/Program%20Files/Java/jdk1.8.0_144/jre/lib/jfr.jar</span><br><span class="line">file:/C:/Program%20Files/Java/jdk1.8.0_144/jre/classes</span><br><span class="line">null</span><br><span class="line">***********扩展类加载器*************</span><br><span class="line">C:\Program Files\Java\jdk1.8.0_144\jre\lib\ext</span><br><span class="line">C:\WINDOWS\Sun\Java\lib\ext</span><br><span class="line">sun.misc.Launcher<span class="variable">$ExtClassLoader</span>@7ea987ac</span><br></pre></td></tr></table></figure>

<h3><span id="yong-hu-zi-ding-yi-lei-jia-zai-qi">用户自定义类加载器</span><a href="#yong-hu-zi-ding-yi-lei-jia-zai-qi" class="header-anchor">#</a></h3><blockquote>
<p><strong>为什么需要自定义类加载器？</strong></p>
</blockquote>
<p>在Java的日常应用程序开发中，类的加载几乎是由上述3种类加载器相互配合执行的，在必要时，我们还可以自定义类加载器，来定制类的加载方式。那为什么还需要自定义类加载器？</p>
<ol>
<li>隔离加载类</li>
<li>修改类加载的方式</li>
<li>扩展加载源</li>
<li>防止源码泄漏</li>
</ol>
<blockquote>
<p><strong>如何自定义类加载器？</strong></p>
</blockquote>
<ol>
<li>开发人员可以通过继承抽象类java.lang.ClassLoader类的方式，实现自己的类加载器，以满足一些特殊的需求</li>
<li>在JDK1.2之前，在自定义类加载器时，总会去继承ClassLoader类并重写loadClass()方法，从而实现自定义的类加载类，但是在JDK1.2之后已不再建议用户去覆盖loadClass()方法，而是建议把自定义的类加载逻辑写在findclass()方法中</li>
<li>在编写自定义类加载器时，如果没有太过于复杂的需求，可以直接继承URIClassLoader类，这样就可以避免自己去编写findclass()方法及其获取字节码流的方式，使自定义类加载器编写更加简洁。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomClassLoader</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">byte</span>[] result = getClassFromCustomPath(name);</span><br><span class="line">            <span class="keyword">if</span> (result == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FileNotFoundException</span>();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> defineClass(name, result, <span class="number">0</span>, result.length);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ClassNotFoundException</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] getClassFromCustomPath(String name) &#123;</span><br><span class="line">        <span class="comment">//从自定义路径中加载指定类:细节略</span></span><br><span class="line">        <span class="comment">//如果指定路径的字节码文件进行了加密，则需要在此方法中进行解密操作。</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">CustomClassLoader</span> <span class="variable">customClassLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CustomClassLoader</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;One&quot;</span>, <span class="literal">true</span>, customClassLoader);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> clazz.newInstance();</span><br><span class="line">            System.out.println(obj.getClass().getClassLoader());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3><span id="guan-yu-classloader">关于 ClassLoader</span><a href="#guan-yu-classloader" class="header-anchor">#</a></h3><blockquote>
<p><strong>ClassLoader 类介绍</strong></p>
</blockquote>
<ul>
<li><p>ClassLoader类，它是一个抽象类，其后所有的类加载器都继承自ClassLoader（不包括启动类加载器）</p>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MTAzNTE2MTM4LnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MTAzNTE2MTM4LnBuZw"></p>
</li>
<li><p>sun.misc.Launcher 它是一个java虚拟机的入口应用</p>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MTAzNjM2MDAzLnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MTAzNjM2MDAzLnBuZw"></p>
</li>
</ul>
<p>获取class的途径</p>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTk0MTM1MTk4LnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTk0MTM1MTk4LnBuZw"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassLoaderTest2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//1.Class.forName().getClassLoader()</span></span><br><span class="line">            <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.lang.String&quot;</span>).getClassLoader();</span><br><span class="line">            System.out.println(classLoader); <span class="comment">// String 类由启动类加载器加载，我们无法获取</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//2.Thread.currentThread().getContextClassLoader()</span></span><br><span class="line">            <span class="type">ClassLoader</span> <span class="variable">classLoader1</span> <span class="operator">=</span> Thread.currentThread().getContextClassLoader();</span><br><span class="line">            System.out.println(classLoader1);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//3.ClassLoader.getSystemClassLoader().getParent()</span></span><br><span class="line">            <span class="type">ClassLoader</span> <span class="variable">classLoader2</span> <span class="operator">=</span> ClassLoader.getSystemClassLoader();</span><br><span class="line">            System.out.println(classLoader2);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="literal">null</span></span><br><span class="line">sun.misc.Launcher$AppClassLoader@18b4aac2</span><br><span class="line">sun.misc.Launcher$AppClassLoader@18b4aac2</span><br></pre></td></tr></table></figure>

<h2><span id="shuang-qin-wei-pai-ji-zhi">双亲委派机制</span><a href="#shuang-qin-wei-pai-ji-zhi" class="header-anchor">#</a></h2><h3><span id="shuang-qin-wei-pai-ji-zhi-yuan-li">双亲委派机制原理</span><a href="#shuang-qin-wei-pai-ji-zhi-yuan-li" class="header-anchor">#</a></h3><blockquote>
<p><strong>双亲委派机制的原理</strong></p>
</blockquote>
<p><strong>Java虚拟机对class文件采用的是按需加载的方式</strong>，也就是说当需要使用该类时才会将它的class文件加载到内存生成class对象。而且<strong>加载某个类的class文件时，Java虚拟机采用的是双亲委派模式，即把请求交由父类处理，它是一种任务委派模式</strong></p>
<ol>
<li><p>如果一个类加载器收到了类加载请求，它并不会自己先去加载，而是把这个请求委托给父类的加载器去执行；</p>
</li>
<li><p>如果父类加载器还存在其父类加载器，则进一步向上委托，依次递归，请求最终将到达顶层的启动类加载器；</p>
</li>
<li><p>如果父类加载器可以完成类加载任务，就成功返回，倘若父类加载器无法完成此加载任务，子加载器才会尝试自己去加载，这就是双亲委派模式。</p>
</li>
<li><p>父类加载器一层一层往下分配任务，如果子类加载器能加载，则加载此类，如果将加载任务分配至系统类加载器也无法加载此类，则抛出异常</p>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MTA1MTUxMjU4LnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MTA1MTUxMjU4LnBuZw"></p>
</li>
</ol>
<p>Example1</p>
<ul>
<li>我们自己建立一个 java.lang.String 类，写上 static 代码块</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> java.lang;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">String</span> &#123;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;我是自定义的String类的静态代码块&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在另外的程序中加载 String 类，看看加载的 String 类是 JDK 自带的 String 类，还是我们自己编写的 String 类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        java.lang.<span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">java</span>.lang.String();</span><br><span class="line">        System.out.println(<span class="string">&quot;hello,atguigu.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">StringTest</span> <span class="variable">test</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringTest</span>();</span><br><span class="line">        System.out.println(test.getClass().getClassLoader());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>程序并没有输出我们静态代码块中的内容，可见仍然加载的是 JDK 自带的 String 类</li>
</ul>
<p>Example2</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> java.lang;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">String</span> &#123;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;我是自定义的String类的静态代码块&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//错误: 在类 java.lang.String 中找不到 main 方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello,String&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>由于双亲委派机制找到的是 JDK 自带的 String 类，在那个 String 类中并没有 main() 方法</li>
</ul>
<p>当我们加载jdbc.jar 用于实现数据库连接的时候</p>
<ol>
<li><p>首先我们需要知道的是 jdbc.jar是基于SPI接口进行实现的</p>
</li>
<li><p>所以在加载的时候，会进行双亲委派，最终从根加载器中加载 SPI核心类，然后再加载SPI接口类</p>
</li>
<li><p>接着在进行反向委托，通过线程上下文类加载器进行实现类 jdbc.jar的加载。</p>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MTA1ODEwMTA3LnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MTA1ODEwMTA3LnBuZw"></p>
</li>
</ol>
<h3><span id="shuang-qin-wei-pai-ji-zhi-you-shi">双亲委派机制优势</span><a href="#shuang-qin-wei-pai-ji-zhi-you-shi" class="header-anchor">#</a></h3><blockquote>
<p><strong>双亲委派机制的优势</strong></p>
</blockquote>
<p>通过上面的例子，我们可以知道，双亲机制可以</p>
<ol>
<li>避免类的重复加载</li>
<li>保护程序安全，防止核心API被随意篡改<ol>
<li>自定义类：java.lang.String 没有调用</li>
<li>自定义类：java.lang.ShkStart（报错：阻止创建 java.lang开头的类）</li>
</ol>
</li>
</ol>
<p>Example：在 java.lang 包下整个 ShkStart 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> java.lang;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShkStart</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>出于保护机制，java.lang 包下不允许我们自定义类</p>
<h3><span id="sha-xiang-an-quan-ji-zhi">沙箱安全机制</span><a href="#sha-xiang-an-quan-ji-zhi" class="header-anchor">#</a></h3><p>自定义String类时：在加载自定义String类的时候会率先使用引导类加载器加载，而引导类加载器在加载的过程中会先加载jdk自带的文件（rt.jar包中java.lang.String.class），报错信息说没有main方法，就是因为加载的是rt.jar包中的String类。这样可以保证对java核心源代码的保护，这就是沙箱安全机制。</p>
<h3><span id="qi-ta">其他</span><a href="#qi-ta" class="header-anchor">#</a></h3><blockquote>
<p><strong>如何判断两个class对象是否相同？</strong></p>
</blockquote>
<p>在JVM中表示两个class对象是否为同一个类存在两个必要条件：</p>
<ol>
<li><strong>类的完整类名必须一致，包括包名</strong></li>
<li><strong>加载这个类的ClassLoader（指ClassLoader实例对象）必须相同</strong></li>
<li>换句话说，在JVM中，即使这两个类对象（class对象）来源同一个Class文件，被同一个虚拟机所加载，但只要加载它们的ClassLoader实例对象不同，那么这两个类对象也是不相等的</li>
</ol>
<blockquote>
<p><strong>对类加载器的引用</strong></p>
</blockquote>
<ol>
<li>JVM必须知道一个类型是由启动加载器加载的还是由用户类加载器加载的</li>
<li><strong>如果一个类型是由用户类加载器加载的，那么JVM会将这个类加载器的一个引用作为类型信息的一部分保存在方法区中</strong></li>
<li>当解析一个类型到另一个类型的引用的时候，JVM需要保证这两个类型的类加载器是相同的</li>
</ol>
<blockquote>
<p><strong>类的主动使用和被动使用</strong></p>
</blockquote>
<p>Java程序对类的使用方式分为：主动使用和被动使用。主动使用，又分为七种情况：</p>
<ol>
<li>创建类的实例</li>
<li>访问某个类或接口的静态变量，或者对该静态变量赋值</li>
<li>调用类的静态方法</li>
<li>反射（比如：Class.forName(“com.atguigu.Test”)）</li>
<li>初始化一个类的子类</li>
<li>Java虚拟机启动时被标明为启动类的类</li>
<li>JDK7开始提供的动态语言支持：java.lang.invoke.MethodHandle实例的解析结果REF_getStatic、REF putStatic、REF_invokeStatic句柄对应的类没有初始化，则初始化</li>
</ol>
<p>除了以上七种情况，其他使用Java类的方式都被看作是对类的被动使用，都不会导致类的初始化，即不会执行初始化阶段（不会调用 clinit() 方法和 init() 方法）</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blobming.github.io/2020/06/03/LeetCodeDailyNotes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Jiaming Xu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jiaming's Blog">
      <meta itemprop="description" content="Personal Life record">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Jiaming's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/06/03/LeetCodeDailyNotes/" class="post-title-link" itemprop="url">LeetCodeDailyNotes</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-06-03 08:18:02" itemprop="dateCreated datePublished" datetime="2020-06-03T08:18:02-07:00">2020-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Leetcode/" itemprop="url" rel="index"><span itemprop="name">Leetcode</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="leetcode-daily-notes">LeetCode Daily Notes</span><a href="#leetcode-daily-notes" class="header-anchor">#</a></h1><h2><span id="6-x2f-3-x2f-2020">6&#x2F;3&#x2F;2020</span><a href="#6-x2f-3-x2f-2020" class="header-anchor">#</a></h2><ul>
<li><p>string.trim() is used to trim leading and tailing spaces in a String</p>
</li>
<li><p>If we want to split a string by multiple spaces we can use string.split(“\\s+”)</p>
</li>
<li><p>If we want to concatenate a list of string, we can use String.join(“ “, wordList).</p>
</li>
<li><p>Lambda expression used in sorting List or Array</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">arr1.sort((a, b) -&gt; Integer.compare(a[<span class="number">1</span>] - a[<span class="number">0</span>], b[<span class="number">1</span>] - b[<span class="number">0</span>]));</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">arr1.sort(Comparator.comparingInt(a -&gt; a[<span class="number">1</span>] - a[<span class="number">0</span>]));</span><br><span class="line"><span class="comment">// or this method is more flexible</span></span><br><span class="line">arr2.sort((a, b) -&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span>(a[<span class="number">0</span>] &gt; a[<span class="number">1</span>]) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a[<span class="number">0</span>] &lt; a[<span class="number">1</span>]) &#123;</span><br><span class="line">                    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blobming.github.io/2020/05/25/Spring-Annotation-Notes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Jiaming Xu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jiaming's Blog">
      <meta itemprop="description" content="Personal Life record">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Jiaming's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/25/Spring-Annotation-Notes/" class="post-title-link" itemprop="url">Spring Annotation Notes</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-05-25 21:52:30" itemprop="dateCreated datePublished" datetime="2020-05-25T21:52:30-07:00">2020-05-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="spring-zhu-jie-qu-dong-kai-fa">Spring 注解驱动开发</span><a href="#spring-zhu-jie-qu-dong-kai-fa" class="header-anchor">#</a></h1><h2><span id="rong-qi-container">容器(Container)</span><a href="#rong-qi-container" class="header-anchor">#</a></h2><p>配置类 &#x3D;&#x3D; 配置文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//配置类</span></span><br><span class="line"><span class="meta">@Configuration</span> <span class="comment">//告诉spring这事一个配置类</span></span><br><span class="line"><span class="comment">//@ComponentScan //value表示要扫描包的位置</span></span><br><span class="line"><span class="comment">//excludeFilters 要排除哪些Component,里面装着是Filter[]</span></span><br><span class="line"><span class="meta">@ComponentScan(value=&quot;com.atguigu&quot;, excludeFilters = &#123;</span></span><br><span class="line"><span class="meta">  @Filter(type=&quot;FilterType.ANNOTATION&quot;,classes=&#123;Controller.class&#125;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="comment">//Filter的type是表明按照什么方式去排除，里面有5种,分别是：FilterType.ANNOTATION, FilterType.ASPECTJ, FilterType.ASSIGNABLE, FilterType.CUSTOM, FilterType.REGEX 在后面跟classes 表明要去掉哪些包</span></span><br><span class="line"><span class="comment">//FilterType.ANNOTATION 按照注解</span></span><br><span class="line"><span class="comment">//FilterType.ASSIGNABLE_TYPE 按照给定的类型</span></span><br><span class="line"><span class="meta">@Filter(type=&quot;FilterType.ASSIGNABLE_TYPE&quot;,classes=&#123;BookService.class&#125;)</span></span><br><span class="line"><span class="comment">//FilterType.ASPECTJ 使用ASPECTJ表达式</span></span><br><span class="line"><span class="comment">//FilterType.REGEX 使用正则表达式规则</span></span><br><span class="line"><span class="comment">//FilterType.CUSTOM 给定一个TypeFilter的实现类</span></span><br><span class="line"><span class="meta">@Filter(type=FilterType.CUSTOM, classes=&#123;MyTypeFilter.class&#125;)</span> <span class="comment">//就是看MyTypeFilter里面的math返回true或者false来决定匹不匹配</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//includeFilters 扫描的时候只需要包含哪些组件，里面装着是Filter[] 注意只包含生效的条件是要禁用默认规则，默认规则是扫描所有的因此要禁用掉</span></span><br><span class="line"><span class="meta">@ComponentScan(value=&quot;com.atguigu&quot;, includeFilters = &#123;</span></span><br><span class="line"><span class="meta">  @Filter(type=&quot;FilterType.ANNOTATION&quot;,classes=&#123;Controller.class&#125;)&#125;,useDefaultFilters = false)</span></span><br><span class="line"><span class="comment">//制定扫描策略，可以写多条</span></span><br><span class="line"><span class="meta">@ComponentScans(</span></span><br><span class="line"><span class="meta">	value = &#123;</span></span><br><span class="line"><span class="meta">    @ComponentScan(value=&quot;com.atguigu&quot;, includeFilters = &#123;</span></span><br><span class="line"><span class="meta">      @Filter(type=&quot;FilterType.ANNOTATION&quot;,classes=&#123;Controller.class&#125;)&#125;,useDefaultFilters = false)</span></span><br><span class="line"><span class="meta">  &#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainConfig</span>&#123;</span><br><span class="line">  <span class="comment">//给容器中注册一个Bean; 类型为返回值的类型，id默认是方法名作为id</span></span><br><span class="line">  <span class="meta">@Bean(&quot;person&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Person <span class="title function_">person</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;lisi&quot;</span>,<span class="number">20</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MyTypeFilter.java 自定义Filter的实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTypeFilter</span> <span class="keyword">implements</span> <span class="title class_">TypeFilter</span>&#123;</span><br><span class="line">  <span class="comment">//metadatareader读取的是当前正在扫描的类的信息</span></span><br><span class="line">  <span class="comment">//MetaDataReaderFactory 可以获取到其他任何类的信息</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">math</span><span class="params">(MetadataReader metadataReader, MetaDataReaderFactory metadatareaderfactory)</span> &#123;</span><br><span class="line">    <span class="comment">//获取当前类注解的信息</span></span><br><span class="line">    <span class="type">AnnotationMetadata</span> <span class="variable">annotationMetadata</span> <span class="operator">=</span> metadataReader.getAnnotationMetadata();</span><br><span class="line">    <span class="comment">//获取当前正在扫描类的类信息</span></span><br><span class="line">    <span class="type">ClassMetadata</span> <span class="variable">classMetadata</span> <span class="operator">=</span> metadataReader.getClassMetadata();</span><br><span class="line">    <span class="comment">//获取当前类资源信息(类的路径)</span></span><br><span class="line">    <span class="type">Resource</span> <span class="variable">resource</span> <span class="operator">=</span> metadataReader.getResource();</span><br><span class="line">    <span class="comment">//classMetadata 可以获取到当前类名 当前类子类、父类类名</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用@Scope调整作用域</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//类中组件统一设置 满足当前条件，这个类中配置的所有bean注册才能生效</span></span><br><span class="line"><span class="meta">@Conditional(&#123;WindowsCondition.class&#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123;Color.class, Red.class, MyImportSelector.class, MyImportBeanDefinitionRegistrar&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainConfig2</span>&#123;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  * 默认是单实例的</span></span><br><span class="line"><span class="comment">  * ConfigurableBeanFactory#SCOPE_PROTOTYPE -&gt; &quot;prototype&quot;</span></span><br><span class="line"><span class="comment">  * ConfigurableBeanFacotry#SCOPE_SINGLETON -&gt; &quot;singleton&quot;</span></span><br><span class="line"><span class="comment">  * org.springframework.web.context.WebApplicationContext#SCOPE_REQUEST -&gt; request</span></span><br><span class="line"><span class="comment">  * org.springframework.web.context.WebApplicationContext#SCOPE_SESSION -&gt; session</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * prototype: 多实例: ioc容器启动并不会去调用方法创建对象放在容器中 每次获取的时候才会调用方法创建对象</span></span><br><span class="line"><span class="comment">  * singleton: 单实例(默认值) ioc容器启动会调用方法创建对象放到ioc容器中。以后每次获取就是直接从容器中(map.get())拿。</span></span><br><span class="line"><span class="comment">  * request: 同一请求创建一个实例</span></span><br><span class="line"><span class="comment">  * session: 同一个session创建一个实例</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * 懒加载 @Lazy</span></span><br><span class="line"><span class="comment">  * 	单实例bean:默认在容器启动的时候创建对象</span></span><br><span class="line"><span class="comment">  *   懒加载: 容器启动不创建对象。在第一次使用(获取)Bean创建对象，并初始化。</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="meta">@Scope(&quot;prototype&quot;/&quot;singleton&quot;)</span></span><br><span class="line">  <span class="meta">@Lazy</span></span><br><span class="line">  <span class="meta">@Bean(&quot;person&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Person <span class="title function_">person</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;zhangsan&quot;</span>,<span class="number">25</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@Conditional</span>(&#123;Conditon&#125;): 按照一定的条件进行判断，满足条件给容器中注册bean</span></span><br><span class="line"><span class="comment">   * 如果系统是windows，给容器中注册(&quot;bill&quot;)</span></span><br><span class="line"><span class="comment">   * 如果系统是linux，给容器中注册(&quot;linux&quot;)</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Conditional(&#123;WindowsCondition.class&#125;)</span></span><br><span class="line">  <span class="meta">@Bean(&quot;bill&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Person <span class="title function_">person01</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Bill Gates&quot;</span>,<span class="number">62</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Conditional(&#123;LinuxCondition.class&#125;)</span></span><br><span class="line">  <span class="meta">@Bean(&quot;linus&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Person <span class="title function_">person02</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;linus&quot;</span>, <span class="number">48</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * 给容器中注册组件</span></span><br><span class="line"><span class="comment">   * 1. 包扫描+标注注解(@Controller/@Service/@Service/@Repository/@Component)[自己写的]</span></span><br><span class="line"><span class="comment">   * 2. 使用@Bean[导入的第三方包的组件] --&gt; 每次导入都需要写一条 有些麻烦</span></span><br><span class="line"><span class="comment">   * 3. @Import[快速的给容器导入一个组件]</span></span><br><span class="line"><span class="comment">   * 	1. @Import(要导入的组件) //容器中就会自动注册这个组件，id默认为全类名</span></span><br><span class="line"><span class="comment">   *  2. @ImportSelector(返回需要导入的组件的全类名数组)</span></span><br><span class="line"><span class="comment">   *  3. @ImportBeanDefinitionRegistrar: 手动注册bean到容器中</span></span><br><span class="line"><span class="comment">   * 4. 使用Spring提供的FactoryBean(工厂bean)</span></span><br><span class="line"><span class="comment">   *  1. 默认获取到的是工厂bean本身调用getObject创建的对象</span></span><br><span class="line"><span class="comment">   *  2. 要获取工厂bean本身，我们需要给id前面加一个&amp;</span></span><br><span class="line"><span class="comment">   *		 &amp;colorFactoryBean</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  </span><br><span class="line">	<span class="comment">//工厂bean获取的是调用getObject方法创建的对象，直接打印显示的是ColorFactoryBean 但是调用getClass的时候返回的是Color</span></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> ColorFactoryBean <span class="title function_">colorFactoryBean</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ColorFactoryBean</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Color</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//随便创一个，假装外部组件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Color</span>&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Red</span>&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Blue</span>&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Yellow</span>&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RainBow</span>&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MyImportSelector.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义逻辑 返回需要导入的组件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyImportSelector</span> <span class="keyword">implements</span> <span class="title class_">ImportSelector</span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//返回值就是导入到容器中的组件全类名</span></span><br><span class="line">  <span class="comment">//AnnotationMetadata 当前标注@Import注解的类的所有注解信息</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String[] selectImports(AnnotationMetadata importingClassMetadata)&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//方法不要返回null</span></span><br><span class="line">    <span class="comment">//return null;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;com.bean.Blue&quot;</span>, <span class="string">&quot;com.bean.Yellow&quot;</span>&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>LinuxCondition.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//判断是否是linux系统</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinuxCondition</span> <span class="keyword">implements</span> <span class="title class_">Condition</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  * ConditionContext: 判断条件能使用的上下文(环境)</span></span><br><span class="line"><span class="comment">  * AnnotatedTypeMetadata: 注释信息</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(ConditionContext context, AnnotatedTypeMetadata metadata)</span> &#123;</span><br><span class="line">    <span class="comment">// 是否是linux系统</span></span><br><span class="line">    <span class="comment">//1、能获取到ioc使用的beanfactory</span></span><br><span class="line">    <span class="type">ConfigurableListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> context.getBeanFactory();</span><br><span class="line">    <span class="comment">//2、获取到类加载器</span></span><br><span class="line">    <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> context.getClassLoader();</span><br><span class="line">    <span class="comment">//3、获取当前环境</span></span><br><span class="line">    <span class="type">Environment</span> <span class="variable">environment</span> <span class="operator">=</span> context.getEnvironment();</span><br><span class="line">    <span class="comment">//4、获取到bean定义的注册类</span></span><br><span class="line">    <span class="type">BeanDefinitionRegistry</span> <span class="variable">registry</span> <span class="operator">=</span> context.getregistry();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//可以判断容器中的bean注册情况，也可以给容器中注册bean</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">definition</span> <span class="operator">=</span> registry.containsBeanDefinition(<span class="string">&quot;person&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="type">String</span> <span class="variable">property</span> <span class="operator">=</span> environment.getProperty(<span class="string">&quot;os.name&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(property.contains(<span class="string">&quot;Linux&quot;</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>MyImportBeanDefinitionRegistrar.java –&gt; 手工注册</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyImportBeanDefinitionRegistrar</span> <span class="keyword">implements</span> <span class="title class_">ImportBeanDefinitionRegistrar</span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * AnnotationMetadata: 当前类的注解信息</span></span><br><span class="line"><span class="comment">   * BeanDefinitionRegistry: BeanDefinition注册类</span></span><br><span class="line"><span class="comment">   * 把所有需要添加到容器中的bean， 调用 beanDefinitionRegistry.registerBeanDefinitions 手工注册 </span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">definition</span> <span class="operator">=</span> registry.containsBeanDefinition(<span class="string">&quot;Red-&gt;要写全类名&quot;</span>);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">definition2</span> <span class="operator">=</span> registry.containsBeanDefinition(<span class="string">&quot;Blue-&gt;要写全类名&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(definition &amp;&amp; definition2) &#123;</span><br><span class="line">      <span class="comment">//制定bean的定义信息 Bean的类型 Bean的scope</span></span><br><span class="line">      RootBeanDefinition beanDefinition <span class="keyword">new</span> <span class="title class_">RootBeanDefinition</span>(Rainbow.class);</span><br><span class="line">      <span class="comment">//注册一个Bean</span></span><br><span class="line">      registry.registerBeanDefinitions(<span class="string">&quot;rainBow&quot;</span>,beanDefinition);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ColorFactoryBean</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建一个spring定义的FactoryBean</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ColorFactoryBean</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;Color&gt;&#123;</span><br><span class="line">  <span class="comment">//返回一个Color对象，这个对象会添加到容器中</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Color <span class="title function_">getObject</span><span class="params">()</span> thorws Exception&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Color</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">    <span class="keyword">return</span> Color.class</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//是单例?</span></span><br><span class="line">  <span class="comment">//true 这个bean是单实例，在容器中会保存一份</span></span><br><span class="line">  <span class="comment">//false 这是一个多实例，每次获取都会创建一个新的bean -&gt; 调用getObject方法</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>WindowsCondition</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//判断是否是windows系统</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WindowsCondition</span> <span class="keyword">implements</span> <span class="title class_">Condition</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  * ConditionContext: 判断条件能使用的上下文(环境)</span></span><br><span class="line"><span class="comment">  * AnnotatedTypeMetadata: 类的注解信息</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(ConditionContext context, AnnotatedTypeMetadata metadata)</span> &#123;</span><br><span class="line">		<span class="type">Environment</span> <span class="variable">environment</span> <span class="operator">=</span> context.getEnvironment();</span><br><span class="line">    <span class="type">String</span> <span class="variable">property</span> <span class="operator">=</span> environment.getProperty(<span class="string">&quot;os.name&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(property.contains(<span class="string">&quot;Windows&quot;</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置文件--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 包扫描、只要标注了@Controller, @Service, @Repository, @Component --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- use-default-filters true表示默认允许所有 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.atguigu&quot;</span> <span class="attr">use-default-filters</span>=<span class="string">&quot;false&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:person.properties&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- init-method 和 destroy-method可以指定bean的初始化方法和销毁方法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.bean.Person&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;singleton&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;18&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zhangsan&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 开启基于注解版的切面功能 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>BookController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span>&#123;</span><br><span class="line">  <span class="meta">@AutoWired(required=false)</span> <span class="comment">// true:强制要求 false如果找不到就不装配了</span></span><br><span class="line">  <span class="keyword">private</span> BookService bookService;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BookService.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookService</span>&#123;</span><br><span class="line">  <span class="meta">@AutoWired</span></span><br><span class="line">  <span class="keyword">private</span> BookDao bookDao;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BookDao.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDao</span>&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Main 函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainTest</span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">    <span class="comment">//配置文件方式启动</span></span><br><span class="line">    <span class="comment">//返回ioc容器</span></span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">    <span class="type">Person</span> <span class="variable">bean</span> <span class="operator">=</span> (Person) applicationContext.getBean(<span class="string">&quot;person&quot;</span>);</span><br><span class="line">    System.out.println(bean);</span><br><span class="line">    <span class="comment">//配置类方式启动</span></span><br><span class="line">    <span class="type">AnnotationConfigApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(MainConfig.class);</span><br><span class="line">    <span class="type">Person</span> <span class="variable">bean</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;person&quot;</span>);</span><br><span class="line">    System.out.println(bean);</span><br><span class="line">    </span><br><span class="line">    String[] namesForType = applicationContext.getBeanNamesForType(Person.class);</span><br><span class="line">    <span class="comment">//person</span></span><br><span class="line">    <span class="keyword">for</span>(String string : namesForType) &#123;</span><br><span class="line">      System.out.println(string);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>IOCTest.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IOCTest</span>&#123;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span>&#123;</span><br><span class="line">    AnnotationConfigapplicationContext applicationContext <span class="keyword">new</span> <span class="title class_">AnnotationConfigapplicationContext</span>(MainConfig.class);</span><br><span class="line">    String[] definitionNames applicationContext.getBeanDefinitionName();</span><br><span class="line">    <span class="keyword">for</span>(String name : definitionNames) &#123;</span><br><span class="line">      System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* Output</span></span><br><span class="line"><span class="comment">     * mainConfig</span></span><br><span class="line"><span class="comment">     * bookController -&gt; 要被排除掉</span></span><br><span class="line"><span class="comment">     * bookDao</span></span><br><span class="line"><span class="comment">     * bookService -&gt; 要被排除掉</span></span><br><span class="line"><span class="comment">     * person</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span>&#123;</span><br><span class="line">    AnnotationConfigapplicationContext applicationContext <span class="keyword">new</span> <span class="title class_">AnnotationConfigapplicationContext</span>(MainConfig2.class);</span><br><span class="line">    String[] definitionNames applicationContext.getBeanDefinitionName();</span><br><span class="line">    <span class="keyword">for</span>(String name : definitionNames) &#123;</span><br><span class="line">      System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//默认是单实例的</span></span><br><span class="line">   	<span class="comment">//bean == bean2</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;person&quot;</span>);</span><br><span class="line">    <span class="type">Object</span> <span class="variable">bean2</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;person&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test03</span><span class="params">()</span>&#123;</span><br><span class="line">    AnnotationConfigapplicationContext applicationContext <span class="keyword">new</span> <span class="title class_">AnnotationConfigapplicationContext</span>(MainConfig2.class);</span><br><span class="line">    <span class="comment">//获取当前context运行环境</span></span><br><span class="line">    <span class="type">ConfigurableEnvironment</span> <span class="variable">environment</span> <span class="operator">=</span> applicationContext.getEnvironment();</span><br><span class="line">    environment.getProperty(<span class="string">&quot;os.name&quot;</span>);</span><br><span class="line">    <span class="comment">//动态获取环境变量的值</span></span><br><span class="line">    System.out.println(property);</span><br><span class="line">    </span><br><span class="line">    String[] definitionNames applicationContext.getBeanNamesForType(Person.class);</span><br><span class="line">    <span class="keyword">for</span>(String name : definitionNames) &#123;</span><br><span class="line">      System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line">    Map&lt;String, Person&gt; persons =  applicationContext.getBeansOfType(Person.class);</span><br><span class="line">    System.out.println(persons);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testImport</span><span class="params">()</span>&#123;</span><br><span class="line">    AnnotationConfigapplicationContext applicationContext <span class="keyword">new</span> <span class="title class_">AnnotationConfigapplicationContext</span>(MainConfig2.class);</span><br><span class="line">    String[] definitionNames applicationContext.getBeanDefinitionName();</span><br><span class="line">    <span class="keyword">for</span>(String name : definitionNames) &#123;</span><br><span class="line">      System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Blue</span> <span class="variable">bean</span> <span class="operator">=</span> applicationContext.getBean(Blue.class);</span><br><span class="line">    System.out.println(bean);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//工厂bean获取的是调用getObject方法创建的对象</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">bean2</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;colorFactoryBean&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;bean的类型&quot;</span> + bean2.getClass());</span><br><span class="line">    <span class="comment">//Output: color</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//通过id获取</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">bean3</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;&amp;colorFactoryBean&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;bean的类型&quot;</span> + bean3.getClass());</span><br><span class="line">    <span class="comment">//class -&gt; ColorFactoryBean</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Bean的生命周期</p>
<p>MainConfigOfLifeCycle.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* bean的生命周期</span></span><br><span class="line"><span class="comment"> *		bean的创建---初始化---销毁的过程</span></span><br><span class="line"><span class="comment"> * 容器管理bean的生命周期</span></span><br><span class="line"><span class="comment"> * 我们可以自定义初始化和销毁方法，容器在bean进行到当前生命周期的时候来调用我们自定义的初始化和销毁方法</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 构造(对象创建)</span></span><br><span class="line"><span class="comment"> * 		单实例，在容器启动的时候创建对象</span></span><br><span class="line"><span class="comment"> *		多实例，在容器获取的时候创建对象</span></span><br><span class="line"><span class="comment"> * 初始化</span></span><br><span class="line"><span class="comment"> *		对象创建完成，并赋值好，调用初始方法。。。</span></span><br><span class="line"><span class="comment"> * 销毁</span></span><br><span class="line"><span class="comment"> *		单实例bean 容器关闭的时候进行销毁</span></span><br><span class="line"><span class="comment"> *		多实例bean 容器不会管理这个bean 容器不会调用销毁方法</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 遍历得到容器中所有的BeanPostProcessor 挨个执行beforeInitialization 一旦返回null 就直接跳出for循环 不会执行后面的BeanPostProcessor.applyBeanPostProcessorsBeforeInitialization</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * BeanPostProcessor的原理</span></span><br><span class="line"><span class="comment"> * polulateBean(beanName, mbd, instanceWrapper); //给bean进行属性赋值</span></span><br><span class="line"><span class="comment"> * =&gt; initialization</span></span><br><span class="line"><span class="comment"> * &#123;</span></span><br><span class="line"><span class="comment"> * applyBeanPostProcessorsBeforeInitialization(wrappedBean, beanName);</span></span><br><span class="line"><span class="comment"> * invokeInitMethods(beanName, wrappedBean, mbd); //执行自定义初始化方法</span></span><br><span class="line"><span class="comment"> * applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName);</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 1 指定初始化和销毁方法</span></span><br><span class="line"><span class="comment"> * 		init-method 和 destroy-method 以前使用配置文件指定</span></span><br><span class="line"><span class="comment"> *    通过@Bean指定init-method和destroy-method</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 2 通过让bean实现Initializingbean来定义初始化逻辑 DisposableBean(定义销毁逻辑)</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 3 可以使用JRS250</span></span><br><span class="line"><span class="comment"> *		@PostConstruct 在bean创建完成并且属性赋值完成 来执行初始化</span></span><br><span class="line"><span class="comment"> *		@PreDestroy		 在容器销毁bean之前通知我们进行清理工作</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 4 BeanPostProcessor[interface] bean的后置处理器</span></span><br><span class="line"><span class="comment"> *		在bean初始化前后做一些处理工作-&gt;即使bean没有指定初始化方法</span></span><br><span class="line"><span class="comment"> *		postProcessBeforeInitialization: 在初始化之前进行后置处理工作</span></span><br><span class="line"><span class="comment"> *		postProcessAfterInitilization: 在初始化之后进行后置处理工作</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Spring底层对BeanPostProcessor的使用 -&gt;底层好多</span></span><br><span class="line"><span class="comment"> * 		bean的赋值 注入其他组件 @Autowired生命周期注解功能 @Async BeanPostProcessor</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.bean&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainConfigOfLifeCycle</span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@bean(initMethod=&quot;init&quot;,destroyMethod=&quot;destroy&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Car <span class="title function_">car</span><span class="params">()</span>&#123;</span><br><span class="line">  	<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Car</span>();  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MyBeanPostProcessor.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *	自定义后置处理器，初始化前后进行处理工作</span></span><br><span class="line"><span class="comment"> *	将后置处理器加入到容器中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span>&#123;</span><br><span class="line">  <span class="meta">@Override</span>	</span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean,String beanName)</span> <span class="keyword">throws</span> BeanException&#123;</span><br><span class="line">    System.out.println(beanName + <span class="string">&quot;=&gt;&quot;</span> + bean);</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">  &#125;</span><br><span class="line"> 	<span class="meta">@Override</span>	</span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitilization</span><span class="params">(Object bean,String beanName)</span> <span class="keyword">throws</span> BeanException&#123;</span><br><span class="line">    System.out.println(beanName + <span class="string">&quot;=&gt;&quot;</span> + bean);</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Car.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Car</span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Car</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;car constructor&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;car init...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">destroy</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;car destroy...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Cat.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">implements</span> <span class="title class_">InitilizingBean</span>, DisposableBean&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Cat</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;cat instructor&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;cat... destroy...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Cat... afterPropertiesSet...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Dog.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextAware</span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> ApplicationContext applicationContext;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Dog</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;dog constructor&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//对象创建并赋值之后调用</span></span><br><span class="line">  <span class="meta">@PostConstruct</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;dog @PostConstruct...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//容器移除对象之前</span></span><br><span class="line">  <span class="meta">@PreDestroy</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;dog @PostDestroy&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeanException&#123;</span><br><span class="line">    <span class="built_in">this</span>.applicationContext = applicationContext;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>IOCTest_LifeCycle.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IOCTest_LifeCycle</span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//创建ioc容器</span></span><br><span class="line">    AnnotationConfigapplicationContext applicationContext <span class="keyword">new</span> <span class="title class_">AnnotationConfigapplicationContext</span>(MainConfigOfLifeCycle.class);</span><br><span class="line">    System.out.println(<span class="string">&quot;容器创建完成&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    applicationContext.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>属性赋值</p>
<p>MainConfigOfPropertyValues.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//使用@PropertySource读取外部配置文件中的属性 保存到运行的环境变量中 加载完外部的配置文件以后再使用$&#123;&#125;取出配置文件的值</span></span><br><span class="line"><span class="meta">@PropertySource(value=&#123;&quot;classpath:/person.properties&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainConfigOfPropertyValues</span>&#123;</span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> Person <span class="title function_">person</span><span class="params">()</span>&#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Person.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">  <span class="comment">//使用@Value赋值</span></span><br><span class="line">  <span class="comment">//基本数值</span></span><br><span class="line">  <span class="comment">//可以写SpEL #&#123;&#125;</span></span><br><span class="line">  <span class="comment">//可以写$&#123;&#125; 取出配置文件中的值[properties](在运行环境变量里面的值)</span></span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Value(&quot;zhangsan&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Value(&quot;#&#123;20-2&#125;&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> Integer age;</span><br><span class="line">  <span class="meta">@Value(&quot;$&#123;person.nickName&#125;&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> String NickName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>person.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">person.nickName</span> = <span class="string">xxx</span></span><br></pre></td></tr></table></figure>

<p>IOCTest_LifeCycle.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IOCTest_PropertyValue</span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//创建ioc容器</span></span><br><span class="line">    AnnotationConfigapplicationContext applicationContext <span class="keyword">new</span> <span class="title class_">AnnotationConfigapplicationContext</span>(MainConfigOfPropertyValues.class);</span><br><span class="line">    System.out.println(<span class="string">&quot;容器创建完成&quot;</span>);</span><br><span class="line">    <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> (Person)applicationContext.getBean(<span class="string">&quot;person&quot;</span>);</span><br><span class="line">    <span class="type">ConfigurableEnvironment</span> <span class="variable">environment</span> <span class="operator">=</span> applicationContext.getEnvironment();</span><br><span class="line">    <span class="type">String</span> <span class="variable">property</span> <span class="operator">=</span> environment.getProperty(<span class="string">&quot;person.nickName&quot;</span>);</span><br><span class="line">    System.out.println(property);</span><br><span class="line">    String[] definitionNames applicationContext.getBeanDefinitionName();</span><br><span class="line">    <span class="keyword">for</span>(String name : definitionNames) &#123;</span><br><span class="line">      System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line">    applicationContext.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>自动装配</p>
<p>MainConfigAutowired.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 自动装配</span></span><br><span class="line"><span class="comment"> * 		Spring利用依赖注入(DI) 完成对IOC容器中各个组件的关系依赖赋值</span></span><br><span class="line"><span class="comment"> *		1. AutoWired 自动注入</span></span><br><span class="line"><span class="comment"> *			1. 默认优先按照类型去容器中找对应的组件，找到就赋值</span></span><br><span class="line"><span class="comment"> *			2. 如果找到相同类型的组件，再将属性的名称作为组件的id去容器中查找</span></span><br><span class="line"><span class="comment"> *					applicationContext.getBean(&quot;bookDao&quot;)</span></span><br><span class="line"><span class="comment"> *			3. @Qualifier(&quot;bookdao&quot;)使用@Qualifier指定需要装配的组件的id</span></span><br><span class="line"><span class="comment"> *			4. 自动装配默认一定要将属性赋值好，没有就报错</span></span><br><span class="line"><span class="comment"> *			5. Primary 让Spring进行自动装配的时候默认使用首选bean 这个时候不用Qualifier 但是也可以继续使用@Qualifier指定需要装配的bean的名字</span></span><br><span class="line"><span class="comment"> *		2. Spring还支持使用@Resource(JSR250)@Inject(JSR330)[Java规范的注解]</span></span><br><span class="line"><span class="comment"> *			@Resource:</span></span><br><span class="line"><span class="comment"> *				可以和Autowired一样实现自动装配功能，但是这个注解默认是按照组件名称进行装配 也可以使用@Resource(name=&quot;bookDao2&quot;)指定装配的bean</span></span><br><span class="line"><span class="comment"> *				没有支持@Primary功能没有支持@Autowired(required=false)</span></span><br><span class="line"><span class="comment"> *			@Inject:</span></span><br><span class="line"><span class="comment"> *				需要导入javax.inject的包，和Autowired功能一样</span></span><br><span class="line"><span class="comment"> *	@Autowired:Spring定义的:@Resource,@Inject都是java规范</span></span><br><span class="line"><span class="comment"> *		3. @Autowired: 构造器 参数 方法 属性 都是从容器中获取参数组件的值</span></span><br><span class="line"><span class="comment"> *			1. 标在方法位置 @Bean标注的方法，创建对象的时候 方法参数的值从容器中获取 默认不写也是一样的 都能自动装配</span></span><br><span class="line"><span class="comment"> *			2. 标在构造器上 如果组件只有一个有参构造器，这个有参构造器的@Autowired可以省略，参数位置的组件还是能够自动从容器中获取</span></span><br><span class="line"><span class="comment"> *			3. 放在参数位置上</span></span><br><span class="line"><span class="comment"> *		4. 自定义组件想要用Spring容器底层的一些组件(ApplicationContext, BeanFactory)</span></span><br><span class="line"><span class="comment"> *			自定义组件实现xxxAware 在创建对象的时候 会调用接口规定的方法注入相关组件 Aware</span></span><br><span class="line"><span class="comment"> *			把Spring底层一些组件注入到自定义的bean中</span></span><br><span class="line"><span class="comment"> *			xxxAware 功能 使用xxxProcessor来处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.service&quot;,&quot;com.dao&quot;,&quot;com.controller&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainConfigAutowired</span>&#123;</span><br><span class="line">	</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Boss.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//默认加载ioc容器中的组件 容器启动会调用无参构造器创建对象，再进行初始化赋值等操作</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Boss</span>&#123;</span><br><span class="line">  <span class="comment">//@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> Car car;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Boss</span><span class="params">(<span class="meta">@Autowired</span> Car car)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.car = car;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//@Autowired //标注在方法上 Spring容器创建当前对象 就会调用方法 完成赋值</span></span><br><span class="line">  <span class="comment">//方法使用的参数，自定义类型的值从ioc容器中获取</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCar</span><span class="params">(Car car)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.car = car;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>IOCTest_Autowired.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IOCTest_Autowired</span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//创建ioc容器</span></span><br><span class="line">    AnnotationConfigapplicationContext applicationContext <span class="keyword">new</span> <span class="title class_">AnnotationConfigapplicationContext</span>(MainConfigAutowired.class);</span><br><span class="line">    System.out.println(<span class="string">&quot;容器创建完成&quot;</span>);</span><br><span class="line">    <span class="type">BookService</span> <span class="variable">bookService</span> <span class="operator">=</span> applicationContext.getBean(BookService.class);</span><br><span class="line">    System.out.println(bookService);</span><br><span class="line">    <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> applicationContext.getBean(BookDao.class);</span><br><span class="line">    <span class="comment">//bookDao == bookService.bookDao;</span></span><br><span class="line">    applicationContext.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Profile</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Profile</span></span><br><span class="line"><span class="comment"> *		spring 为我们提供的可以根据当前环境，动态的激活和切换一系列组件的功能</span></span><br><span class="line"><span class="comment"> * 开发环境,测试环境,生产环境</span></span><br><span class="line"><span class="comment"> * 数据源,(/A)(/B)(/C)</span></span><br><span class="line"><span class="comment"> * @Profile 指定组件在哪个环境的情况下才能被注册到容器中，不指定 任何环境下都能注册这个组件</span></span><br><span class="line"><span class="comment"> *	加了环境标识的bean，只有这个环境被激活的时候才能注册到容器 默认是default 环境</span></span><br><span class="line"><span class="comment"> *	运行方法 添加运行参数 -Dspring.profiles.active=test</span></span><br><span class="line"><span class="comment"> *			代码方法 使用无参构造器</span></span><br><span class="line"><span class="comment"> *					1. 创建一个applicationContext</span></span><br><span class="line"><span class="comment"> *					2. 设置需要激活的环境</span></span><br><span class="line"><span class="comment"> *						applicationContext.getEnvironment().setActiveProfiles(&quot;test&quot;,&quot;dev&quot;);</span></span><br><span class="line"><span class="comment"> *					3. 注册主配置类</span></span><br><span class="line"><span class="comment"> *						applicationContext.register(MainConfigOfProfile.class);</span></span><br><span class="line"><span class="comment"> *					4. 启动刷新容器</span></span><br><span class="line"><span class="comment"> *						applicationContext.refresh();</span></span><br><span class="line"><span class="comment"> *	写在配置类上 只有是指定的环境的时候，整个配置类里面的所有配置才能开始生效</span></span><br><span class="line"><span class="comment"> *  没有标注环境标识的bean在，任何环境下都是加载的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:/dbconfig.proerties&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainConfigOfProfile</span> <span class="keyword">implements</span> <span class="title class_">EmbeddedValueResolverAware</span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;db.user&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> StringValueResolver valueResolver;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Profile(&quot;dev&quot;)</span></span><br><span class="line">    <span class="meta">@Bean(&quot;devDataSource&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSourceDev</span><span class="params">(<span class="meta">@Value(db.password)</span> String pwd)</span> &#123;</span><br><span class="line">        <span class="type">ComboPooledDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComboPooledDataSource</span>();</span><br><span class="line">        dataSource.setUser(user);</span><br><span class="line">        dataSource.setPassword(password);</span><br><span class="line">        dataSource.setJdbcUrc(valueResolverresolveStringValue(<span class="string">&quot;$&#123;db.driveClass&#125;&quot;</span>));</span><br><span class="line">        dataSource.setDriverClass(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Profile(&quot;test&quot;)</span></span><br><span class="line">    <span class="meta">@Bean(&quot;testDataSource&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSourceTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ComboPooledDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComboPooledDataSource</span>();</span><br><span class="line">        dataSource.setUser(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dataSource.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        dataSource.setJdbcUrc(<span class="string">&quot;jdbc:mysql://localhost:3306/&quot;</span>);</span><br><span class="line">        dataSource.setDriverClass(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Profile(&quot;prod&quot;)</span></span><br><span class="line">    <span class="meta">@Bean(&quot;prodDataSource&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSourceProd</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ComboPooledDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComboPooledDataSource</span>();</span><br><span class="line">        dataSource.setUser(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dataSource.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        dataSource.setJdbcUrc(<span class="string">&quot;jdbc:mysql://localhost:3306/&quot;</span>);</span><br><span class="line">        dataSource.setDriverClass(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setEmbeddedValueResolver</span><span class="params">(StringValueResolver resolver)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.valueResolver = resolver;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>dbconfig.proerties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">db.user</span> = <span class="string">root</span></span><br><span class="line"><span class="attr">db.password</span> = <span class="string">123456</span></span><br><span class="line"><span class="attr">db.driverClass</span> = <span class="string">com.mysql.jdbc.Driver</span></span><br></pre></td></tr></table></figure>

<p>MainConfigOfAOP.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * AOP [动态代理]</span></span><br><span class="line"><span class="comment"> *	指在程序运行期间动态的将某段代码切入到指定方法指定位置进行运行的变成方式</span></span><br><span class="line"><span class="comment"> *	1.导入AOP模块 springaop</span></span><br><span class="line"><span class="comment"> *  2.定义一个业务逻辑类(MathCalculator) 在业务逻辑运行的时候将日志进行打印，在运行方法前 运行方法结束 方法出现异常的时候 -&gt; 解耦合</span></span><br><span class="line"><span class="comment"> *  3.定义一个日志切面类(LogAspects)切面类里面的方法需要动态感知MathCalculator运行到哪里然后执行</span></span><br><span class="line"><span class="comment"> *		通知方法:</span></span><br><span class="line"><span class="comment"> *			前置通知(@Before) -&gt; logStart 在目标方法div运行之前运行</span></span><br><span class="line"><span class="comment"> *			后置通知(@After) -&gt; logEnd 在目标方法div运行结束之后运行 无论方法正常结束 异常结束 都调用</span></span><br><span class="line"><span class="comment"> *			返回通知(@AfterReturning) -&gt; logReturn 在目标方法div正常返回之后运行</span></span><br><span class="line"><span class="comment"> *			异常通知(@AfterThrowing) -&gt; logException 在目标方法运行出现异常以后运行</span></span><br><span class="line"><span class="comment"> *			环绕通知(@Around) -&gt; 动态代理, 手动推进目标方法运行(joinPoint.procced)</span></span><br><span class="line"><span class="comment"> *  4.给切面类的目标方法标注何时何地运行 通知注解</span></span><br><span class="line"><span class="comment"> *  5.将切面类和业务逻辑了(目标方法所在类)都加入到容器中</span></span><br><span class="line"><span class="comment"> *	6.必须告诉spring哪个类是切面类(给切面类上加一个注解@Aspect)</span></span><br><span class="line"><span class="comment"> *	[7]给配置类中加入@EnableAspectJAutoProxy 开启基于注解的AOP模式</span></span><br><span class="line"><span class="comment"> *		在spring中有很多的@Enablexxx 用于开启某些功能</span></span><br><span class="line"><span class="comment"> * 三步</span></span><br><span class="line"><span class="comment"> *	1) 将业务逻辑组件和切面类都加入到容器中 告诉spring哪个是切面类(@Aspect)</span></span><br><span class="line"><span class="comment"> *	2) 在切面类上的每一个通知方法上标注通知注解 告诉spring何时何地运行(切入点表达式）</span></span><br><span class="line"><span class="comment"> *	3) 开启基于注解的aop模式 @EnableAspectJAutoProxy</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * AOP原理 [看给容器中注册了什么组件 这个组件什么时候工作 这个组件工作时候的功能是什么]</span></span><br><span class="line"><span class="comment"> *		@EnableAspectJAutoProxy;</span></span><br><span class="line"><span class="comment"> *	1. @EnableAspectJAutoProxy是什么</span></span><br><span class="line"><span class="comment"> *		@Import(AspectJAutoProxyRegistar.class) 给容器中导入AspectJAutoProxyRegistar</span></span><br><span class="line"><span class="comment"> *		利用AspectJAutoProxyRegistar自定义给容器中注册bean</span></span><br><span class="line"><span class="comment"> *		internalAutoProxyCreator=AnnotationAwareAspectJAutoProxyCreator</span></span><br><span class="line"><span class="comment"> *		给容器中注册一个叫AnnotationAwareAspectJAutoProxyCreator</span></span><br><span class="line"><span class="comment"> *	2. AnnotationAwareAspectJAutoProxyCreator</span></span><br><span class="line"><span class="comment"> *		-&gt; AnnotationAwareAdvisorAspectJAutoProxyCreator</span></span><br><span class="line"><span class="comment"> *			-&gt; AspectJAwareAdvisorAutoProxyCreator</span></span><br><span class="line"><span class="comment"> *				-&gt; AbstractAdvisorAutoPorxyCreator</span></span><br><span class="line"><span class="comment"> *					-&gt; AbstractAutoProxyCreator</span></span><br><span class="line"><span class="comment"> *						implements SmartInstantiationAwareBeanPostProcessor, BeanFactoryAware</span></span><br><span class="line"><span class="comment"> *				关注后置处理器(在bean初始化完成前后做事情)，自动装配BeanFactory</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *	</span></span><br><span class="line"><span class="comment"> *	AbstractAutoProxyCreator.setBeanFactory()</span></span><br><span class="line"><span class="comment"> *	AbstractAutoProxyCreator 有后置处理器的逻辑</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  AbstractAdvisorAutoPorxyCreator.setBeanFactory() -&gt; initBeanFactory()</span></span><br><span class="line"><span class="comment"> *	AnnotationAwareAdvisorAspectJAutoProxyCreator.initBeanFactory()</span></span><br><span class="line"><span class="comment"> *	流程</span></span><br><span class="line"><span class="comment"> *		1) 传入配置类 创建ioc容器</span></span><br><span class="line"><span class="comment"> *		2) 注册配置类 调用refresh 刷新容器</span></span><br><span class="line"><span class="comment"> *		3) registerBeanPostProcessors(beanFactory);注册bean的后置处理器</span></span><br><span class="line"><span class="comment"> *			1) 先获取ioc容器中已经定义了的要创建对象的所有BeanPostProcessor</span></span><br><span class="line"><span class="comment"> *			2) 给容器中加入别的BeanPostProcessor</span></span><br><span class="line"><span class="comment"> *			3) 优先注册实现了PriorityOrdered接口的BeanPostProcessor</span></span><br><span class="line"><span class="comment"> *			4) 再给容器中注册实现了Ordered接口的BeanPostProcessor</span></span><br><span class="line"><span class="comment"> *			5) 注册没实现优先级接口的BeanPostProcessor</span></span><br><span class="line"><span class="comment"> *			6) 注册BeanPostProcessor 实际上是创建BeanPostProcessor对象 保存在容器中</span></span><br><span class="line"><span class="comment"> *			   创建internalAutoProxyCreator的BeanPostProcessor[AnnotationAwareAspectJAutoProxyCreator]</span></span><br><span class="line"><span class="comment"> *				1)创建Bean的实例</span></span><br><span class="line"><span class="comment"> *				2)populateBean 给bean的各种属性赋值</span></span><br><span class="line"><span class="comment"> *				3)initializeBean 初始化bean</span></span><br><span class="line"><span class="comment"> *					1) invokeAwareMethods 处理Aware接口的方法回调</span></span><br><span class="line"><span class="comment"> *					2) applyBeanPostProcessorBeforeInitilization() 应用后置处理器的BeforeInitilization方法</span></span><br><span class="line"><span class="comment"> *					3) invokeInitMethod 执行自定义的初始化方法</span></span><br><span class="line"><span class="comment"> *					4) applyBeanPostProcessorBeforeInitilization 执行后置处理器的AfterInitilization方法</span></span><br><span class="line"><span class="comment"> *				4)BeanPostProcessor(AnnotationAwareAspectJAutoProxyCreator)创建成功并且调用了他的 initBeanFactory方法 -&gt; advisorbuilder</span></span><br><span class="line"><span class="comment"> *			7) 把BeanPostProcessor注册到BeanFactory中</span></span><br><span class="line"><span class="comment"> *				beanFactory.addBeanPostProcessor(postProcessor)</span></span><br><span class="line"><span class="comment"> *==============以上是创建和注册AnnotationAwareAspectJAutoProxyCreator的过程===========</span></span><br><span class="line"><span class="comment"> *		AnnotationAwareAspectJAutoProxyCreator =&gt; InstantiationAwareBeanPostProcessor</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *			</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainConfigOfAOP</span>&#123;</span><br><span class="line">   </span><br><span class="line">    <span class="comment">//业务逻辑加入类中</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MathCalculator <span class="title function_">calculator</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MathCalculator</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//切面类加入到容器中</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> LogAspects <span class="title function_">logAspects</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LogAspects</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MathCalculator</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MathCalculator</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">div</span><span class="params">(<span class="type">int</span> i, intj)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> i/j;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>LogAspects.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//告诉spring当前类是切面类</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspects</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//抽取公共的切入点表达式</span></span><br><span class="line">    <span class="comment">//1. 本类引用 直接在后面写@Before(&quot;pointCut()&quot;)</span></span><br><span class="line">    <span class="comment">//2. 其他的切面类引用 使用方法全名</span></span><br><span class="line">    <span class="meta">@PointCut(&quot;execution(public int com.aop.MathCalculator.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pointCut</span><span class="params">()</span>&#123;&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//@Before在目标方法之前切入,切入点表达式(指定在哪个方法切入 可以使用通配符* means 所有方法 ..指定所有函数参数)</span></span><br><span class="line">    <span class="meta">@Before(&quot;public int com.aop.MathCalculator.*(..)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logStart</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">		Object[] args = joinPoint.getArgs();</span><br><span class="line">        System.out.println(joinPoint.getSignator().getName()+<span class="string">&quot;运行除法&quot;</span>+Arrays.asList(args));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@After(&quot;pointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logEnd</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;除法结束&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">//JoinPoint 一定要出现在参数表的第一位   @AfterReturning(value=&quot;pointCut()&quot;,returning=&quot;result&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logReturn</span><span class="params">(JointPoint joinPoint, Object result)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;除法正常返回&quot;</span>+result);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@AfterThrowing(value=&quot;pointCut()&quot;, throwing=&quot;exception&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logExpection</span><span class="params">(Exception exception)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;除法异常信息&quot;</span>)</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blobming.github.io/2020/05/08/JavaSpringNotes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Jiaming Xu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jiaming's Blog">
      <meta itemprop="description" content="Personal Life record">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Jiaming's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/08/JavaSpringNotes/" class="post-title-link" itemprop="url">JavaSpringNotes</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-05-08 19:30:58" itemprop="dateCreated datePublished" datetime="2020-05-08T19:30:58-07:00">2020-05-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>This is a personal notes for Java spring framework</p>
<div class="toc">

<!-- toc -->

<ul>
<li><a href="#spring-introduction">Spring introduction</a><ul>
<li><a href="#what-is-spring">What is spring</a></li>
<li><a href="#update-on-spring-5">Update on Spring 5</a></li>
<li><a href="#spring-core-framework">Spring Core Framework</a><ul>
<li><a href="#goals-of-spring">Goals of Spring</a></li>
<li><a href="#core-container">Core Container</a></li>
<li><a href="#infrastructure">Infrastructure</a></li>
<li><a href="#data-access-layer">Data Access Layer</a></li>
<li><a href="#web-layer">Web Layer</a></li>
<li><a href="#test-layer">Test Layer</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#inversion-of-control">Inversion of Control</a><ul>
<li><a href="#spring-container">Spring Container</a></li>
</ul>
</li>
<li><a href="#dependency-injection">Dependency Injection</a><ul>
<li><a href="#injection-types">Injection Types</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

</div>

<h1><span id="spring-introduction">Spring introduction</span><a href="#spring-introduction" class="header-anchor">#</a></h1><h2><span id="what-is-spring">What is spring</span><a href="#what-is-spring" class="header-anchor">#</a></h2><p>It is a very popular framework for building Java application and initially a simpler and light weight alternative to J2EE. Also, it provides a large number of helper classes.</p>
<h2><span id="update-on-spring-5">Update on Spring 5</span><a href="#update-on-spring-5" class="header-anchor">#</a></h2><ul>
<li>Upgraded minimum requirements for Java 8 or higher</li>
<li>Deprecated legacy integration for: Tiles, Velocity, portlet, Guava etc</li>
<li>Upgraded Spring MVC to use new versions of Servlet API 4.0</li>
<li>Added new reactive programming framework: Spring WebFlux</li>
</ul>
<h2><span id="spring-core-framework">Spring Core Framework</span><a href="#spring-core-framework" class="header-anchor">#</a></h2><h3><span id="goals-of-spring">Goals of Spring</span><a href="#goals-of-spring" class="header-anchor">#</a></h3><ul>
<li>Lightweight development with Java POJOs(Plain-Old-Java-Objects)</li>
<li>Dependency injection to promote loose coupling</li>
<li>Declarative programming with Aspect-Oriented-Programming(AOP)</li>
<li>Minimize boilerplate Java code</li>
</ul>
<h3><span id="core-container">Core Container</span><a href="#core-container" class="header-anchor">#</a></h3><p>Factory for creating beans. Manage bean dependencies.</p>
<ul>
<li>Beans<ul>
<li>A “Spring Bean” is simply a Java object. When Java objects are created by the Spring Container, then Spring refers to them as “Spring Beans”. Spring Beans are created from normal Java classes …. just like Java objects.</li>
</ul>
</li>
<li>Core</li>
<li>SpEl<ul>
<li>Spring extression language</li>
</ul>
</li>
<li>Contex</li>
</ul>
<h3><span id="infrastructure">Infrastructure</span><a href="#infrastructure" class="header-anchor">#</a></h3><p>Aspect Oriented Programming. Add functionality to objects declaratively. </p>
<p>Logging, security,transactions,etc…</p>
<ul>
<li>Aop</li>
<li>Aspects</li>
<li>Inplementation<ul>
<li>Java agents to remotely monitor your app with JMX(Java Management Extension)</li>
</ul>
</li>
<li>Messaging</li>
</ul>
<h3><span id="data-access-layer">Data Access Layer</span><a href="#data-access-layer" class="header-anchor">#</a></h3><ul>
<li>JDBC -&gt; helper classes to make easier to access Database</li>
<li>ORM -&gt; Object Relational Mapping -&gt; JPA &#x2F; Hibernate</li>
<li>Transactions</li>
<li>OXM</li>
<li>JMS (Java Message Service)<ul>
<li>For sending async messages to a Message Broker</li>
<li>Spring provides helper classes for JMS</li>
</ul>
</li>
</ul>
<h3><span id="web-layer">Web Layer</span><a href="#web-layer" class="header-anchor">#</a></h3><p>All Web related classes. Home of the Spring MVC framework.</p>
<ul>
<li>Servlet</li>
<li>WebSocket</li>
<li>Web</li>
<li>Portlet</li>
</ul>
<h3><span id="test-layer">Test Layer</span><a href="#test-layer" class="header-anchor">#</a></h3><p>Supports Test-Driven-Development(TDD). Mock objects and out-of-container testing</p>
<ul>
<li>Unit</li>
<li>Integration</li>
<li>Mock</li>
</ul>
<h1><span id="inversion-of-control">Inversion of Control</span><a href="#inversion-of-control" class="header-anchor">#</a></h1><h2><span id="spring-container">Spring Container</span><a href="#spring-container" class="header-anchor">#</a></h2><ul>
<li>Primary functions<ul>
<li>Create and manage objects(Inversion of Control)</li>
<li>Intect object’s dependencies(Dependency Injection)</li>
</ul>
</li>
<li>Configuring Spring Container<ul>
<li>XML Configuration file</li>
<li>Java Annotations</li>
<li>Java Source Code</li>
</ul>
</li>
<li>Spring container is generically known as Application Context</li>
<li>Specialized implementations<ul>
<li>ClassPathXmlApplicationContext</li>
<li>AnnotationConfigApplicationContext</li>
<li>GenericWebApplicationContext</li>
<li>Others…</li>
</ul>
</li>
</ul>
<h1><span id="dependency-injection">Dependency Injection</span><a href="#dependency-injection" class="header-anchor">#</a></h1><p>The dependency inversion principle.</p>
<p>The client delegates to calls to another object</p>
<p>the responsibility of providign its dependencies</p>
<h2><span id="injection-types">Injection Types</span><a href="#injection-types" class="header-anchor">#</a></h2><ul>
<li>There are many types of injection with Spring</li>
<li>We will cover the two most common<ul>
<li>Constructor Injection</li>
<li>Setter Injection</li>
</ul>
</li>
<li>Autowiring –&gt; discuss later</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blobming.github.io/2020/02/19/C-working-notes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Jiaming Xu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jiaming's Blog">
      <meta itemprop="description" content="Personal Life record">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Jiaming's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/02/19/C-working-notes/" class="post-title-link" itemprop="url">C#-working-notes</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-02-19 13:39:23" itemprop="dateCreated datePublished" datetime="2020-02-19T13:39:23-08:00">2020-02-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C#</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <div class="toc">

<!-- toc -->

<ul>
<li><a href="#basic-grammer">Basic grammer</a><ul>
<li><a href="#how-to-call-async-method-in-sync-method">How to call async method in sync method</a></li>
</ul>
</li>
<li><a href="#utility">Utility</a><ul>
<li><a href="#elmah">ELMAH</a></li>
<li><a href="#log4net">log4net</a></li>
<li><a href="#automapper-https-automapper-readthedocs-io-en-latest-getting-started-html">AutoMapper</a><ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#usage">Usage</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- tocstop -->

</div>

<h2><span id="basic-grammer">Basic grammer</span><a href="#basic-grammer" class="header-anchor">#</a></h2><h3><span id="how-to-call-async-method-in-sync-method">How to call async method in sync method</span><a href="#how-to-call-async-method-in-sync-method" class="header-anchor">#</a></h3><p>suppose function A() is marked as async, if we want to call A in function B, usually we use await and marked b as async. However, if we dont want to modify the return type of B. To solve that, I decide to use anonymous function to encapsulate the calling of function A, then receive the return_val of A sync.</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">B</span>()</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> asyncTask = Task.Run(<span class="keyword">async</span> () =&gt; &#123; </span><br><span class="line">        IEnumerable&lt;returnObj&gt;res = <span class="keyword">await</span> A();</span><br><span class="line">        <span class="keyword">return</span> res; &#125;);</span><br><span class="line">    asyncTask.Wait();</span><br><span class="line">    <span class="keyword">return</span> asyncTask.Result().Count();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2><span id="utility">Utility</span><a href="#utility" class="header-anchor">#</a></h2><h3><span id="elmah">ELMAH</span><a href="#elmah" class="header-anchor">#</a></h3><h3><span id="log4net">log4net</span><a href="#log4net" class="header-anchor">#</a></h3><h3><span id="automapper"></span><a href="#automapper" class="header-anchor">#</a></h3><h4><span id="introduction">Introduction</span><a href="#introduction" class="header-anchor">#</a></h4><p>AutoMapper is an object-object mapper. Object-object mapping works by transforming an input object of one type into an output object of a different type. What makes AutoMapper interesting is that it provides some interesting conventions to take the dirty work out of figuring out how to map type A to type B. As long as type B follows AutoMapper’s established convention, almost zero configuration is needed to map two types.</p>
<h4><span id="usage">Usage</span><a href="#usage" class="header-anchor">#</a></h4><p>Once you have your types you can create a map for the two types using a MapperConfiguration and CreateMap. You only need one MapperConfiguration instance typically per AppDomain and should be instantiated during startup. More examples of initial setup see in Setup.</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> config = <span class="keyword">new</span> MapperConfiguration(cfg =&gt; cfg.CreateMap&lt;Order, OrderDto&gt;());</span><br></pre></td></tr></table></figure>
<p>The type on the left is the source type, and the type on the right is the destination type. To perform a mapping, call one of the Map overloads:</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mapper = config.CreateMapper();</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="keyword">var</span> mapper = <span class="keyword">new</span> Mapper(config);</span><br><span class="line">OrderDto dto = mapper.Map&lt;OrderDto&gt;(order);</span><br></pre></td></tr></table></figure>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj2 = Mapper.Map&lt;Obj1, Obj2&gt;(obj1);</span><br><span class="line"><span class="comment">//obj1 is type of Obj1</span></span><br><span class="line"><span class="comment">//obj2 is type of Obj2</span></span><br><span class="line"><span class="comment">// it will map the same Attribute with Obj1 and Obj2 and return a new obj which type of Obj2</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Jiaming Xu</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":"enable","tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
