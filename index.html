<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blobming.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.18.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Personal Life record">
<meta property="og:type" content="website">
<meta property="og:title" content="Jiaming&#39;s Blog">
<meta property="og:url" content="https://blobming.github.io/index.html">
<meta property="og:site_name" content="Jiaming&#39;s Blog">
<meta property="og:description" content="Personal Life record">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Jiaming Xu">
<meta property="article:tag" content="Programming, Traveling">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://blobming.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Jiaming's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Jiaming's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Jiaming's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Jiaming Xu"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Jiaming Xu</p>
  <div class="site-description" itemprop="description">Personal Life record</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">22</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/blobming" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;blobming" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blobming.github.io/2021/06/03/leetcode-6-3-2021/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Jiaming Xu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jiaming's Blog">
      <meta itemprop="description" content="Personal Life record">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Jiaming's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/06/03/leetcode-6-3-2021/" class="post-title-link" itemprop="url">leetcode-6-3-2021</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-06-03 22:20:10" itemprop="dateCreated datePublished" datetime="2021-06-03T22:20:10-07:00">2021-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>This is a record of my craking process for Leetcode.</p>
<div class="toc">

<!-- toc -->

<ul>
<li><a href="#1-number-of-ways-to-paint-n-x-3-grid-1411">1. Number of Ways to Paint N × 3 Grid(#1411)</a><ul>
<li><a href="#1-1-soulution">1.1 Soulution</a></li>
</ul>
</li>
<li><a href="#2-robot-bounded-in-circle-1041">2. Robot Bounded In Circle (#1041)</a><ul>
<li><a href="#2-1-soulution">2.1 Soulution</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

</div>

<h2><span id="1-number-of-ways-to-paint-n-x-3-grid-1411">1. Number of Ways to Paint N × 3 Grid(#1411)</span><a href="#1-number-of-ways-to-paint-n-x-3-grid-1411" class="header-anchor">#</a></h2><h3><span id="1-1-soulution">1.1 Soulution</span><a href="#1-1-soulution" class="header-anchor">#</a></h3><p>Considering the base case (1 * 3) There are several possible choices. 121 212 213 232 312 313 (1 2 3 represents RGB 3 different colors). Then we can consider the next following posible choice in (2 * 3)</p>
<p>Let 121 represents head and tail have the same color and the middle pos varies</p>
<p>Let 123 represent every pos has different color</p>
<p>Then we can derive the following fomular<br>$$b_{121} &#x3D; a_{121} * 3 + a_{123} * 2$$<br>$$b_{123} &#x3D; a_{121} * 2 + a_{123} * 2$$</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">numOfWays</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">a121</span> <span class="operator">=</span> <span class="number">6</span>, a123 = <span class="number">6</span>, b121, b123, mod = (<span class="type">long</span>)<span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            b121 = a121 * <span class="number">3</span> + a123 * <span class="number">2</span>;</span><br><span class="line">            b123 = a121 * <span class="number">2</span> + a123 * <span class="number">2</span>;</span><br><span class="line">            a121 = b121 % mod;</span><br><span class="line">            a123 = b123 % mod;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">int</span>)((a121 + a123) % mod);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">num_of_ways</span>(n: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> (<span class="keyword">mut</span> r, <span class="keyword">mut</span> s) = (<span class="number">6_i64</span>, <span class="number">6_i64</span>) ; </span><br><span class="line">        <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">10_i64</span>.<span class="title function_ invoke__">pow</span>(<span class="number">9</span>) + <span class="number">7</span>; </span><br><span class="line">        <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">1</span>..n &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">_r</span> = r * <span class="number">3</span> + s * <span class="number">2</span>; </span><br><span class="line">            <span class="keyword">let</span> <span class="variable">_s</span> = r * <span class="number">2</span> + s * <span class="number">2</span>; </span><br><span class="line">            r = _r % x; </span><br><span class="line">            s = _s % x; </span><br><span class="line">        &#125;</span><br><span class="line">        ((r + s) % x) <span class="keyword">as</span> <span class="type">i32</span> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="2-robot-bounded-in-circle-1041">2. Robot Bounded In Circle (#1041)</span><a href="#2-robot-bounded-in-circle-1041" class="header-anchor">#</a></h2><h3><span id="2-1-soulution">2.1 Soulution</span><a href="#2-1-soulution" class="header-anchor">#</a></h3><p>The trick in this problem is to consider the impossible cases (The robot does not come back to original nor the bot face the initial position after iteration)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isRobotBounded</span><span class="params">(String instructions)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[][] directions = <span class="keyword">new</span> <span class="title class_">int</span>[][]&#123;&#123;<span class="number">0</span>, <span class="number">1</span>&#125;, &#123;<span class="number">1</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, -<span class="number">1</span>&#125;, &#123;-<span class="number">1</span>, <span class="number">0</span>&#125;&#125;;</span><br><span class="line">        <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">0</span>, y = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> i : instructions.toCharArray()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == <span class="string">&#x27;L&#x27;</span>)</span><br><span class="line">                idx = (idx + <span class="number">3</span>) % <span class="number">4</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (i == <span class="string">&#x27;R&#x27;</span>)</span><br><span class="line">                idx = (idx + <span class="number">1</span>) % <span class="number">4</span>;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                x += directions[idx][<span class="number">0</span>];</span><br><span class="line">                y += directions[idx][<span class="number">1</span>];</span><br><span class="line">            &#125;    </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (x == <span class="number">0</span> &amp;&amp; y == <span class="number">0</span>) || (idx != <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">is_robot_bounded</span>(instructions: <span class="type">String</span>) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">d</span> = (<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">p</span> = (<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">c</span> <span class="keyword">in</span> instructions.<span class="title function_ invoke__">chars</span>() &#123;</span><br><span class="line">            <span class="keyword">match</span> c &#123;</span><br><span class="line">                <span class="string">&#x27;G&#x27;</span> =&gt; p = (p.<span class="number">0</span> + d.<span class="number">0</span>, p.<span class="number">1</span> + d.<span class="number">1</span>),</span><br><span class="line">                <span class="string">&#x27;L&#x27;</span> =&gt; d = (-d.<span class="number">1</span>, d.<span class="number">0</span>),</span><br><span class="line">                <span class="string">&#x27;R&#x27;</span> =&gt; d = (d.<span class="number">1</span>, -d.<span class="number">0</span>),</span><br><span class="line">                _ =&gt; &#123;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        p == (<span class="number">0</span>, <span class="number">0</span>) || d != (<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blobming.github.io/2021/06/02/leetcode-6-2-2021/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Jiaming Xu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jiaming's Blog">
      <meta itemprop="description" content="Personal Life record">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Jiaming's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/06/02/leetcode-6-2-2021/" class="post-title-link" itemprop="url">leetcode-6-2-2021</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-06-02 21:18:10" itemprop="dateCreated datePublished" datetime="2021-06-02T21:18:10-07:00">2021-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>This is a record of my craking process for Leetcode.</p>
<div class="toc">

<!-- toc -->

<ul>
<li><a href="#1-leftmost-column-with-at-least-a-one-1428">1. Leftmost Column with at Least a One (#1428)</a><ul>
<li><a href="#1-1-soulution1">1.1 Soulution1</a></li>
<li><a href="#1-1-soulution2">1.1 Soulution2</a></li>
</ul>
</li>
<li><a href="#2-move-zeroes-283">2. Move Zeroes (#283)</a><ul>
<li><a href="#2-1-soulution1">2.1 Soulution1</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

</div>

<h2><span id="1-leftmost-column-with-at-least-a-one-1428">1. Leftmost Column with at Least a One (#1428)</span><a href="#1-leftmost-column-with-at-least-a-one-1428" class="header-anchor">#</a></h2><h3><span id="1-1-soulution1">1.1 Soulution1</span><a href="#1-1-soulution1" class="header-anchor">#</a></h3><p>The most simple way is two use brute-force (which takes $n^2$ time) But we can optimize it with binary-search</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">leftMostColumnWithOne</span><span class="params">(BinaryMatrix binaryMatrix)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">rows</span> <span class="operator">=</span> binaryMatrix.dimensions().get(<span class="number">0</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">columns</span> <span class="operator">=</span> binaryMatrix.dimensions().get(<span class="number">1</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> columns;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> <span class="number">0</span>; row &lt; rows; row++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">lo</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">hi</span> <span class="operator">=</span> columns - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span>(lo &lt; hi) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> lo + (hi - lo) / <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">if</span>(binaryMatrix.get(row, mid) == <span class="number">0</span>) &#123;</span><br><span class="line">                    lo = mid + <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    hi = mid;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(binaryMatrix.get(row, lo) == <span class="number">1</span>) &#123;</span><br><span class="line">                res = Math.min(lo, res);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res == columns ? -<span class="number">1</span> : res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::cmp;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">left_most_column_with_one</span>(binaryMatrix: &amp;BinaryMatrix) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">rows</span> = binaryMatrix.<span class="title function_ invoke__">dimensions</span>()[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">cols</span> = binaryMatrix.<span class="title function_ invoke__">dimensions</span>()[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">res</span> = cols;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">row</span> <span class="keyword">in</span> (<span class="number">0</span>..rows) &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">lo</span> = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">hi</span> = cols - <span class="number">1</span>;</span><br><span class="line">            <span class="title function_ invoke__">while</span>(lo &lt; hi) &#123;</span><br><span class="line">                <span class="keyword">let</span> <span class="variable">mid</span> = lo + (hi - lo) / <span class="number">2</span>;</span><br><span class="line">                <span class="title function_ invoke__">if</span>(binaryMatrix.<span class="title function_ invoke__">get</span>(row, mid) == <span class="number">0</span>) &#123;</span><br><span class="line">                    lo = mid + <span class="number">1</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    hi = mid;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title function_ invoke__">if</span>(binaryMatrix.<span class="title function_ invoke__">get</span>(row, lo) == <span class="number">1</span>) &#123;</span><br><span class="line">                res = cmp::<span class="title function_ invoke__">min</span>(res, lo);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">if</span>(res == cols)&#123;</span><br><span class="line">            -<span class="number">1</span></span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            res</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="1-1-soulution2">1.1 Soulution2</span><a href="#1-1-soulution2" class="header-anchor">#</a></h3><p>An alternate way is doing one loop (going thorugh the two-dimension table) starting from right-top corner.</p>
<p>When we reach a ‘1’ we choose to go left otherwise go down</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">leftMostColumnWithOne</span><span class="params">(BinaryMatrix binaryMatrix)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; dimensions = binaryMatrix.dimensions();</span><br><span class="line">        <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> dimensions.get(<span class="number">0</span>) - <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> dimensions.get(<span class="number">1</span>) - <span class="number">1</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (r &gt;= <span class="number">0</span> &amp;&amp; c &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (binaryMatrix.get(r, c) == <span class="number">0</span>) &#123;</span><br><span class="line">                r--;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                c--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (c == dimensions.get(<span class="number">1</span>) - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::cmp;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">left_most_column_with_one</span>(binaryMatrix: &amp;BinaryMatrix) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">rows</span> = binaryMatrix.<span class="title function_ invoke__">dimensions</span>()[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">cols</span> = binaryMatrix.<span class="title function_ invoke__">dimensions</span>()[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">current_row</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">current_col</span> = cols - <span class="number">1</span>;</span><br><span class="line">        <span class="title function_ invoke__">while</span>(current_row &lt; rows &amp;&amp; current_col &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">if</span>(binaryMatrix.<span class="title function_ invoke__">get</span>(current_row, current_col) == <span class="number">0</span>) &#123;</span><br><span class="line">                current_row += <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                current_col -= <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">if</span>(current_col == cols - <span class="number">1</span>) &#123;</span><br><span class="line">            -<span class="number">1</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            current_col + <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="2-move-zeroes-283">2. Move Zeroes (#283)</span><a href="#2-move-zeroes-283" class="header-anchor">#</a></h2><h3><span id="2-1-soulution1">2.1 Soulution1</span><a href="#2-1-soulution1" class="header-anchor">#</a></h3><p>A very straight-forward 2-point method</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">moveZeroes</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> <span class="number">0</span>, q = <span class="number">0</span>; p &lt; nums.length; p++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[p] != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> nums[p];</span><br><span class="line">                nums[p] = nums[q];</span><br><span class="line">                nums[q] = temp;</span><br><span class="line">                q++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">move_zeroes</span>(nums: &amp;<span class="keyword">mut</span> <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt;) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">i</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">j</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> i &lt; nums.<span class="title function_ invoke__">len</span>()&#123;</span><br><span class="line">            <span class="keyword">if</span> nums[i] != <span class="number">0</span>&#123;</span><br><span class="line">                <span class="keyword">let</span> <span class="variable">temp</span>: <span class="type">i32</span> = nums[j];</span><br><span class="line">                nums[j] = nums[i];</span><br><span class="line">                nums[i] = temp;</span><br><span class="line">                j += <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            i += <span class="number">1</span>; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blobming.github.io/2021/06/01/leetcode-6-1-2021/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Jiaming Xu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jiaming's Blog">
      <meta itemprop="description" content="Personal Life record">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Jiaming's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/06/01/leetcode-6-1-2021/" class="post-title-link" itemprop="url">leetcode-6-1-2021</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-06-01 22:21:52" itemprop="dateCreated datePublished" datetime="2021-06-01T22:21:52-07:00">2021-06-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>This is a record of my craking process for Leetcode.</p>
<div class="toc">

<!-- toc -->

<ul>
<li><a href="#1-pairs-of-songs-with-total-durations-divisible-by-60-1010">1. Pairs of Songs With Total Durations Divisible by 60 (#1010)</a><ul>
<li><a href="#1-1-problem-description">1.1 Problem Description</a></li>
<li><a href="#1-2-soulution">1.2 Soulution</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

</div>

<h2><span id="1-pairs-of-songs-with-total-durations-divisible-by-60-1010">1. Pairs of Songs With Total Durations Divisible by 60 (#1010)</span><a href="#1-pairs-of-songs-with-total-durations-divisible-by-60-1010" class="header-anchor">#</a></h2><h3><span id="1-1-problem-description">1.1 Problem Description</span><a href="#1-1-problem-description" class="header-anchor">#</a></h3><p>You are given a list of songs where the ith song has a duration of time[i] seconds.</p>
<p>Return the number of pairs of songs for which their total duration in seconds is divisible by 60. Formally, we want the number of indices i, j such that i &lt; j with (time[i] + time[j]) % 60 &#x3D;&#x3D; 0.</p>
<p><strong>Example 1:</strong></p>
<blockquote>
<p>Input: time &#x3D; [30,20,150,100,40]</p>
<p>Output: 3</p>
<p>Explanation: Three pairs have a total duration divisible by 60:</p>
<p>(time[0] &#x3D; 30, time[2] &#x3D; 150): total duration 180</p>
<p>(time[1] &#x3D; 20, time[3] &#x3D; 100): total duration 120</p>
<p>(time[1] &#x3D; 20, time[4] &#x3D; 40): total duration 60</p>
</blockquote>
<p><strong>Example 2:</strong></p>
<blockquote>
<p>Input: time &#x3D; [60,60,60]</p>
<p>Output: 3</p>
<p>Explanation: All three pairs have a total duration of 120, which is divisible by 60.</p>
</blockquote>
<h3><span id="1-2-soulution">1.2 Soulution</span><a href="#1-2-soulution" class="header-anchor">#</a></h3><p>The most straight-forward way to solve this problem is using two loops which takes $n^2$ time. To optimize it, we can use the same way with two sum, but do a small modification. Since we only need to output the pairs, we use an array (size of 60) to record the current value % 60. Then while in the for-loop, we can check 60 - current_value % 60, get its occurences.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">numPairsDivisibleBy60</span><span class="params">(<span class="type">int</span>[] time)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] remains = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">60</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> t : time) &#123;</span><br><span class="line">            <span class="keyword">if</span> (t % <span class="number">60</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                count += remains[<span class="number">0</span>];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                count += remains[<span class="number">60</span> - t % <span class="number">60</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            remains[t % <span class="number">60</span>]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">num_pairs_divisible_by60</span>(time: <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">remains</span> = <span class="built_in">vec!</span>[<span class="number">0</span>;<span class="number">60</span>];</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">count</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">t</span> <span class="keyword">in</span> time.<span class="title function_ invoke__">iter</span>() &#123;</span><br><span class="line">            <span class="title function_ invoke__">if</span> (t % <span class="number">60</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                count += remains[<span class="number">0</span>];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                count += remains[(<span class="number">60</span> - t % <span class="number">60</span>) <span class="keyword">as</span> <span class="type">usize</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            remains[(t % <span class="number">60</span>) <span class="keyword">as</span> <span class="type">usize</span>] += <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        count</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blobming.github.io/2021/05/21/Learning-Rust/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Jiaming Xu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jiaming's Blog">
      <meta itemprop="description" content="Personal Life record">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Jiaming's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/05/21/Learning-Rust/" class="post-title-link" itemprop="url">Learning Rust</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-05-21 10:11:46" itemprop="dateCreated datePublished" datetime="2021-05-21T10:11:46-07:00">2021-05-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Here is my personal notes for Rust</p>
<h2><span id="mutable-ref-and-immutable-ref">mutable ref and immutable ref</span><a href="#mutable-ref-and-immutable-ref" class="header-anchor">#</a></h2><p>one memory block can only have one mutable ref but it can have multiple immutable ref. Also, once a memory block has one mutable ref, all the immutable refs before that would be invalid.<br>For my understanding:<br>Mutable ref is like a “read and write” operation to memory block, while immutable ref is like a “read only” operation to the memory block. Once you have a “read and write” operation(mutable ref), all other “read only” operation(mutable ref) don’t know what happened to that memory block(might be changed by mutable block), so, the result from “read only” operation may not be valid. However, we have to re-create mutable refs.~</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blobming.github.io/2020/11/08/jvm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Jiaming Xu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jiaming's Blog">
      <meta itemprop="description" content="Personal Life record">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Jiaming's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/11/08/jvm/" class="post-title-link" itemprop="url">jvm</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-11-08 19:37:55" itemprop="dateCreated datePublished" datetime="2020-11-08T19:37:55-08:00">2020-11-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="jvm">Jvm</span><a href="#jvm" class="header-anchor">#</a></h1><h2><span id="java-ti-xi-jie-gou">Java 体系结构</span><a href="#java-ti-xi-jie-gou" class="header-anchor">#</a></h2><p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTIzNTExNTAxLnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTIzNTExNTAxLnBuZw"></p>
<h2><span id="java-de-zheng-ti-jie-gou">Java 的整体结构</span><a href="#java-de-zheng-ti-jie-gou" class="header-anchor">#</a></h2><ol>
<li>HotSpot VM是目前市面上高性能虚拟机的代表作之一。</li>
<li>它采用<strong>解释器与即时编译器并存的架构</strong>。</li>
<li>在今天，Java程序的运行性能早已脱胎换骨，已经达到了可以和C&#x2F;C++程序一较高下的地步。</li>
<li><strong>执行引擎包含三部分：解释器，即时编译器，垃圾回收器</strong></li>
</ol>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTMyMzMwNjgyLnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTMyMzMwNjgyLnBuZw"></p>
<h3><span id="java-dai-ma-zhi-xing-liu-cheng">Java 代码执行流程</span><a href="#java-dai-ma-zhi-xing-liu-cheng" class="header-anchor">#</a></h3><p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTMyMzM5MjQ2LnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTMyMzM5MjQ2LnBuZw"></p>
<h2><span id="jvm-jia-gou-mo-xing">JVM 架构模型</span><a href="#jvm-jia-gou-mo-xing" class="header-anchor">#</a></h2><p><strong>Java编译器输入的指令流基本上是一种基于栈的指令集架构</strong>，另外一种指令集架构则是基于寄存器的指令集架构。具体来说：这两种架构之间的区别：</p>
<h3><span id="ji-yu-zhan-de-zhi-ling-ji-jia-gou">基于栈的指令集架构</span><a href="#ji-yu-zhan-de-zhi-ling-ji-jia-gou" class="header-anchor">#</a></h3><ol>
<li>设计和实现更简单，适用于资源受限的系统；</li>
<li><strong>避开了寄存器的分配难题：使用零地址指令方式分配</strong></li>
<li>指令流中的指令大部分是零地址指令，其执行过程依赖于操作栈。<strong>指令集更小，编译器容易实现</strong></li>
<li><strong>不需要硬件支持，可移植性更好，更好实现跨平台</strong></li>
</ol>
<h3><span id="ji-yu-ji-cun-qi-de-zhi-ling-ji-jia-gou">基于寄存器的指令级架构</span><a href="#ji-yu-ji-cun-qi-de-zhi-ling-ji-jia-gou" class="header-anchor">#</a></h3><ol>
<li>典型的应用是x86的二进制指令集：比如传统的PC以及Android的Davlik虚拟机。</li>
<li><strong>指令集架构则完全依赖硬件，与硬件的耦合度高，可移植性差</strong></li>
<li>性能优秀和执行更高效</li>
<li>花费更少的指令去完成一项操作</li>
<li>在大部分情况下，<strong>基于寄存器架构的指令集往往都以一地址指令、二地址指令和三地址指令为主</strong>，而基于栈式架构的指令集却是以零地址指令为主</li>
</ol>
<h2><span id="fan-bian-yi-zi-jie-ma-wen-jian">反编译字节码文件</span><a href="#fan-bian-yi-zi-jie-ma-wen-jian" class="header-anchor">#</a></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javap -v StackStruTest.class</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">  public static void main(java.lang.String[]);</span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=2, locals=4, args_size=1</span><br><span class="line">         0: iconst_2	// 将常量 2 压入栈中</span><br><span class="line">         1: istore_1	// 将常量 2 保存至变量 i 中</span><br><span class="line">         2: iconst_3	// 将常量 3 压入栈中</span><br><span class="line">         3: istore_2	// 将常量 3 保存至变量 j 中</span><br><span class="line">         4: iload_1		// 加载变量 i</span><br><span class="line">         5: iload_2		// 加载变量 j</span><br><span class="line">         6: iadd		// 执行累加操作</span><br><span class="line">         7: istore_3	// 加法结果保存在变量 k 中</span><br><span class="line">         8: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 10: 0</span><br><span class="line">        line 11: 2</span><br><span class="line">        line 12: 4</span><br><span class="line">        line 22: 8</span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            0       9     0  args   [Ljava/lang/String;</span><br><span class="line">            2       7     1     i   I</span><br><span class="line">            4       5     2     j   I</span><br><span class="line">            8       1     3     k   I</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2><span id="jvm-sheng-ming-zhou-qi">JVM 生命周期</span><a href="#jvm-sheng-ming-zhou-qi" class="header-anchor">#</a></h2><h3><span id="xu-ni-ji-de-qi-dong">虚拟机的启动</span><a href="#xu-ni-ji-de-qi-dong" class="header-anchor">#</a></h3><p><strong>Java虚拟机的启动是通过引导类加载器（bootstrap class loader）创建一个初始类（initial class）来完成的</strong>，这个类是由虚拟机的具体实现指定的</p>
<h3><span id="xu-ni-ji-de-zhi-xing">虚拟机的执行</span><a href="#xu-ni-ji-de-zhi-xing" class="header-anchor">#</a></h3><ol>
<li>一个运行中的Java虚拟机有着一个清晰的任务：执行Java程序</li>
<li>程序开始执行时他才运行，程序结束时他就停止</li>
<li><strong>执行一个所谓的Java程序的时候，真真正正在执行的是一个叫做Java虚拟机的进程</strong></li>
</ol>
<h3><span id="xu-ni-ji-de-tui-chu">虚拟机的退出</span><a href="#xu-ni-ji-de-tui-chu" class="header-anchor">#</a></h3><ol>
<li>程序正常执行结束 &#x2F;&#x2F;jps 查看进程</li>
<li>程序在执行过程中遇到了异常或错误而异常终止</li>
<li>由于操作系统用现错误而导致Java虚拟机进程终止</li>
<li>某线程调用Runtime类或System类的exit()方法，或Runtime类的halt()方法，并且Java安全管理器也允许这次exit()或halt()操作。</li>
<li>除此之外，JNI（Java Native Interface）规范描述了用JNI Invocation API来加载或卸载 Java虚拟机时，Java虚拟机的退出情况。</li>
</ol>
<h1><span id="lei-jia-zai-zi-xi-tong">类加载子系统</span><a href="#lei-jia-zai-zi-xi-tong" class="header-anchor">#</a></h1><p>完整框图</p>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTQ1MzIxMjIyLnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTQ1MzIxMjIyLnBuZw"></p>
<ol>
<li><p><strong>类加载器子系统负责从文件系统或者网络中加载Class文件</strong>，class文件在文件开头有特定的文件标识。</p>
</li>
<li><p>ClassLoader只负责class文件的加载，至于它是否可以运行，则由Execution Engine决定。</p>
</li>
<li><p><strong>加载的类信息存放于一块称为方法区的内存空间</strong>。除了类的信息外，方法区中还会存放运行时常量池信息，可能还包括字符串字面量和数字常量（这部分常量信息是Class文件中常量池部分的内存映射）</p>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MDgxODEzNDA5LnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MDgxODEzNDA5LnBuZw"></p>
</li>
</ol>
<blockquote>
<p><strong>class –&gt; Java.lang.Class</strong></p>
</blockquote>
<ol>
<li><p>class file存在于本地硬盘上，可以理解为设计师画在纸上的模板，而最终这个模板在执行的时候是要加载到JVM当中来根据这个文件实例化出n个一模一样的实例。</p>
</li>
<li><p><strong>class file加载到JVM中，被称为DNA元数据模板，放在方法区</strong>。</p>
</li>
<li><p>在.class文件–&gt;JVM–&gt;最终成为元数据模板，此过程就要一个运输工具（类装载器Class Loader），扮演一个快递员的角色。</p>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MDgxOTEzNTM4LnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MDgxOTEzNTM4LnBuZw"></p>
</li>
</ol>
<h2><span id="lei-de-jia-zai-guo-cheng">类的加载过程</span><a href="#lei-de-jia-zai-guo-cheng" class="header-anchor">#</a></h2><h3><span id="lei-jia-zai-guo-cheng-gai-shu">类加载过程概述</span><a href="#lei-jia-zai-guo-cheng-gai-shu" class="header-anchor">#</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloLoader</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;谢谢ClassLoader加载我....&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;你的大恩大德，我下辈子再报！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>类的加载过程</p>
<ul>
<li><p>执行 main() 方法（静态方法）就需要先加载承载类 HelloLoader</p>
</li>
<li><p>加载成功，则进行链接、初始化等操作，完成后调用 HelloLoader 类中的静态方法 main</p>
</li>
<li><p>加载失败则抛出异常</p>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MDgyMjU1NzQ2LnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MDgyMjU1NzQ2LnBuZw"></p>
</li>
<li><p>完整的流程图如下所示：<strong>加载 –&gt; 链接（验证 –&gt; 准备 –&gt; 解析） –&gt; 初始化</strong></p>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MDgyNjAxNDQxLnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MDgyNjAxNDQxLnBuZw"></p>
</li>
</ul>
<h3><span id="jia-zai-liu-cheng">加载流程</span><a href="#jia-zai-liu-cheng" class="header-anchor">#</a></h3><ol>
<li><strong>通过一个类的全限定名获取定义此类的二进制字节流</strong></li>
<li>将这个字节流所代表的静态存储结构转化为<strong>方法区的运行时数据结构</strong></li>
<li><strong>在内存中生成一个代表这个类的java.lang.Class对象</strong>，作为方法区这个类的各种数据的访问入口</li>
</ol>
<h3><span id="jia-zai-class-wen-jian-de-fang-shi">加载class文件的方式</span><a href="#jia-zai-class-wen-jian-de-fang-shi" class="header-anchor">#</a></h3><ol>
<li>从本地系统中直接加载</li>
<li>通过网络获取，典型场景：Web Applet</li>
<li>从zip压缩包中读取，成为日后jar、war格式的基础</li>
<li>运行时计算生成，使用最多的是：动态代理技术</li>
<li>由其他文件生成，典型场景：JSP应用从专有数据库中提取.class文件，比较少见</li>
<li>从加密文件中获取，典型的防Class文件被反编译的保护措施</li>
</ol>
<h3><span id="lian-jie-jie-duan">链接阶段</span><a href="#lian-jie-jie-duan" class="header-anchor">#</a></h3><p>链接分为三个子阶段：验证 –&gt; 准备 –&gt; 解析</p>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTU0MDM5NjIwLnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTU0MDM5NjIwLnBuZw"><strong>验证</strong></p>
<ol>
<li><strong>目的在于确保Class文件的字节流中包含信息符合当前虚拟机要求，保证被加载类的正确性，不会危害虚拟机自身安全</strong></li>
<li>主要包括四种验证，文件格式验证，元数据验证，字节码验证，符号引用验证。</li>
</ol>
<p>举例</p>
<ul>
<li><p>使用 BinaryViewer 查看字节码文件，其开头均为 CAFE BABE ，如果出现不合法的字节码文件，那么将会验证不通过</p>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTU0NjUxOTY1LnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTU0NjUxOTY1LnBuZw"></p>
</li>
</ul>
<p>准备</p>
<ol>
<li><strong>为类变量分配内存并且设置该类变量的默认初始值，即零值</strong></li>
<li>这里不包含用final修饰的static，因为final在编译的时候就会分配好了默认值，准备阶段会显式初始化</li>
<li>注意：这里不会为实例变量分配初始化，类变量会分配在方法区中，而实例变量是会随着对象一起分配到Java堆中</li>
</ol>
<p>举例</p>
<ul>
<li>代码：变量a在准备阶段会赋初始值，但不是1，而是0，在初始化阶段会被赋值为 1</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloApp</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">1</span>;   <span class="comment">//prepare：a = 0 ---&gt; initial : a = 1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解析(Resolve)</p>
<p>解析</p>
<ol>
<li><strong>将常量池内的符号引用转换为直接引用的过程</strong></li>
<li>事实上，解析操作往往会伴随着JVM在执行完初始化之后再执行</li>
<li>符号引用就是一组符号来描述所引用的目标。符号引用的字面量形式明确定义在《java虚拟机规范》的class文件格式中。直接引用就是直接指向目标的指针、相对偏移量或一个间接定位到目标的句柄</li>
<li>解析动作主要针对类或接口、字段、类方法、接口方法、方法类型等。对应常量池中的CONSTANT Class info、CONSTANT Fieldref info、CONSTANT Methodref info等</li>
</ol>
<h2><span id="chu-shi-hua-jie-duan">初始化阶段</span><a href="#chu-shi-hua-jie-duan" class="header-anchor">#</a></h2><ol>
<li><strong>初始化阶段就是执行类构造器方法<code>&lt;clinit&gt;()</code>的过程</strong></li>
<li>此方法不需定义，是javac编译器自动收集类中的所有类变量的赋值动作和静态代码块中的语句合并而来。也就是说，<strong>当我们代码中包含static变量的时候，就会有clinit方法</strong></li>
<li><strong><code>&lt;clinit&gt;()</code>方法中的指令按语句在源文件中出现的顺序执行</strong></li>
<li><code>&lt;clinit&gt;()</code>不同于类的构造器。（关联：构造器是虚拟机视角下的<code>&lt;init&gt;()</code>）</li>
<li><strong>若该类具有父类，JVM会保证子类的<code>&lt;clinit&gt;()</code>执行前，父类的<code>&lt;clinit&gt;()</code>已经执行完毕</strong></li>
<li><strong>虚拟机必须保证一个类的<code>&lt;clinit&gt;()</code>方法在多线程下被同步加锁</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassInitTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> <span class="number">10</span>;      <span class="comment">//linking之prepare: number = 0 --&gt; initial: 10 --&gt; 20</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        num = <span class="number">2</span>;</span><br><span class="line">        number = <span class="number">20</span>;</span><br><span class="line">        System.out.println(num);</span><br><span class="line">        <span class="comment">//System.out.println(number);    //报错：非法的前向引用（可以赋值，但不能调用）</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(ClassInitTest.num);<span class="comment">//2</span></span><br><span class="line">        System.out.println(ClassInitTest.number);<span class="comment">//10</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>静态变量 number 的值变化过程如下</p>
<ul>
<li>准备阶段时：0</li>
<li>执行静态变量初始化：10</li>
<li>执行静态代码块：20</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">blic <span class="keyword">class</span> <span class="title class_">ClassInitTest</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">static</span>&#123;</span><br><span class="line">       num = <span class="number">2</span>;</span><br><span class="line">       number = <span class="number">20</span>;</span><br><span class="line">       System.out.println(num);</span><br><span class="line">       <span class="comment">//System.out.println(number);    //报错：非法的前向引用（可以赋值，但不能调用）</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> <span class="number">10</span>;      <span class="comment">//linking之prepare: number = 0 --&gt; initial: 20 --&gt; 10</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(ClassInitTest.num);		<span class="comment">//2</span></span><br><span class="line">        System.out.println(ClassInitTest.number);	<span class="comment">//10</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>静态变量 number 的值变化过程如下</p>
<ul>
<li>准备阶段时：0</li>
<li>执行静态代码块：20</li>
<li>执行静态变量初始化：10</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClinitTest</span> &#123;</span><br><span class="line">    <span class="comment">//任何一个类声明以后，内部至少存在一个类的构造器</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ClinitTest</span><span class="params">()</span>&#123;</span><br><span class="line">        a = <span class="number">10</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">d</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在构造器中：<ul>
<li>先将类变量 a 赋值为 10</li>
<li>再将局部变量赋值为 20</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClinitTest1</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Father</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">A</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">static</span>&#123;</span><br><span class="line">            A = <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Son</span> <span class="keyword">extends</span> <span class="title class_">Father</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">B</span> <span class="operator">=</span> A;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//加载Father类，其次加载Son类。</span></span><br><span class="line">        System.out.println(Son.B);<span class="comment">//2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如上代码，加载流程如下：</p>
<ul>
<li>首先，执行 main() 方法需要加载 ClinitTest1 类</li>
<li>获取 Son.B 静态变量，需要加载 Son 类</li>
<li>Son 类的父类是 Father 类，所以需要先执行 Father 类的加载，再执行 Son 类的加载</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeadThreadTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">r</span> <span class="operator">=</span> () -&gt; &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;开始&quot;</span>);</span><br><span class="line">            <span class="type">DeadThread</span> <span class="variable">dead</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeadThread</span>();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;结束&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(r, <span class="string">&quot;线程1&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(r, <span class="string">&quot;线程2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DeadThread</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;初始化当前类&quot;</span>);</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>程序卡死，分析原因：</p>
<ul>
<li>两个线程同时去加载 DeadThread 类，而 DeadThread 类中静态代码块中有一处死循环</li>
<li>先加载 DeadThread 类的线程抢到了同步锁，然后在类的静态代码块中执行死循环，而另一个线程在等待同步锁的释放</li>
<li>所以无论哪个线程先执行 DeadThread 类的加载，另外一个类也不会继续执行</li>
</ul>
<h2><span id="lei-jia-zai-qi-de-fen-lei">类加载器的分类</span><a href="#lei-jia-zai-qi-de-fen-lei" class="header-anchor">#</a></h2><h3><span id="lei-jia-zai-qi-gai-shu">类加载器概述</span><a href="#lei-jia-zai-qi-gai-shu" class="header-anchor">#</a></h3><p>类加载器的分类</p>
<ol>
<li><strong>JVM支持两种类型的类加载器 。分别为引导类加载器（Bootstrap ClassLoader）和自定义类加载器（User-Defined ClassLoader）</strong></li>
<li>从概念上来讲，自定义类加载器一般指的是程序中由开发人员自定义的一类类加载器，但是Java虚拟机规范却没有这么定义，而是<strong>将所有派生于抽象类ClassLoader的类加载器都划分为自定义类加载器</strong></li>
<li>无论类加载器的类型如何划分，在程序中我们最常见的类加载器始终只有3个，如下所示</li>
<li>这里的四者之间是包含关系，不是上层和下层，也不是子父类的继承关系。</li>
</ol>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MDk0MTQ5MjIzLnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MDk0MTQ5MjIzLnBuZw"></p>
<p>ExtClassLoader 继承树</p>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTcwODM3NTM4LnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTcwODM3NTM4LnBuZw"></p>
<ul>
<li>AppClassLoader 继承树<img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTcwOTE4MDM3LnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTcwOTE4MDM3LnBuZw"></li>
</ul>
<p><strong>代码</strong>：</p>
<ul>
<li>我们尝试获取引导类加载器，获取到的值为 null ，这并不代表引导类加载器不存在，<strong>因为引导类加载器右 C&#x2F;C++ 语言，我们获取不到</strong></li>
<li>两次获取系统类加载器的值都相同：sun.misc.Launcher$AppClassLoader@18b4aac2 ，这说明<strong>系统类加载器是全局唯一的</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassLoaderTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取系统类加载器</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">systemClassLoader</span> <span class="operator">=</span> ClassLoader.getSystemClassLoader();</span><br><span class="line">        System.out.println(systemClassLoader);<span class="comment">//sun.misc.Launcher$AppClassLoader@18b4aac2</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取其上层：扩展类加载器</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">extClassLoader</span> <span class="operator">=</span> systemClassLoader.getParent();</span><br><span class="line">        System.out.println(extClassLoader);<span class="comment">//sun.misc.Launcher$ExtClassLoader@1540e19d</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取其上层：获取不到引导类加载器</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">bootstrapClassLoader</span> <span class="operator">=</span> extClassLoader.getParent();</span><br><span class="line">        System.out.println(bootstrapClassLoader);<span class="comment">//null</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//对于用户自定义类来说：默认使用系统类加载器进行加载</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> ClassLoaderTest.class.getClassLoader();</span><br><span class="line">        System.out.println(classLoader);<span class="comment">//sun.misc.Launcher$AppClassLoader@18b4aac2</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//String类使用引导类加载器进行加载的。---&gt; Java的核心类库都是使用引导类加载器进行加载的。</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader1</span> <span class="operator">=</span> String.class.getClassLoader();</span><br><span class="line">        System.out.println(classLoader1);<span class="comment">//null</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3><span id="xu-ni-ji-zi-dai-de-jia-zai-qi">虚拟机自带的加载器</span><a href="#xu-ni-ji-zi-dai-de-jia-zai-qi" class="header-anchor">#</a></h3><h4><span id="qi-dong-lei-jia-zai-qi">启动类加载器</span><a href="#qi-dong-lei-jia-zai-qi" class="header-anchor">#</a></h4><p>启动类加载器（引导类加载器，Bootstrap ClassLoader）</p>
<ol>
<li><strong>这个类加载使用C&#x2F;C++语言实现的，嵌套在JVM内部</strong></li>
<li><strong>它用来加载Java的核心库（JAVA_HOME&#x2F;jre&#x2F;lib&#x2F;rt.jar、resources.jar或sun.boot.class.path路径下的内容），用于提供JVM自身需要的类</strong></li>
<li><strong>并不继承自java.lang.ClassLoader，没有父加载器</strong></li>
<li><strong>加载扩展类和应用程序类加载器，并作为他们的父类加载器（当他俩的爹）</strong></li>
<li><strong>出于安全考虑，Bootstrap启动类加载器只加载包名为java、javax、sun等开头的类</strong></li>
</ol>
<h4><span id="kuo-zhan-lei-jia-zai-qi">扩展类加载器</span><a href="#kuo-zhan-lei-jia-zai-qi" class="header-anchor">#</a></h4><p>扩展类加载器（Extension ClassLoader）</p>
<ol>
<li><strong>Java语言编写，由sun.misc.Launcher$ExtClassLoader实现</strong></li>
<li><strong>派生于ClassLoader类</strong></li>
<li><strong>父类加载器为启动类加载器</strong></li>
<li><strong>从java.ext.dirs系统属性所指定的目录中加载类库，或从JDK的安装目录的jre&#x2F;lib&#x2F;ext子目录（扩展目录）下加载类库。如果用户创建的JAR放在此目录下，也会自动由扩展类加载器加载</strong></li>
</ol>
<h4><span id="4-2-3-xi-tong-lei-jia-zai-qi">4.2.3、系统类加载器</span><a href="#4-2-3-xi-tong-lei-jia-zai-qi" class="header-anchor">#</a></h4><p>应用程序类加载器（系统类加载器，AppClassLoader）</p>
<ol>
<li><strong>Java语言编写，由sun.misc.LaunchersAppClassLoader实现</strong></li>
<li><strong>派生于ClassLoader类</strong></li>
<li><strong>父类加载器为扩展类加载器</strong></li>
<li><strong>它负责加载环境变量classpath或系统属性java.class.path指定路径下的类库</strong></li>
<li><strong>该类加载是程序中默认的类加载器，一般来说，Java应用的类都是由它来完成加载</strong></li>
<li><strong>通过classLoader.getSystemclassLoader()方法可以获取到该类加载器</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassLoaderTest1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;**********启动类加载器**************&quot;</span>);</span><br><span class="line">        <span class="comment">//获取BootstrapClassLoader能够加载的api的路径</span></span><br><span class="line">        URL[] urLs = sun.misc.Launcher.getBootstrapClassPath().getURLs();</span><br><span class="line">        <span class="keyword">for</span> (URL element : urLs) &#123;</span><br><span class="line">            System.out.println(element.toExternalForm());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//从上面的路径中随意选择一个类,来看看他的类加载器是什么:引导类加载器</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> Provider.class.getClassLoader();</span><br><span class="line">        System.out.println(classLoader);<span class="comment">//null</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;***********扩展类加载器*************&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">extDirs</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;java.ext.dirs&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String path : extDirs.split(<span class="string">&quot;;&quot;</span>)) &#123;</span><br><span class="line">            System.out.println(path);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//从上面的路径中随意选择一个类,来看看他的类加载器是什么:扩展类加载器</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader1</span> <span class="operator">=</span> CurveDB.class.getClassLoader();</span><br><span class="line">        System.out.println(classLoader1);<span class="comment">//sun.misc.Launcher$ExtClassLoader@1540e19d</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">**********启动类加载器**************</span><br><span class="line">file:/C:/Program%20Files/Java/jdk1.8.0_144/jre/lib/resources.jar</span><br><span class="line">file:/C:/Program%20Files/Java/jdk1.8.0_144/jre/lib/rt.jar</span><br><span class="line">file:/C:/Program%20Files/Java/jdk1.8.0_144/jre/lib/sunrsasign.jar</span><br><span class="line">file:/C:/Program%20Files/Java/jdk1.8.0_144/jre/lib/jsse.jar</span><br><span class="line">file:/C:/Program%20Files/Java/jdk1.8.0_144/jre/lib/jce.jar</span><br><span class="line">file:/C:/Program%20Files/Java/jdk1.8.0_144/jre/lib/charsets.jar</span><br><span class="line">file:/C:/Program%20Files/Java/jdk1.8.0_144/jre/lib/jfr.jar</span><br><span class="line">file:/C:/Program%20Files/Java/jdk1.8.0_144/jre/classes</span><br><span class="line">null</span><br><span class="line">***********扩展类加载器*************</span><br><span class="line">C:\Program Files\Java\jdk1.8.0_144\jre\lib\ext</span><br><span class="line">C:\WINDOWS\Sun\Java\lib\ext</span><br><span class="line">sun.misc.Launcher<span class="variable">$ExtClassLoader</span>@7ea987ac</span><br></pre></td></tr></table></figure>

<h3><span id="yong-hu-zi-ding-yi-lei-jia-zai-qi">用户自定义类加载器</span><a href="#yong-hu-zi-ding-yi-lei-jia-zai-qi" class="header-anchor">#</a></h3><blockquote>
<p><strong>为什么需要自定义类加载器？</strong></p>
</blockquote>
<p>在Java的日常应用程序开发中，类的加载几乎是由上述3种类加载器相互配合执行的，在必要时，我们还可以自定义类加载器，来定制类的加载方式。那为什么还需要自定义类加载器？</p>
<ol>
<li>隔离加载类</li>
<li>修改类加载的方式</li>
<li>扩展加载源</li>
<li>防止源码泄漏</li>
</ol>
<blockquote>
<p><strong>如何自定义类加载器？</strong></p>
</blockquote>
<ol>
<li>开发人员可以通过继承抽象类java.lang.ClassLoader类的方式，实现自己的类加载器，以满足一些特殊的需求</li>
<li>在JDK1.2之前，在自定义类加载器时，总会去继承ClassLoader类并重写loadClass()方法，从而实现自定义的类加载类，但是在JDK1.2之后已不再建议用户去覆盖loadClass()方法，而是建议把自定义的类加载逻辑写在findclass()方法中</li>
<li>在编写自定义类加载器时，如果没有太过于复杂的需求，可以直接继承URIClassLoader类，这样就可以避免自己去编写findclass()方法及其获取字节码流的方式，使自定义类加载器编写更加简洁。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomClassLoader</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">byte</span>[] result = getClassFromCustomPath(name);</span><br><span class="line">            <span class="keyword">if</span> (result == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FileNotFoundException</span>();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> defineClass(name, result, <span class="number">0</span>, result.length);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ClassNotFoundException</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] getClassFromCustomPath(String name) &#123;</span><br><span class="line">        <span class="comment">//从自定义路径中加载指定类:细节略</span></span><br><span class="line">        <span class="comment">//如果指定路径的字节码文件进行了加密，则需要在此方法中进行解密操作。</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">CustomClassLoader</span> <span class="variable">customClassLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CustomClassLoader</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;One&quot;</span>, <span class="literal">true</span>, customClassLoader);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> clazz.newInstance();</span><br><span class="line">            System.out.println(obj.getClass().getClassLoader());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3><span id="guan-yu-classloader">关于 ClassLoader</span><a href="#guan-yu-classloader" class="header-anchor">#</a></h3><blockquote>
<p><strong>ClassLoader 类介绍</strong></p>
</blockquote>
<ul>
<li><p>ClassLoader类，它是一个抽象类，其后所有的类加载器都继承自ClassLoader（不包括启动类加载器）</p>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MTAzNTE2MTM4LnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MTAzNTE2MTM4LnBuZw"></p>
</li>
<li><p>sun.misc.Launcher 它是一个java虚拟机的入口应用</p>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MTAzNjM2MDAzLnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MTAzNjM2MDAzLnBuZw"></p>
</li>
</ul>
<p>获取class的途径</p>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTk0MTM1MTk4LnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzI3MTk0MTM1MTk4LnBuZw"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassLoaderTest2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//1.Class.forName().getClassLoader()</span></span><br><span class="line">            <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.lang.String&quot;</span>).getClassLoader();</span><br><span class="line">            System.out.println(classLoader); <span class="comment">// String 类由启动类加载器加载，我们无法获取</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//2.Thread.currentThread().getContextClassLoader()</span></span><br><span class="line">            <span class="type">ClassLoader</span> <span class="variable">classLoader1</span> <span class="operator">=</span> Thread.currentThread().getContextClassLoader();</span><br><span class="line">            System.out.println(classLoader1);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//3.ClassLoader.getSystemClassLoader().getParent()</span></span><br><span class="line">            <span class="type">ClassLoader</span> <span class="variable">classLoader2</span> <span class="operator">=</span> ClassLoader.getSystemClassLoader();</span><br><span class="line">            System.out.println(classLoader2);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="literal">null</span></span><br><span class="line">sun.misc.Launcher$AppClassLoader@18b4aac2</span><br><span class="line">sun.misc.Launcher$AppClassLoader@18b4aac2</span><br></pre></td></tr></table></figure>

<h2><span id="shuang-qin-wei-pai-ji-zhi">双亲委派机制</span><a href="#shuang-qin-wei-pai-ji-zhi" class="header-anchor">#</a></h2><h3><span id="shuang-qin-wei-pai-ji-zhi-yuan-li">双亲委派机制原理</span><a href="#shuang-qin-wei-pai-ji-zhi-yuan-li" class="header-anchor">#</a></h3><blockquote>
<p><strong>双亲委派机制的原理</strong></p>
</blockquote>
<p><strong>Java虚拟机对class文件采用的是按需加载的方式</strong>，也就是说当需要使用该类时才会将它的class文件加载到内存生成class对象。而且<strong>加载某个类的class文件时，Java虚拟机采用的是双亲委派模式，即把请求交由父类处理，它是一种任务委派模式</strong></p>
<ol>
<li><p>如果一个类加载器收到了类加载请求，它并不会自己先去加载，而是把这个请求委托给父类的加载器去执行；</p>
</li>
<li><p>如果父类加载器还存在其父类加载器，则进一步向上委托，依次递归，请求最终将到达顶层的启动类加载器；</p>
</li>
<li><p>如果父类加载器可以完成类加载任务，就成功返回，倘若父类加载器无法完成此加载任务，子加载器才会尝试自己去加载，这就是双亲委派模式。</p>
</li>
<li><p>父类加载器一层一层往下分配任务，如果子类加载器能加载，则加载此类，如果将加载任务分配至系统类加载器也无法加载此类，则抛出异常</p>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MTA1MTUxMjU4LnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MTA1MTUxMjU4LnBuZw"></p>
</li>
</ol>
<p>Example1</p>
<ul>
<li>我们自己建立一个 java.lang.String 类，写上 static 代码块</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> java.lang;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">String</span> &#123;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;我是自定义的String类的静态代码块&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在另外的程序中加载 String 类，看看加载的 String 类是 JDK 自带的 String 类，还是我们自己编写的 String 类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        java.lang.<span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">java</span>.lang.String();</span><br><span class="line">        System.out.println(<span class="string">&quot;hello,atguigu.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">StringTest</span> <span class="variable">test</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringTest</span>();</span><br><span class="line">        System.out.println(test.getClass().getClassLoader());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>程序并没有输出我们静态代码块中的内容，可见仍然加载的是 JDK 自带的 String 类</li>
</ul>
<p>Example2</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> java.lang;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">String</span> &#123;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;我是自定义的String类的静态代码块&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//错误: 在类 java.lang.String 中找不到 main 方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello,String&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>由于双亲委派机制找到的是 JDK 自带的 String 类，在那个 String 类中并没有 main() 方法</li>
</ul>
<p>当我们加载jdbc.jar 用于实现数据库连接的时候</p>
<ol>
<li><p>首先我们需要知道的是 jdbc.jar是基于SPI接口进行实现的</p>
</li>
<li><p>所以在加载的时候，会进行双亲委派，最终从根加载器中加载 SPI核心类，然后再加载SPI接口类</p>
</li>
<li><p>接着在进行反向委托，通过线程上下文类加载器进行实现类 jdbc.jar的加载。</p>
<p><img src="/jvm/aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MTA1ODEwMTA3LnBuZw.png" alt="aHR0cDovL2hleWdvLm9zcy1jbi1zaGFuZ2hhaS5hbGl5dW5jcy5jb20vaW1hZ2VzL2ltYWdlLTIwMjAwNzA1MTA1ODEwMTA3LnBuZw"></p>
</li>
</ol>
<h3><span id="shuang-qin-wei-pai-ji-zhi-you-shi">双亲委派机制优势</span><a href="#shuang-qin-wei-pai-ji-zhi-you-shi" class="header-anchor">#</a></h3><blockquote>
<p><strong>双亲委派机制的优势</strong></p>
</blockquote>
<p>通过上面的例子，我们可以知道，双亲机制可以</p>
<ol>
<li>避免类的重复加载</li>
<li>保护程序安全，防止核心API被随意篡改<ol>
<li>自定义类：java.lang.String 没有调用</li>
<li>自定义类：java.lang.ShkStart（报错：阻止创建 java.lang开头的类）</li>
</ol>
</li>
</ol>
<p>Example：在 java.lang 包下整个 ShkStart 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> java.lang;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShkStart</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>出于保护机制，java.lang 包下不允许我们自定义类</p>
<h3><span id="sha-xiang-an-quan-ji-zhi">沙箱安全机制</span><a href="#sha-xiang-an-quan-ji-zhi" class="header-anchor">#</a></h3><p>自定义String类时：在加载自定义String类的时候会率先使用引导类加载器加载，而引导类加载器在加载的过程中会先加载jdk自带的文件（rt.jar包中java.lang.String.class），报错信息说没有main方法，就是因为加载的是rt.jar包中的String类。这样可以保证对java核心源代码的保护，这就是沙箱安全机制。</p>
<h3><span id="qi-ta">其他</span><a href="#qi-ta" class="header-anchor">#</a></h3><blockquote>
<p><strong>如何判断两个class对象是否相同？</strong></p>
</blockquote>
<p>在JVM中表示两个class对象是否为同一个类存在两个必要条件：</p>
<ol>
<li><strong>类的完整类名必须一致，包括包名</strong></li>
<li><strong>加载这个类的ClassLoader（指ClassLoader实例对象）必须相同</strong></li>
<li>换句话说，在JVM中，即使这两个类对象（class对象）来源同一个Class文件，被同一个虚拟机所加载，但只要加载它们的ClassLoader实例对象不同，那么这两个类对象也是不相等的</li>
</ol>
<blockquote>
<p><strong>对类加载器的引用</strong></p>
</blockquote>
<ol>
<li>JVM必须知道一个类型是由启动加载器加载的还是由用户类加载器加载的</li>
<li><strong>如果一个类型是由用户类加载器加载的，那么JVM会将这个类加载器的一个引用作为类型信息的一部分保存在方法区中</strong></li>
<li>当解析一个类型到另一个类型的引用的时候，JVM需要保证这两个类型的类加载器是相同的</li>
</ol>
<blockquote>
<p><strong>类的主动使用和被动使用</strong></p>
</blockquote>
<p>Java程序对类的使用方式分为：主动使用和被动使用。主动使用，又分为七种情况：</p>
<ol>
<li>创建类的实例</li>
<li>访问某个类或接口的静态变量，或者对该静态变量赋值</li>
<li>调用类的静态方法</li>
<li>反射（比如：Class.forName(“com.atguigu.Test”)）</li>
<li>初始化一个类的子类</li>
<li>Java虚拟机启动时被标明为启动类的类</li>
<li>JDK7开始提供的动态语言支持：java.lang.invoke.MethodHandle实例的解析结果REF_getStatic、REF putStatic、REF_invokeStatic句柄对应的类没有初始化，则初始化</li>
</ol>
<p>除了以上七种情况，其他使用Java类的方式都被看作是对类的被动使用，都不会导致类的初始化，即不会执行初始化阶段（不会调用 clinit() 方法和 init() 方法）</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blobming.github.io/2020/06/03/LeetCodeDailyNotes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Jiaming Xu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jiaming's Blog">
      <meta itemprop="description" content="Personal Life record">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Jiaming's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/06/03/LeetCodeDailyNotes/" class="post-title-link" itemprop="url">LeetCodeDailyNotes</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-06-03 08:18:02" itemprop="dateCreated datePublished" datetime="2020-06-03T08:18:02-07:00">2020-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Leetcode/" itemprop="url" rel="index"><span itemprop="name">Leetcode</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="leetcode-daily-notes">LeetCode Daily Notes</span><a href="#leetcode-daily-notes" class="header-anchor">#</a></h1><h2><span id="6-x2f-3-x2f-2020">6&#x2F;3&#x2F;2020</span><a href="#6-x2f-3-x2f-2020" class="header-anchor">#</a></h2><ul>
<li><p>string.trim() is used to trim leading and tailing spaces in a String</p>
</li>
<li><p>If we want to split a string by multiple spaces we can use string.split(“\\s+”)</p>
</li>
<li><p>If we want to concatenate a list of string, we can use String.join(“ “, wordList).</p>
</li>
<li><p>Lambda expression used in sorting List or Array</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">arr1.sort((a, b) -&gt; Integer.compare(a[<span class="number">1</span>] - a[<span class="number">0</span>], b[<span class="number">1</span>] - b[<span class="number">0</span>]));</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">arr1.sort(Comparator.comparingInt(a -&gt; a[<span class="number">1</span>] - a[<span class="number">0</span>]));</span><br><span class="line"><span class="comment">// or this method is more flexible</span></span><br><span class="line">arr2.sort((a, b) -&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span>(a[<span class="number">0</span>] &gt; a[<span class="number">1</span>]) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a[<span class="number">0</span>] &lt; a[<span class="number">1</span>]) &#123;</span><br><span class="line">                    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blobming.github.io/2020/05/25/Spring-Annotation-Notes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Jiaming Xu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jiaming's Blog">
      <meta itemprop="description" content="Personal Life record">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Jiaming's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/25/Spring-Annotation-Notes/" class="post-title-link" itemprop="url">Spring Annotation Notes</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-05-25 21:52:30" itemprop="dateCreated datePublished" datetime="2020-05-25T21:52:30-07:00">2020-05-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="spring-zhu-jie-qu-dong-kai-fa">Spring 注解驱动开发</span><a href="#spring-zhu-jie-qu-dong-kai-fa" class="header-anchor">#</a></h1><h2><span id="rong-qi-container">容器(Container)</span><a href="#rong-qi-container" class="header-anchor">#</a></h2><p>配置类 &#x3D;&#x3D; 配置文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//配置类</span></span><br><span class="line"><span class="meta">@Configuration</span> <span class="comment">//告诉spring这事一个配置类</span></span><br><span class="line"><span class="comment">//@ComponentScan //value表示要扫描包的位置</span></span><br><span class="line"><span class="comment">//excludeFilters 要排除哪些Component,里面装着是Filter[]</span></span><br><span class="line"><span class="meta">@ComponentScan(value=&quot;com.atguigu&quot;, excludeFilters = &#123;</span></span><br><span class="line"><span class="meta">  @Filter(type=&quot;FilterType.ANNOTATION&quot;,classes=&#123;Controller.class&#125;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="comment">//Filter的type是表明按照什么方式去排除，里面有5种,分别是：FilterType.ANNOTATION, FilterType.ASPECTJ, FilterType.ASSIGNABLE, FilterType.CUSTOM, FilterType.REGEX 在后面跟classes 表明要去掉哪些包</span></span><br><span class="line"><span class="comment">//FilterType.ANNOTATION 按照注解</span></span><br><span class="line"><span class="comment">//FilterType.ASSIGNABLE_TYPE 按照给定的类型</span></span><br><span class="line"><span class="meta">@Filter(type=&quot;FilterType.ASSIGNABLE_TYPE&quot;,classes=&#123;BookService.class&#125;)</span></span><br><span class="line"><span class="comment">//FilterType.ASPECTJ 使用ASPECTJ表达式</span></span><br><span class="line"><span class="comment">//FilterType.REGEX 使用正则表达式规则</span></span><br><span class="line"><span class="comment">//FilterType.CUSTOM 给定一个TypeFilter的实现类</span></span><br><span class="line"><span class="meta">@Filter(type=FilterType.CUSTOM, classes=&#123;MyTypeFilter.class&#125;)</span> <span class="comment">//就是看MyTypeFilter里面的math返回true或者false来决定匹不匹配</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//includeFilters 扫描的时候只需要包含哪些组件，里面装着是Filter[] 注意只包含生效的条件是要禁用默认规则，默认规则是扫描所有的因此要禁用掉</span></span><br><span class="line"><span class="meta">@ComponentScan(value=&quot;com.atguigu&quot;, includeFilters = &#123;</span></span><br><span class="line"><span class="meta">  @Filter(type=&quot;FilterType.ANNOTATION&quot;,classes=&#123;Controller.class&#125;)&#125;,useDefaultFilters = false)</span></span><br><span class="line"><span class="comment">//制定扫描策略，可以写多条</span></span><br><span class="line"><span class="meta">@ComponentScans(</span></span><br><span class="line"><span class="meta">	value = &#123;</span></span><br><span class="line"><span class="meta">    @ComponentScan(value=&quot;com.atguigu&quot;, includeFilters = &#123;</span></span><br><span class="line"><span class="meta">      @Filter(type=&quot;FilterType.ANNOTATION&quot;,classes=&#123;Controller.class&#125;)&#125;,useDefaultFilters = false)</span></span><br><span class="line"><span class="meta">  &#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainConfig</span>&#123;</span><br><span class="line">  <span class="comment">//给容器中注册一个Bean; 类型为返回值的类型，id默认是方法名作为id</span></span><br><span class="line">  <span class="meta">@Bean(&quot;person&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Person <span class="title function_">person</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;lisi&quot;</span>,<span class="number">20</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MyTypeFilter.java 自定义Filter的实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTypeFilter</span> <span class="keyword">implements</span> <span class="title class_">TypeFilter</span>&#123;</span><br><span class="line">  <span class="comment">//metadatareader读取的是当前正在扫描的类的信息</span></span><br><span class="line">  <span class="comment">//MetaDataReaderFactory 可以获取到其他任何类的信息</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">math</span><span class="params">(MetadataReader metadataReader, MetaDataReaderFactory metadatareaderfactory)</span> &#123;</span><br><span class="line">    <span class="comment">//获取当前类注解的信息</span></span><br><span class="line">    <span class="type">AnnotationMetadata</span> <span class="variable">annotationMetadata</span> <span class="operator">=</span> metadataReader.getAnnotationMetadata();</span><br><span class="line">    <span class="comment">//获取当前正在扫描类的类信息</span></span><br><span class="line">    <span class="type">ClassMetadata</span> <span class="variable">classMetadata</span> <span class="operator">=</span> metadataReader.getClassMetadata();</span><br><span class="line">    <span class="comment">//获取当前类资源信息(类的路径)</span></span><br><span class="line">    <span class="type">Resource</span> <span class="variable">resource</span> <span class="operator">=</span> metadataReader.getResource();</span><br><span class="line">    <span class="comment">//classMetadata 可以获取到当前类名 当前类子类、父类类名</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用@Scope调整作用域</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//类中组件统一设置 满足当前条件，这个类中配置的所有bean注册才能生效</span></span><br><span class="line"><span class="meta">@Conditional(&#123;WindowsCondition.class&#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123;Color.class, Red.class, MyImportSelector.class, MyImportBeanDefinitionRegistrar&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainConfig2</span>&#123;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  * 默认是单实例的</span></span><br><span class="line"><span class="comment">  * ConfigurableBeanFactory#SCOPE_PROTOTYPE -&gt; &quot;prototype&quot;</span></span><br><span class="line"><span class="comment">  * ConfigurableBeanFacotry#SCOPE_SINGLETON -&gt; &quot;singleton&quot;</span></span><br><span class="line"><span class="comment">  * org.springframework.web.context.WebApplicationContext#SCOPE_REQUEST -&gt; request</span></span><br><span class="line"><span class="comment">  * org.springframework.web.context.WebApplicationContext#SCOPE_SESSION -&gt; session</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * prototype: 多实例: ioc容器启动并不会去调用方法创建对象放在容器中 每次获取的时候才会调用方法创建对象</span></span><br><span class="line"><span class="comment">  * singleton: 单实例(默认值) ioc容器启动会调用方法创建对象放到ioc容器中。以后每次获取就是直接从容器中(map.get())拿。</span></span><br><span class="line"><span class="comment">  * request: 同一请求创建一个实例</span></span><br><span class="line"><span class="comment">  * session: 同一个session创建一个实例</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * 懒加载 @Lazy</span></span><br><span class="line"><span class="comment">  * 	单实例bean:默认在容器启动的时候创建对象</span></span><br><span class="line"><span class="comment">  *   懒加载: 容器启动不创建对象。在第一次使用(获取)Bean创建对象，并初始化。</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="meta">@Scope(&quot;prototype&quot;/&quot;singleton&quot;)</span></span><br><span class="line">  <span class="meta">@Lazy</span></span><br><span class="line">  <span class="meta">@Bean(&quot;person&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Person <span class="title function_">person</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;zhangsan&quot;</span>,<span class="number">25</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@Conditional</span>(&#123;Conditon&#125;): 按照一定的条件进行判断，满足条件给容器中注册bean</span></span><br><span class="line"><span class="comment">   * 如果系统是windows，给容器中注册(&quot;bill&quot;)</span></span><br><span class="line"><span class="comment">   * 如果系统是linux，给容器中注册(&quot;linux&quot;)</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Conditional(&#123;WindowsCondition.class&#125;)</span></span><br><span class="line">  <span class="meta">@Bean(&quot;bill&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Person <span class="title function_">person01</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Bill Gates&quot;</span>,<span class="number">62</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Conditional(&#123;LinuxCondition.class&#125;)</span></span><br><span class="line">  <span class="meta">@Bean(&quot;linus&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Person <span class="title function_">person02</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;linus&quot;</span>, <span class="number">48</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * 给容器中注册组件</span></span><br><span class="line"><span class="comment">   * 1. 包扫描+标注注解(@Controller/@Service/@Service/@Repository/@Component)[自己写的]</span></span><br><span class="line"><span class="comment">   * 2. 使用@Bean[导入的第三方包的组件] --&gt; 每次导入都需要写一条 有些麻烦</span></span><br><span class="line"><span class="comment">   * 3. @Import[快速的给容器导入一个组件]</span></span><br><span class="line"><span class="comment">   * 	1. @Import(要导入的组件) //容器中就会自动注册这个组件，id默认为全类名</span></span><br><span class="line"><span class="comment">   *  2. @ImportSelector(返回需要导入的组件的全类名数组)</span></span><br><span class="line"><span class="comment">   *  3. @ImportBeanDefinitionRegistrar: 手动注册bean到容器中</span></span><br><span class="line"><span class="comment">   * 4. 使用Spring提供的FactoryBean(工厂bean)</span></span><br><span class="line"><span class="comment">   *  1. 默认获取到的是工厂bean本身调用getObject创建的对象</span></span><br><span class="line"><span class="comment">   *  2. 要获取工厂bean本身，我们需要给id前面加一个&amp;</span></span><br><span class="line"><span class="comment">   *		 &amp;colorFactoryBean</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  </span><br><span class="line">	<span class="comment">//工厂bean获取的是调用getObject方法创建的对象，直接打印显示的是ColorFactoryBean 但是调用getClass的时候返回的是Color</span></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> ColorFactoryBean <span class="title function_">colorFactoryBean</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ColorFactoryBean</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Color</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//随便创一个，假装外部组件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Color</span>&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Red</span>&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Blue</span>&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Yellow</span>&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RainBow</span>&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MyImportSelector.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义逻辑 返回需要导入的组件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyImportSelector</span> <span class="keyword">implements</span> <span class="title class_">ImportSelector</span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//返回值就是导入到容器中的组件全类名</span></span><br><span class="line">  <span class="comment">//AnnotationMetadata 当前标注@Import注解的类的所有注解信息</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String[] selectImports(AnnotationMetadata importingClassMetadata)&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//方法不要返回null</span></span><br><span class="line">    <span class="comment">//return null;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;com.bean.Blue&quot;</span>, <span class="string">&quot;com.bean.Yellow&quot;</span>&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>LinuxCondition.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//判断是否是linux系统</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinuxCondition</span> <span class="keyword">implements</span> <span class="title class_">Condition</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  * ConditionContext: 判断条件能使用的上下文(环境)</span></span><br><span class="line"><span class="comment">  * AnnotatedTypeMetadata: 注释信息</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(ConditionContext context, AnnotatedTypeMetadata metadata)</span> &#123;</span><br><span class="line">    <span class="comment">// 是否是linux系统</span></span><br><span class="line">    <span class="comment">//1、能获取到ioc使用的beanfactory</span></span><br><span class="line">    <span class="type">ConfigurableListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> context.getBeanFactory();</span><br><span class="line">    <span class="comment">//2、获取到类加载器</span></span><br><span class="line">    <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> context.getClassLoader();</span><br><span class="line">    <span class="comment">//3、获取当前环境</span></span><br><span class="line">    <span class="type">Environment</span> <span class="variable">environment</span> <span class="operator">=</span> context.getEnvironment();</span><br><span class="line">    <span class="comment">//4、获取到bean定义的注册类</span></span><br><span class="line">    <span class="type">BeanDefinitionRegistry</span> <span class="variable">registry</span> <span class="operator">=</span> context.getregistry();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//可以判断容器中的bean注册情况，也可以给容器中注册bean</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">definition</span> <span class="operator">=</span> registry.containsBeanDefinition(<span class="string">&quot;person&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="type">String</span> <span class="variable">property</span> <span class="operator">=</span> environment.getProperty(<span class="string">&quot;os.name&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(property.contains(<span class="string">&quot;Linux&quot;</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>MyImportBeanDefinitionRegistrar.java –&gt; 手工注册</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyImportBeanDefinitionRegistrar</span> <span class="keyword">implements</span> <span class="title class_">ImportBeanDefinitionRegistrar</span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * AnnotationMetadata: 当前类的注解信息</span></span><br><span class="line"><span class="comment">   * BeanDefinitionRegistry: BeanDefinition注册类</span></span><br><span class="line"><span class="comment">   * 把所有需要添加到容器中的bean， 调用 beanDefinitionRegistry.registerBeanDefinitions 手工注册 </span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">definition</span> <span class="operator">=</span> registry.containsBeanDefinition(<span class="string">&quot;Red-&gt;要写全类名&quot;</span>);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">definition2</span> <span class="operator">=</span> registry.containsBeanDefinition(<span class="string">&quot;Blue-&gt;要写全类名&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(definition &amp;&amp; definition2) &#123;</span><br><span class="line">      <span class="comment">//制定bean的定义信息 Bean的类型 Bean的scope</span></span><br><span class="line">      RootBeanDefinition beanDefinition <span class="keyword">new</span> <span class="title class_">RootBeanDefinition</span>(Rainbow.class);</span><br><span class="line">      <span class="comment">//注册一个Bean</span></span><br><span class="line">      registry.registerBeanDefinitions(<span class="string">&quot;rainBow&quot;</span>,beanDefinition);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ColorFactoryBean</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建一个spring定义的FactoryBean</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ColorFactoryBean</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;Color&gt;&#123;</span><br><span class="line">  <span class="comment">//返回一个Color对象，这个对象会添加到容器中</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Color <span class="title function_">getObject</span><span class="params">()</span> thorws Exception&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Color</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">    <span class="keyword">return</span> Color.class</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//是单例?</span></span><br><span class="line">  <span class="comment">//true 这个bean是单实例，在容器中会保存一份</span></span><br><span class="line">  <span class="comment">//false 这是一个多实例，每次获取都会创建一个新的bean -&gt; 调用getObject方法</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>WindowsCondition</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//判断是否是windows系统</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WindowsCondition</span> <span class="keyword">implements</span> <span class="title class_">Condition</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  * ConditionContext: 判断条件能使用的上下文(环境)</span></span><br><span class="line"><span class="comment">  * AnnotatedTypeMetadata: 类的注解信息</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(ConditionContext context, AnnotatedTypeMetadata metadata)</span> &#123;</span><br><span class="line">		<span class="type">Environment</span> <span class="variable">environment</span> <span class="operator">=</span> context.getEnvironment();</span><br><span class="line">    <span class="type">String</span> <span class="variable">property</span> <span class="operator">=</span> environment.getProperty(<span class="string">&quot;os.name&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(property.contains(<span class="string">&quot;Windows&quot;</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置文件--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 包扫描、只要标注了@Controller, @Service, @Repository, @Component --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- use-default-filters true表示默认允许所有 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.atguigu&quot;</span> <span class="attr">use-default-filters</span>=<span class="string">&quot;false&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:person.properties&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- init-method 和 destroy-method可以指定bean的初始化方法和销毁方法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.bean.Person&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;singleton&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;18&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zhangsan&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 开启基于注解版的切面功能 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>BookController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span>&#123;</span><br><span class="line">  <span class="meta">@AutoWired(required=false)</span> <span class="comment">// true:强制要求 false如果找不到就不装配了</span></span><br><span class="line">  <span class="keyword">private</span> BookService bookService;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BookService.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookService</span>&#123;</span><br><span class="line">  <span class="meta">@AutoWired</span></span><br><span class="line">  <span class="keyword">private</span> BookDao bookDao;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BookDao.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDao</span>&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Main 函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainTest</span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">    <span class="comment">//配置文件方式启动</span></span><br><span class="line">    <span class="comment">//返回ioc容器</span></span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">    <span class="type">Person</span> <span class="variable">bean</span> <span class="operator">=</span> (Person) applicationContext.getBean(<span class="string">&quot;person&quot;</span>);</span><br><span class="line">    System.out.println(bean);</span><br><span class="line">    <span class="comment">//配置类方式启动</span></span><br><span class="line">    <span class="type">AnnotationConfigApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(MainConfig.class);</span><br><span class="line">    <span class="type">Person</span> <span class="variable">bean</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;person&quot;</span>);</span><br><span class="line">    System.out.println(bean);</span><br><span class="line">    </span><br><span class="line">    String[] namesForType = applicationContext.getBeanNamesForType(Person.class);</span><br><span class="line">    <span class="comment">//person</span></span><br><span class="line">    <span class="keyword">for</span>(String string : namesForType) &#123;</span><br><span class="line">      System.out.println(string);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>IOCTest.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IOCTest</span>&#123;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span>&#123;</span><br><span class="line">    AnnotationConfigapplicationContext applicationContext <span class="keyword">new</span> <span class="title class_">AnnotationConfigapplicationContext</span>(MainConfig.class);</span><br><span class="line">    String[] definitionNames applicationContext.getBeanDefinitionName();</span><br><span class="line">    <span class="keyword">for</span>(String name : definitionNames) &#123;</span><br><span class="line">      System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* Output</span></span><br><span class="line"><span class="comment">     * mainConfig</span></span><br><span class="line"><span class="comment">     * bookController -&gt; 要被排除掉</span></span><br><span class="line"><span class="comment">     * bookDao</span></span><br><span class="line"><span class="comment">     * bookService -&gt; 要被排除掉</span></span><br><span class="line"><span class="comment">     * person</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span>&#123;</span><br><span class="line">    AnnotationConfigapplicationContext applicationContext <span class="keyword">new</span> <span class="title class_">AnnotationConfigapplicationContext</span>(MainConfig2.class);</span><br><span class="line">    String[] definitionNames applicationContext.getBeanDefinitionName();</span><br><span class="line">    <span class="keyword">for</span>(String name : definitionNames) &#123;</span><br><span class="line">      System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//默认是单实例的</span></span><br><span class="line">   	<span class="comment">//bean == bean2</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;person&quot;</span>);</span><br><span class="line">    <span class="type">Object</span> <span class="variable">bean2</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;person&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test03</span><span class="params">()</span>&#123;</span><br><span class="line">    AnnotationConfigapplicationContext applicationContext <span class="keyword">new</span> <span class="title class_">AnnotationConfigapplicationContext</span>(MainConfig2.class);</span><br><span class="line">    <span class="comment">//获取当前context运行环境</span></span><br><span class="line">    <span class="type">ConfigurableEnvironment</span> <span class="variable">environment</span> <span class="operator">=</span> applicationContext.getEnvironment();</span><br><span class="line">    environment.getProperty(<span class="string">&quot;os.name&quot;</span>);</span><br><span class="line">    <span class="comment">//动态获取环境变量的值</span></span><br><span class="line">    System.out.println(property);</span><br><span class="line">    </span><br><span class="line">    String[] definitionNames applicationContext.getBeanNamesForType(Person.class);</span><br><span class="line">    <span class="keyword">for</span>(String name : definitionNames) &#123;</span><br><span class="line">      System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line">    Map&lt;String, Person&gt; persons =  applicationContext.getBeansOfType(Person.class);</span><br><span class="line">    System.out.println(persons);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testImport</span><span class="params">()</span>&#123;</span><br><span class="line">    AnnotationConfigapplicationContext applicationContext <span class="keyword">new</span> <span class="title class_">AnnotationConfigapplicationContext</span>(MainConfig2.class);</span><br><span class="line">    String[] definitionNames applicationContext.getBeanDefinitionName();</span><br><span class="line">    <span class="keyword">for</span>(String name : definitionNames) &#123;</span><br><span class="line">      System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Blue</span> <span class="variable">bean</span> <span class="operator">=</span> applicationContext.getBean(Blue.class);</span><br><span class="line">    System.out.println(bean);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//工厂bean获取的是调用getObject方法创建的对象</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">bean2</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;colorFactoryBean&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;bean的类型&quot;</span> + bean2.getClass());</span><br><span class="line">    <span class="comment">//Output: color</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//通过id获取</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">bean3</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;&amp;colorFactoryBean&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;bean的类型&quot;</span> + bean3.getClass());</span><br><span class="line">    <span class="comment">//class -&gt; ColorFactoryBean</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Bean的生命周期</p>
<p>MainConfigOfLifeCycle.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* bean的生命周期</span></span><br><span class="line"><span class="comment"> *		bean的创建---初始化---销毁的过程</span></span><br><span class="line"><span class="comment"> * 容器管理bean的生命周期</span></span><br><span class="line"><span class="comment"> * 我们可以自定义初始化和销毁方法，容器在bean进行到当前生命周期的时候来调用我们自定义的初始化和销毁方法</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 构造(对象创建)</span></span><br><span class="line"><span class="comment"> * 		单实例，在容器启动的时候创建对象</span></span><br><span class="line"><span class="comment"> *		多实例，在容器获取的时候创建对象</span></span><br><span class="line"><span class="comment"> * 初始化</span></span><br><span class="line"><span class="comment"> *		对象创建完成，并赋值好，调用初始方法。。。</span></span><br><span class="line"><span class="comment"> * 销毁</span></span><br><span class="line"><span class="comment"> *		单实例bean 容器关闭的时候进行销毁</span></span><br><span class="line"><span class="comment"> *		多实例bean 容器不会管理这个bean 容器不会调用销毁方法</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 遍历得到容器中所有的BeanPostProcessor 挨个执行beforeInitialization 一旦返回null 就直接跳出for循环 不会执行后面的BeanPostProcessor.applyBeanPostProcessorsBeforeInitialization</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * BeanPostProcessor的原理</span></span><br><span class="line"><span class="comment"> * polulateBean(beanName, mbd, instanceWrapper); //给bean进行属性赋值</span></span><br><span class="line"><span class="comment"> * =&gt; initialization</span></span><br><span class="line"><span class="comment"> * &#123;</span></span><br><span class="line"><span class="comment"> * applyBeanPostProcessorsBeforeInitialization(wrappedBean, beanName);</span></span><br><span class="line"><span class="comment"> * invokeInitMethods(beanName, wrappedBean, mbd); //执行自定义初始化方法</span></span><br><span class="line"><span class="comment"> * applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName);</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 1 指定初始化和销毁方法</span></span><br><span class="line"><span class="comment"> * 		init-method 和 destroy-method 以前使用配置文件指定</span></span><br><span class="line"><span class="comment"> *    通过@Bean指定init-method和destroy-method</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 2 通过让bean实现Initializingbean来定义初始化逻辑 DisposableBean(定义销毁逻辑)</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 3 可以使用JRS250</span></span><br><span class="line"><span class="comment"> *		@PostConstruct 在bean创建完成并且属性赋值完成 来执行初始化</span></span><br><span class="line"><span class="comment"> *		@PreDestroy		 在容器销毁bean之前通知我们进行清理工作</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 4 BeanPostProcessor[interface] bean的后置处理器</span></span><br><span class="line"><span class="comment"> *		在bean初始化前后做一些处理工作-&gt;即使bean没有指定初始化方法</span></span><br><span class="line"><span class="comment"> *		postProcessBeforeInitialization: 在初始化之前进行后置处理工作</span></span><br><span class="line"><span class="comment"> *		postProcessAfterInitilization: 在初始化之后进行后置处理工作</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Spring底层对BeanPostProcessor的使用 -&gt;底层好多</span></span><br><span class="line"><span class="comment"> * 		bean的赋值 注入其他组件 @Autowired生命周期注解功能 @Async BeanPostProcessor</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.bean&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainConfigOfLifeCycle</span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@bean(initMethod=&quot;init&quot;,destroyMethod=&quot;destroy&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Car <span class="title function_">car</span><span class="params">()</span>&#123;</span><br><span class="line">  	<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Car</span>();  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MyBeanPostProcessor.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *	自定义后置处理器，初始化前后进行处理工作</span></span><br><span class="line"><span class="comment"> *	将后置处理器加入到容器中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span>&#123;</span><br><span class="line">  <span class="meta">@Override</span>	</span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean,String beanName)</span> <span class="keyword">throws</span> BeanException&#123;</span><br><span class="line">    System.out.println(beanName + <span class="string">&quot;=&gt;&quot;</span> + bean);</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">  &#125;</span><br><span class="line"> 	<span class="meta">@Override</span>	</span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitilization</span><span class="params">(Object bean,String beanName)</span> <span class="keyword">throws</span> BeanException&#123;</span><br><span class="line">    System.out.println(beanName + <span class="string">&quot;=&gt;&quot;</span> + bean);</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Car.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Car</span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Car</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;car constructor&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;car init...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">destroy</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;car destroy...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Cat.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">implements</span> <span class="title class_">InitilizingBean</span>, DisposableBean&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Cat</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;cat instructor&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;cat... destroy...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Cat... afterPropertiesSet...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Dog.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextAware</span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> ApplicationContext applicationContext;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Dog</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;dog constructor&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//对象创建并赋值之后调用</span></span><br><span class="line">  <span class="meta">@PostConstruct</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;dog @PostConstruct...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//容器移除对象之前</span></span><br><span class="line">  <span class="meta">@PreDestroy</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;dog @PostDestroy&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeanException&#123;</span><br><span class="line">    <span class="built_in">this</span>.applicationContext = applicationContext;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>IOCTest_LifeCycle.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IOCTest_LifeCycle</span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//创建ioc容器</span></span><br><span class="line">    AnnotationConfigapplicationContext applicationContext <span class="keyword">new</span> <span class="title class_">AnnotationConfigapplicationContext</span>(MainConfigOfLifeCycle.class);</span><br><span class="line">    System.out.println(<span class="string">&quot;容器创建完成&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    applicationContext.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>属性赋值</p>
<p>MainConfigOfPropertyValues.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//使用@PropertySource读取外部配置文件中的属性 保存到运行的环境变量中 加载完外部的配置文件以后再使用$&#123;&#125;取出配置文件的值</span></span><br><span class="line"><span class="meta">@PropertySource(value=&#123;&quot;classpath:/person.properties&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainConfigOfPropertyValues</span>&#123;</span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> Person <span class="title function_">person</span><span class="params">()</span>&#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Person.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">  <span class="comment">//使用@Value赋值</span></span><br><span class="line">  <span class="comment">//基本数值</span></span><br><span class="line">  <span class="comment">//可以写SpEL #&#123;&#125;</span></span><br><span class="line">  <span class="comment">//可以写$&#123;&#125; 取出配置文件中的值[properties](在运行环境变量里面的值)</span></span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Value(&quot;zhangsan&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Value(&quot;#&#123;20-2&#125;&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> Integer age;</span><br><span class="line">  <span class="meta">@Value(&quot;$&#123;person.nickName&#125;&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> String NickName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>person.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">person.nickName</span> = <span class="string">xxx</span></span><br></pre></td></tr></table></figure>

<p>IOCTest_LifeCycle.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IOCTest_PropertyValue</span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//创建ioc容器</span></span><br><span class="line">    AnnotationConfigapplicationContext applicationContext <span class="keyword">new</span> <span class="title class_">AnnotationConfigapplicationContext</span>(MainConfigOfPropertyValues.class);</span><br><span class="line">    System.out.println(<span class="string">&quot;容器创建完成&quot;</span>);</span><br><span class="line">    <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> (Person)applicationContext.getBean(<span class="string">&quot;person&quot;</span>);</span><br><span class="line">    <span class="type">ConfigurableEnvironment</span> <span class="variable">environment</span> <span class="operator">=</span> applicationContext.getEnvironment();</span><br><span class="line">    <span class="type">String</span> <span class="variable">property</span> <span class="operator">=</span> environment.getProperty(<span class="string">&quot;person.nickName&quot;</span>);</span><br><span class="line">    System.out.println(property);</span><br><span class="line">    String[] definitionNames applicationContext.getBeanDefinitionName();</span><br><span class="line">    <span class="keyword">for</span>(String name : definitionNames) &#123;</span><br><span class="line">      System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line">    applicationContext.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>自动装配</p>
<p>MainConfigAutowired.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 自动装配</span></span><br><span class="line"><span class="comment"> * 		Spring利用依赖注入(DI) 完成对IOC容器中各个组件的关系依赖赋值</span></span><br><span class="line"><span class="comment"> *		1. AutoWired 自动注入</span></span><br><span class="line"><span class="comment"> *			1. 默认优先按照类型去容器中找对应的组件，找到就赋值</span></span><br><span class="line"><span class="comment"> *			2. 如果找到相同类型的组件，再将属性的名称作为组件的id去容器中查找</span></span><br><span class="line"><span class="comment"> *					applicationContext.getBean(&quot;bookDao&quot;)</span></span><br><span class="line"><span class="comment"> *			3. @Qualifier(&quot;bookdao&quot;)使用@Qualifier指定需要装配的组件的id</span></span><br><span class="line"><span class="comment"> *			4. 自动装配默认一定要将属性赋值好，没有就报错</span></span><br><span class="line"><span class="comment"> *			5. Primary 让Spring进行自动装配的时候默认使用首选bean 这个时候不用Qualifier 但是也可以继续使用@Qualifier指定需要装配的bean的名字</span></span><br><span class="line"><span class="comment"> *		2. Spring还支持使用@Resource(JSR250)@Inject(JSR330)[Java规范的注解]</span></span><br><span class="line"><span class="comment"> *			@Resource:</span></span><br><span class="line"><span class="comment"> *				可以和Autowired一样实现自动装配功能，但是这个注解默认是按照组件名称进行装配 也可以使用@Resource(name=&quot;bookDao2&quot;)指定装配的bean</span></span><br><span class="line"><span class="comment"> *				没有支持@Primary功能没有支持@Autowired(required=false)</span></span><br><span class="line"><span class="comment"> *			@Inject:</span></span><br><span class="line"><span class="comment"> *				需要导入javax.inject的包，和Autowired功能一样</span></span><br><span class="line"><span class="comment"> *	@Autowired:Spring定义的:@Resource,@Inject都是java规范</span></span><br><span class="line"><span class="comment"> *		3. @Autowired: 构造器 参数 方法 属性 都是从容器中获取参数组件的值</span></span><br><span class="line"><span class="comment"> *			1. 标在方法位置 @Bean标注的方法，创建对象的时候 方法参数的值从容器中获取 默认不写也是一样的 都能自动装配</span></span><br><span class="line"><span class="comment"> *			2. 标在构造器上 如果组件只有一个有参构造器，这个有参构造器的@Autowired可以省略，参数位置的组件还是能够自动从容器中获取</span></span><br><span class="line"><span class="comment"> *			3. 放在参数位置上</span></span><br><span class="line"><span class="comment"> *		4. 自定义组件想要用Spring容器底层的一些组件(ApplicationContext, BeanFactory)</span></span><br><span class="line"><span class="comment"> *			自定义组件实现xxxAware 在创建对象的时候 会调用接口规定的方法注入相关组件 Aware</span></span><br><span class="line"><span class="comment"> *			把Spring底层一些组件注入到自定义的bean中</span></span><br><span class="line"><span class="comment"> *			xxxAware 功能 使用xxxProcessor来处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.service&quot;,&quot;com.dao&quot;,&quot;com.controller&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainConfigAutowired</span>&#123;</span><br><span class="line">	</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Boss.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//默认加载ioc容器中的组件 容器启动会调用无参构造器创建对象，再进行初始化赋值等操作</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Boss</span>&#123;</span><br><span class="line">  <span class="comment">//@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> Car car;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Boss</span><span class="params">(<span class="meta">@Autowired</span> Car car)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.car = car;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//@Autowired //标注在方法上 Spring容器创建当前对象 就会调用方法 完成赋值</span></span><br><span class="line">  <span class="comment">//方法使用的参数，自定义类型的值从ioc容器中获取</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCar</span><span class="params">(Car car)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.car = car;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>IOCTest_Autowired.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IOCTest_Autowired</span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//创建ioc容器</span></span><br><span class="line">    AnnotationConfigapplicationContext applicationContext <span class="keyword">new</span> <span class="title class_">AnnotationConfigapplicationContext</span>(MainConfigAutowired.class);</span><br><span class="line">    System.out.println(<span class="string">&quot;容器创建完成&quot;</span>);</span><br><span class="line">    <span class="type">BookService</span> <span class="variable">bookService</span> <span class="operator">=</span> applicationContext.getBean(BookService.class);</span><br><span class="line">    System.out.println(bookService);</span><br><span class="line">    <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> applicationContext.getBean(BookDao.class);</span><br><span class="line">    <span class="comment">//bookDao == bookService.bookDao;</span></span><br><span class="line">    applicationContext.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Profile</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Profile</span></span><br><span class="line"><span class="comment"> *		spring 为我们提供的可以根据当前环境，动态的激活和切换一系列组件的功能</span></span><br><span class="line"><span class="comment"> * 开发环境,测试环境,生产环境</span></span><br><span class="line"><span class="comment"> * 数据源,(/A)(/B)(/C)</span></span><br><span class="line"><span class="comment"> * @Profile 指定组件在哪个环境的情况下才能被注册到容器中，不指定 任何环境下都能注册这个组件</span></span><br><span class="line"><span class="comment"> *	加了环境标识的bean，只有这个环境被激活的时候才能注册到容器 默认是default 环境</span></span><br><span class="line"><span class="comment"> *	运行方法 添加运行参数 -Dspring.profiles.active=test</span></span><br><span class="line"><span class="comment"> *			代码方法 使用无参构造器</span></span><br><span class="line"><span class="comment"> *					1. 创建一个applicationContext</span></span><br><span class="line"><span class="comment"> *					2. 设置需要激活的环境</span></span><br><span class="line"><span class="comment"> *						applicationContext.getEnvironment().setActiveProfiles(&quot;test&quot;,&quot;dev&quot;);</span></span><br><span class="line"><span class="comment"> *					3. 注册主配置类</span></span><br><span class="line"><span class="comment"> *						applicationContext.register(MainConfigOfProfile.class);</span></span><br><span class="line"><span class="comment"> *					4. 启动刷新容器</span></span><br><span class="line"><span class="comment"> *						applicationContext.refresh();</span></span><br><span class="line"><span class="comment"> *	写在配置类上 只有是指定的环境的时候，整个配置类里面的所有配置才能开始生效</span></span><br><span class="line"><span class="comment"> *  没有标注环境标识的bean在，任何环境下都是加载的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:/dbconfig.proerties&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainConfigOfProfile</span> <span class="keyword">implements</span> <span class="title class_">EmbeddedValueResolverAware</span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;db.user&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> StringValueResolver valueResolver;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Profile(&quot;dev&quot;)</span></span><br><span class="line">    <span class="meta">@Bean(&quot;devDataSource&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSourceDev</span><span class="params">(<span class="meta">@Value(db.password)</span> String pwd)</span> &#123;</span><br><span class="line">        <span class="type">ComboPooledDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComboPooledDataSource</span>();</span><br><span class="line">        dataSource.setUser(user);</span><br><span class="line">        dataSource.setPassword(password);</span><br><span class="line">        dataSource.setJdbcUrc(valueResolverresolveStringValue(<span class="string">&quot;$&#123;db.driveClass&#125;&quot;</span>));</span><br><span class="line">        dataSource.setDriverClass(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Profile(&quot;test&quot;)</span></span><br><span class="line">    <span class="meta">@Bean(&quot;testDataSource&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSourceTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ComboPooledDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComboPooledDataSource</span>();</span><br><span class="line">        dataSource.setUser(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dataSource.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        dataSource.setJdbcUrc(<span class="string">&quot;jdbc:mysql://localhost:3306/&quot;</span>);</span><br><span class="line">        dataSource.setDriverClass(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Profile(&quot;prod&quot;)</span></span><br><span class="line">    <span class="meta">@Bean(&quot;prodDataSource&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSourceProd</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ComboPooledDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComboPooledDataSource</span>();</span><br><span class="line">        dataSource.setUser(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dataSource.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        dataSource.setJdbcUrc(<span class="string">&quot;jdbc:mysql://localhost:3306/&quot;</span>);</span><br><span class="line">        dataSource.setDriverClass(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setEmbeddedValueResolver</span><span class="params">(StringValueResolver resolver)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.valueResolver = resolver;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>dbconfig.proerties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">db.user</span> = <span class="string">root</span></span><br><span class="line"><span class="attr">db.password</span> = <span class="string">123456</span></span><br><span class="line"><span class="attr">db.driverClass</span> = <span class="string">com.mysql.jdbc.Driver</span></span><br></pre></td></tr></table></figure>

<p>MainConfigOfAOP.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * AOP [动态代理]</span></span><br><span class="line"><span class="comment"> *	指在程序运行期间动态的将某段代码切入到指定方法指定位置进行运行的变成方式</span></span><br><span class="line"><span class="comment"> *	1.导入AOP模块 springaop</span></span><br><span class="line"><span class="comment"> *  2.定义一个业务逻辑类(MathCalculator) 在业务逻辑运行的时候将日志进行打印，在运行方法前 运行方法结束 方法出现异常的时候 -&gt; 解耦合</span></span><br><span class="line"><span class="comment"> *  3.定义一个日志切面类(LogAspects)切面类里面的方法需要动态感知MathCalculator运行到哪里然后执行</span></span><br><span class="line"><span class="comment"> *		通知方法:</span></span><br><span class="line"><span class="comment"> *			前置通知(@Before) -&gt; logStart 在目标方法div运行之前运行</span></span><br><span class="line"><span class="comment"> *			后置通知(@After) -&gt; logEnd 在目标方法div运行结束之后运行 无论方法正常结束 异常结束 都调用</span></span><br><span class="line"><span class="comment"> *			返回通知(@AfterReturning) -&gt; logReturn 在目标方法div正常返回之后运行</span></span><br><span class="line"><span class="comment"> *			异常通知(@AfterThrowing) -&gt; logException 在目标方法运行出现异常以后运行</span></span><br><span class="line"><span class="comment"> *			环绕通知(@Around) -&gt; 动态代理, 手动推进目标方法运行(joinPoint.procced)</span></span><br><span class="line"><span class="comment"> *  4.给切面类的目标方法标注何时何地运行 通知注解</span></span><br><span class="line"><span class="comment"> *  5.将切面类和业务逻辑了(目标方法所在类)都加入到容器中</span></span><br><span class="line"><span class="comment"> *	6.必须告诉spring哪个类是切面类(给切面类上加一个注解@Aspect)</span></span><br><span class="line"><span class="comment"> *	[7]给配置类中加入@EnableAspectJAutoProxy 开启基于注解的AOP模式</span></span><br><span class="line"><span class="comment"> *		在spring中有很多的@Enablexxx 用于开启某些功能</span></span><br><span class="line"><span class="comment"> * 三步</span></span><br><span class="line"><span class="comment"> *	1) 将业务逻辑组件和切面类都加入到容器中 告诉spring哪个是切面类(@Aspect)</span></span><br><span class="line"><span class="comment"> *	2) 在切面类上的每一个通知方法上标注通知注解 告诉spring何时何地运行(切入点表达式）</span></span><br><span class="line"><span class="comment"> *	3) 开启基于注解的aop模式 @EnableAspectJAutoProxy</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * AOP原理 [看给容器中注册了什么组件 这个组件什么时候工作 这个组件工作时候的功能是什么]</span></span><br><span class="line"><span class="comment"> *		@EnableAspectJAutoProxy;</span></span><br><span class="line"><span class="comment"> *	1. @EnableAspectJAutoProxy是什么</span></span><br><span class="line"><span class="comment"> *		@Import(AspectJAutoProxyRegistar.class) 给容器中导入AspectJAutoProxyRegistar</span></span><br><span class="line"><span class="comment"> *		利用AspectJAutoProxyRegistar自定义给容器中注册bean</span></span><br><span class="line"><span class="comment"> *		internalAutoProxyCreator=AnnotationAwareAspectJAutoProxyCreator</span></span><br><span class="line"><span class="comment"> *		给容器中注册一个叫AnnotationAwareAspectJAutoProxyCreator</span></span><br><span class="line"><span class="comment"> *	2. AnnotationAwareAspectJAutoProxyCreator</span></span><br><span class="line"><span class="comment"> *		-&gt; AnnotationAwareAdvisorAspectJAutoProxyCreator</span></span><br><span class="line"><span class="comment"> *			-&gt; AspectJAwareAdvisorAutoProxyCreator</span></span><br><span class="line"><span class="comment"> *				-&gt; AbstractAdvisorAutoPorxyCreator</span></span><br><span class="line"><span class="comment"> *					-&gt; AbstractAutoProxyCreator</span></span><br><span class="line"><span class="comment"> *						implements SmartInstantiationAwareBeanPostProcessor, BeanFactoryAware</span></span><br><span class="line"><span class="comment"> *				关注后置处理器(在bean初始化完成前后做事情)，自动装配BeanFactory</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *	</span></span><br><span class="line"><span class="comment"> *	AbstractAutoProxyCreator.setBeanFactory()</span></span><br><span class="line"><span class="comment"> *	AbstractAutoProxyCreator 有后置处理器的逻辑</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  AbstractAdvisorAutoPorxyCreator.setBeanFactory() -&gt; initBeanFactory()</span></span><br><span class="line"><span class="comment"> *	AnnotationAwareAdvisorAspectJAutoProxyCreator.initBeanFactory()</span></span><br><span class="line"><span class="comment"> *	流程</span></span><br><span class="line"><span class="comment"> *		1) 传入配置类 创建ioc容器</span></span><br><span class="line"><span class="comment"> *		2) 注册配置类 调用refresh 刷新容器</span></span><br><span class="line"><span class="comment"> *		3) registerBeanPostProcessors(beanFactory);注册bean的后置处理器</span></span><br><span class="line"><span class="comment"> *			1) 先获取ioc容器中已经定义了的要创建对象的所有BeanPostProcessor</span></span><br><span class="line"><span class="comment"> *			2) 给容器中加入别的BeanPostProcessor</span></span><br><span class="line"><span class="comment"> *			3) 优先注册实现了PriorityOrdered接口的BeanPostProcessor</span></span><br><span class="line"><span class="comment"> *			4) 再给容器中注册实现了Ordered接口的BeanPostProcessor</span></span><br><span class="line"><span class="comment"> *			5) 注册没实现优先级接口的BeanPostProcessor</span></span><br><span class="line"><span class="comment"> *			6) 注册BeanPostProcessor 实际上是创建BeanPostProcessor对象 保存在容器中</span></span><br><span class="line"><span class="comment"> *			   创建internalAutoProxyCreator的BeanPostProcessor[AnnotationAwareAspectJAutoProxyCreator]</span></span><br><span class="line"><span class="comment"> *				1)创建Bean的实例</span></span><br><span class="line"><span class="comment"> *				2)populateBean 给bean的各种属性赋值</span></span><br><span class="line"><span class="comment"> *				3)initializeBean 初始化bean</span></span><br><span class="line"><span class="comment"> *					1) invokeAwareMethods 处理Aware接口的方法回调</span></span><br><span class="line"><span class="comment"> *					2) applyBeanPostProcessorBeforeInitilization() 应用后置处理器的BeforeInitilization方法</span></span><br><span class="line"><span class="comment"> *					3) invokeInitMethod 执行自定义的初始化方法</span></span><br><span class="line"><span class="comment"> *					4) applyBeanPostProcessorBeforeInitilization 执行后置处理器的AfterInitilization方法</span></span><br><span class="line"><span class="comment"> *				4)BeanPostProcessor(AnnotationAwareAspectJAutoProxyCreator)创建成功并且调用了他的 initBeanFactory方法 -&gt; advisorbuilder</span></span><br><span class="line"><span class="comment"> *			7) 把BeanPostProcessor注册到BeanFactory中</span></span><br><span class="line"><span class="comment"> *				beanFactory.addBeanPostProcessor(postProcessor)</span></span><br><span class="line"><span class="comment"> *==============以上是创建和注册AnnotationAwareAspectJAutoProxyCreator的过程===========</span></span><br><span class="line"><span class="comment"> *		AnnotationAwareAspectJAutoProxyCreator =&gt; InstantiationAwareBeanPostProcessor</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *			</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainConfigOfAOP</span>&#123;</span><br><span class="line">   </span><br><span class="line">    <span class="comment">//业务逻辑加入类中</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MathCalculator <span class="title function_">calculator</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MathCalculator</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//切面类加入到容器中</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> LogAspects <span class="title function_">logAspects</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LogAspects</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MathCalculator</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MathCalculator</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">div</span><span class="params">(<span class="type">int</span> i, intj)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> i/j;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>LogAspects.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//告诉spring当前类是切面类</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspects</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//抽取公共的切入点表达式</span></span><br><span class="line">    <span class="comment">//1. 本类引用 直接在后面写@Before(&quot;pointCut()&quot;)</span></span><br><span class="line">    <span class="comment">//2. 其他的切面类引用 使用方法全名</span></span><br><span class="line">    <span class="meta">@PointCut(&quot;execution(public int com.aop.MathCalculator.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pointCut</span><span class="params">()</span>&#123;&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//@Before在目标方法之前切入,切入点表达式(指定在哪个方法切入 可以使用通配符* means 所有方法 ..指定所有函数参数)</span></span><br><span class="line">    <span class="meta">@Before(&quot;public int com.aop.MathCalculator.*(..)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logStart</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">		Object[] args = joinPoint.getArgs();</span><br><span class="line">        System.out.println(joinPoint.getSignator().getName()+<span class="string">&quot;运行除法&quot;</span>+Arrays.asList(args));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@After(&quot;pointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logEnd</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;除法结束&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">//JoinPoint 一定要出现在参数表的第一位   @AfterReturning(value=&quot;pointCut()&quot;,returning=&quot;result&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logReturn</span><span class="params">(JointPoint joinPoint, Object result)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;除法正常返回&quot;</span>+result);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@AfterThrowing(value=&quot;pointCut()&quot;, throwing=&quot;exception&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logExpection</span><span class="params">(Exception exception)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;除法异常信息&quot;</span>)</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blobming.github.io/2020/05/08/JavaSpringNotes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Jiaming Xu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jiaming's Blog">
      <meta itemprop="description" content="Personal Life record">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Jiaming's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/08/JavaSpringNotes/" class="post-title-link" itemprop="url">JavaSpringNotes</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-05-08 19:30:58" itemprop="dateCreated datePublished" datetime="2020-05-08T19:30:58-07:00">2020-05-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>This is a personal notes for Java spring framework</p>
<div class="toc">

<!-- toc -->

<ul>
<li><a href="#spring-introduction">Spring introduction</a><ul>
<li><a href="#what-is-spring">What is spring</a></li>
<li><a href="#update-on-spring-5">Update on Spring 5</a></li>
<li><a href="#spring-core-framework">Spring Core Framework</a><ul>
<li><a href="#goals-of-spring">Goals of Spring</a></li>
<li><a href="#core-container">Core Container</a></li>
<li><a href="#infrastructure">Infrastructure</a></li>
<li><a href="#data-access-layer">Data Access Layer</a></li>
<li><a href="#web-layer">Web Layer</a></li>
<li><a href="#test-layer">Test Layer</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#inversion-of-control">Inversion of Control</a><ul>
<li><a href="#spring-container">Spring Container</a></li>
</ul>
</li>
<li><a href="#dependency-injection">Dependency Injection</a><ul>
<li><a href="#injection-types">Injection Types</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

</div>

<h1><span id="spring-introduction">Spring introduction</span><a href="#spring-introduction" class="header-anchor">#</a></h1><h2><span id="what-is-spring">What is spring</span><a href="#what-is-spring" class="header-anchor">#</a></h2><p>It is a very popular framework for building Java application and initially a simpler and light weight alternative to J2EE. Also, it provides a large number of helper classes.</p>
<h2><span id="update-on-spring-5">Update on Spring 5</span><a href="#update-on-spring-5" class="header-anchor">#</a></h2><ul>
<li>Upgraded minimum requirements for Java 8 or higher</li>
<li>Deprecated legacy integration for: Tiles, Velocity, portlet, Guava etc</li>
<li>Upgraded Spring MVC to use new versions of Servlet API 4.0</li>
<li>Added new reactive programming framework: Spring WebFlux</li>
</ul>
<h2><span id="spring-core-framework">Spring Core Framework</span><a href="#spring-core-framework" class="header-anchor">#</a></h2><h3><span id="goals-of-spring">Goals of Spring</span><a href="#goals-of-spring" class="header-anchor">#</a></h3><ul>
<li>Lightweight development with Java POJOs(Plain-Old-Java-Objects)</li>
<li>Dependency injection to promote loose coupling</li>
<li>Declarative programming with Aspect-Oriented-Programming(AOP)</li>
<li>Minimize boilerplate Java code</li>
</ul>
<h3><span id="core-container">Core Container</span><a href="#core-container" class="header-anchor">#</a></h3><p>Factory for creating beans. Manage bean dependencies.</p>
<ul>
<li>Beans<ul>
<li>A “Spring Bean” is simply a Java object. When Java objects are created by the Spring Container, then Spring refers to them as “Spring Beans”. Spring Beans are created from normal Java classes …. just like Java objects.</li>
</ul>
</li>
<li>Core</li>
<li>SpEl<ul>
<li>Spring extression language</li>
</ul>
</li>
<li>Contex</li>
</ul>
<h3><span id="infrastructure">Infrastructure</span><a href="#infrastructure" class="header-anchor">#</a></h3><p>Aspect Oriented Programming. Add functionality to objects declaratively. </p>
<p>Logging, security,transactions,etc…</p>
<ul>
<li>Aop</li>
<li>Aspects</li>
<li>Inplementation<ul>
<li>Java agents to remotely monitor your app with JMX(Java Management Extension)</li>
</ul>
</li>
<li>Messaging</li>
</ul>
<h3><span id="data-access-layer">Data Access Layer</span><a href="#data-access-layer" class="header-anchor">#</a></h3><ul>
<li>JDBC -&gt; helper classes to make easier to access Database</li>
<li>ORM -&gt; Object Relational Mapping -&gt; JPA &#x2F; Hibernate</li>
<li>Transactions</li>
<li>OXM</li>
<li>JMS (Java Message Service)<ul>
<li>For sending async messages to a Message Broker</li>
<li>Spring provides helper classes for JMS</li>
</ul>
</li>
</ul>
<h3><span id="web-layer">Web Layer</span><a href="#web-layer" class="header-anchor">#</a></h3><p>All Web related classes. Home of the Spring MVC framework.</p>
<ul>
<li>Servlet</li>
<li>WebSocket</li>
<li>Web</li>
<li>Portlet</li>
</ul>
<h3><span id="test-layer">Test Layer</span><a href="#test-layer" class="header-anchor">#</a></h3><p>Supports Test-Driven-Development(TDD). Mock objects and out-of-container testing</p>
<ul>
<li>Unit</li>
<li>Integration</li>
<li>Mock</li>
</ul>
<h1><span id="inversion-of-control">Inversion of Control</span><a href="#inversion-of-control" class="header-anchor">#</a></h1><h2><span id="spring-container">Spring Container</span><a href="#spring-container" class="header-anchor">#</a></h2><ul>
<li>Primary functions<ul>
<li>Create and manage objects(Inversion of Control)</li>
<li>Intect object’s dependencies(Dependency Injection)</li>
</ul>
</li>
<li>Configuring Spring Container<ul>
<li>XML Configuration file</li>
<li>Java Annotations</li>
<li>Java Source Code</li>
</ul>
</li>
<li>Spring container is generically known as Application Context</li>
<li>Specialized implementations<ul>
<li>ClassPathXmlApplicationContext</li>
<li>AnnotationConfigApplicationContext</li>
<li>GenericWebApplicationContext</li>
<li>Others…</li>
</ul>
</li>
</ul>
<h1><span id="dependency-injection">Dependency Injection</span><a href="#dependency-injection" class="header-anchor">#</a></h1><p>The dependency inversion principle.</p>
<p>The client delegates to calls to another object</p>
<p>the responsibility of providign its dependencies</p>
<h2><span id="injection-types">Injection Types</span><a href="#injection-types" class="header-anchor">#</a></h2><ul>
<li>There are many types of injection with Spring</li>
<li>We will cover the two most common<ul>
<li>Constructor Injection</li>
<li>Setter Injection</li>
</ul>
</li>
<li>Autowiring –&gt; discuss later</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blobming.github.io/2020/02/19/C-working-notes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Jiaming Xu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jiaming's Blog">
      <meta itemprop="description" content="Personal Life record">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Jiaming's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/02/19/C-working-notes/" class="post-title-link" itemprop="url">C#-working-notes</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-02-19 13:39:23" itemprop="dateCreated datePublished" datetime="2020-02-19T13:39:23-08:00">2020-02-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C#</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <div class="toc">

<!-- toc -->

<ul>
<li><a href="#basic-grammer">Basic grammer</a><ul>
<li><a href="#how-to-call-async-method-in-sync-method">How to call async method in sync method</a></li>
</ul>
</li>
<li><a href="#utility">Utility</a><ul>
<li><a href="#elmah">ELMAH</a></li>
<li><a href="#log4net">log4net</a></li>
<li><a href="#automapper-https-automapper-readthedocs-io-en-latest-getting-started-html">AutoMapper</a><ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#usage">Usage</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- tocstop -->

</div>

<h2><span id="basic-grammer">Basic grammer</span><a href="#basic-grammer" class="header-anchor">#</a></h2><h3><span id="how-to-call-async-method-in-sync-method">How to call async method in sync method</span><a href="#how-to-call-async-method-in-sync-method" class="header-anchor">#</a></h3><p>suppose function A() is marked as async, if we want to call A in function B, usually we use await and marked b as async. However, if we dont want to modify the return type of B. To solve that, I decide to use anonymous function to encapsulate the calling of function A, then receive the return_val of A sync.</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">B</span>()</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> asyncTask = Task.Run(<span class="keyword">async</span> () =&gt; &#123; </span><br><span class="line">        IEnumerable&lt;returnObj&gt;res = <span class="keyword">await</span> A();</span><br><span class="line">        <span class="keyword">return</span> res; &#125;);</span><br><span class="line">    asyncTask.Wait();</span><br><span class="line">    <span class="keyword">return</span> asyncTask.Result().Count();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2><span id="utility">Utility</span><a href="#utility" class="header-anchor">#</a></h2><h3><span id="elmah">ELMAH</span><a href="#elmah" class="header-anchor">#</a></h3><h3><span id="log4net">log4net</span><a href="#log4net" class="header-anchor">#</a></h3><h3><span id="automapper"></span><a href="#automapper" class="header-anchor">#</a></h3><h4><span id="introduction">Introduction</span><a href="#introduction" class="header-anchor">#</a></h4><p>AutoMapper is an object-object mapper. Object-object mapping works by transforming an input object of one type into an output object of a different type. What makes AutoMapper interesting is that it provides some interesting conventions to take the dirty work out of figuring out how to map type A to type B. As long as type B follows AutoMapper’s established convention, almost zero configuration is needed to map two types.</p>
<h4><span id="usage">Usage</span><a href="#usage" class="header-anchor">#</a></h4><p>Once you have your types you can create a map for the two types using a MapperConfiguration and CreateMap. You only need one MapperConfiguration instance typically per AppDomain and should be instantiated during startup. More examples of initial setup see in Setup.</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> config = <span class="keyword">new</span> MapperConfiguration(cfg =&gt; cfg.CreateMap&lt;Order, OrderDto&gt;());</span><br></pre></td></tr></table></figure>
<p>The type on the left is the source type, and the type on the right is the destination type. To perform a mapping, call one of the Map overloads:</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mapper = config.CreateMapper();</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="keyword">var</span> mapper = <span class="keyword">new</span> Mapper(config);</span><br><span class="line">OrderDto dto = mapper.Map&lt;OrderDto&gt;(order);</span><br></pre></td></tr></table></figure>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj2 = Mapper.Map&lt;Obj1, Obj2&gt;(obj1);</span><br><span class="line"><span class="comment">//obj1 is type of Obj1</span></span><br><span class="line"><span class="comment">//obj2 is type of Obj2</span></span><br><span class="line"><span class="comment">// it will map the same Attribute with Obj1 and Obj2 and return a new obj which type of Obj2</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blobming.github.io/2020/02/18/DatabaseRev/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Jiaming Xu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jiaming's Blog">
      <meta itemprop="description" content="Personal Life record">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Jiaming's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/02/18/DatabaseRev/" class="post-title-link" itemprop="url">DatabaseReview</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-02-18 19:37:59" itemprop="dateCreated datePublished" datetime="2020-02-18T19:37:59-08:00">2020-02-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Database/" itemprop="url" rel="index"><span itemprop="name">Database</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>This is a review reference and some notes&#x2F;my own understanding of datbase course.<br>REFERENCE to CSCI 585 2020 SPRING lectured by Prof. Saty in University of Southern California</p>
<div class="toc">

<!-- toc -->

<ul>
<li><a href="#introduction">Introduction</a><ul>
<li><a href="#1-the-difference-between-data-and-and-information">1. The difference between data and and information</a></li>
<li><a href="#2-what-a-database-is-the-various-types-of-databases-and-why-they-are-valuable-assets-for-decision-making">2. What a database is, the various types of databases, and why they are valuable assets for decision making.</a></li>
<li><a href="#3-the-importance-of-database-design">3. The importance of database design</a></li>
<li><a href="#4-how-modern-databases-envolved-from-file-systems">4. How modern databases envolved from file systems</a></li>
<li><a href="#5-flaws-in-file-system-data-management">5. Flaws in file system data management</a></li>
<li><a href="#6-the-main-components-of-the-database-system">6. The main components of the database system</a></li>
<li><a href="#7-the-main-functions-of-a-database-management-system-dbms">7. The main functions of a database management system(DBMS)</a></li>
</ul>
</li>
<li><a href="#data-modeling">Data Modeling</a><ul>
<li><a href="#about-data-modeling-and-why-data-models-are-important">About data modeling and why data models are important</a><ul>
<li><a href="#data-modeling-and-data-models">Data Modeling and Data Models</a></li>
<li><a href="#importance-of-data-models">Importance of Data Models</a></li>
</ul>
</li>
<li><a href="#about-the-basic-data-modeling-building-blocks">About the basic data-modeling building blocks</a></li>
<li><a href="#what-business-rules-are-and-how-they-influence-database-design">What business rules are and how they influence database design</a></li>
<li><a href="#hierarchical-modeling">Hierarchical modeling</a></li>
<li><a href="#network-modeling">Network modeling</a></li>
<li><a href="#difference-between-schema-and-sub-schema">Difference between Schema and Sub Schema</a></li>
<li><a href="#difference-between-dml-and-ddl">Difference between DML and DDL</a></li>
<li><a href="#the-relational-model">The Relational Model</a></li>
<li><a href="#relational-dbms-database-management-system">Relational DBMS(Database Management System)</a></li>
<li><a href="#how-the-major-data-models-evolved">How the major data models evolved</a></li>
<li><a href="#data-abstraction-levels">Data Abstraction Levels</a></li>
<li><a href="#the-external-model">The External Model</a></li>
<li><a href="#the-conceptual-model">The Conceptual Model</a></li>
<li><a href="#the-internal-model">The Internal Model</a></li>
<li><a href="#the-physical-model">The Physical Model</a></li>
<li><a href="#about-emerging-alternative-data-models-and-the-need-they-fulfill">About emerging alternative data models and the need they fulfill</a></li>
<li><a href="#how-data-models-can-be-classified-by-their-level-of-abstraction">How data models can be classified by their level of abstraction</a></li>
</ul>
</li>
<li><a href="#er">ER</a><ul>
<li><a href="#entity-relationship-model-erm">Entity Relationship Model (ERM)</a></li>
<li><a href="#attributes">Attributes</a></li>
<li><a href="#relationships">Relationships</a></li>
</ul>
</li>
<li><a href="#relational-modeling">Relational Modeling</a><ul>
<li><a href="#a-logical-view-of-data">A Logical View of Data</a></li>
<li><a href="#keys">Keys</a></li>
<li><a href="#determination">Determination</a></li>
<li><a href="#dependencies">Dependencies</a></li>
<li><a href="#types-of-keys">Types of Keys</a></li>
<li><a href="#ways-to-handle-nulls">Ways to Handle Nulls</a></li>
<li><a href="#relational-algebra">Relational Algebra</a></li>
<li><a href="#relational-set-operators">Relational Set Operators</a></li>
<li><a href="#data-dictionary-and-the-system-catalog-hold-metadata">Data Dictionary and the System Catalog(hold metadata)</a></li>
</ul>
</li>
<li><a href="#extended-er-eer-advanced-data-modeling">Extended ER (“EER”)-&gt; Advanced data modeling</a><ul>
<li><a href="#extended-entity-relationship-model-eerm">Extended Entity Relationship Model (EERM)</a></li>
<li><a href="#entity-supertypes-and-subtypes">Entity Supertypes and Subtypes</a></li>
<li><a href="#specialization-hierarchy">Specialization Hierarchy</a></li>
<li><a href="#inheritanc">Inheritanc</a></li>
<li><a href="#subtype-discriminator">Subtype Discriminator</a></li>
<li><a href="#disjoint-and-overlapping-constraints">Disjoint and Overlapping Constraints</a></li>
<li><a href="#completeness-constraint">Completeness Constraint</a></li>
<li><a href="#entity-cluster">Entity Cluster</a></li>
</ul>
</li>
<li><a href="#normalization">Normalization</a><ul>
<li><a href="#normalization-do-normalization-once-a-time-one-entity-a-time">Normalization (Do normalization once a time one entity a time)</a></li>
<li><a href="#need-for-normalization">Need for Normalization</a></li>
<li><a href="#normalization-process">Normalization Process</a></li>
<li><a href="#normal-forms">Normal Forms</a></li>
<li><a href="#functional-dependence-concepts">Functional Dependence Concepts</a></li>
<li><a href="#types-of-functional-dependencies">Types of Functional Dependencies</a></li>
<li><a href="#conversion-to-first-normal-form">Conversion to First Normal Form</a></li>
<li><a href="#conversion-to-two-normal-form">Conversion to Two Normal Form</a></li>
<li><a href="#conversion-to-third-normal-form">Conversion to Third Normal Form</a></li>
<li><a href="#requirements-for-good-normalized-set-of-tables">Requirements for Good Normalized Set of Tables</a></li>
<li><a href="#denormalization">Denormalization</a></li>
</ul>
</li>
<li><a href="#transaction-management">Transaction Management</a><ul>
<li><a href="#transaction">Transaction</a></li>
<li><a href="#transaction-properities">Transaction Properities</a></li>
<li><a href="#transaction-management-with-sql">Transaction Management with SQL</a></li>
<li><a href="#transaction-log">Transaction log</a></li>
<li><a href="#concurrency-control">Concurrency Control</a></li>
<li><a href="#the-scheduler">The Scheduler</a></li>
<li><a href="#concurrency-control-with-locking-methods">Concurrency Control with Locking Methods</a></li>
<li><a href="#lock-granularity">Lock Granularity</a></li>
<li><a href="#lock-types">Lock Types</a></li>
<li><a href="#two-phase-locking-2pl-avoid-deadlock">Two-Phase Locking (2PL) -&gt; avoid deadlock</a></li>
<li><a href="#deadlocks">Deadlocks</a></li>
<li><a href="#time-stamping-prevent-deadlock">Time Stamping -&gt; prevent deadlock</a></li>
<li><a href="#wait-die-and-wound-wait-concurrency-control-schema">Wait&#x2F;Die and Wound&#x2F;Wait Concurrency Control Schema</a></li>
<li><a href="#phases-of-optimistic-approach">Phases of Optimistic Approach</a></li>
</ul>
</li>
<li><a href="#distributed-dbs">Distributed DBs</a><ul>
<li><a href="#vertical-scalling-and-horizontal-scalling">Vertical scalling and horizontal scalling</a></li>
<li><a href="#distributed-processing-and-distributed-databases">Distributed Processing and Distributed Databases</a></li>
<li><a href="#functions-of-distributed-dbms">Functions of Distributed DBMS</a></li>
<li><a href="#ddbms-components">DDBMS Components</a></li>
<li><a href="#single-site-processing-single-site-data-mpsd-pretty-simple">Single-Site Processing, Single-Site Data(MPSD) pretty simple</a></li>
<li><a href="#multiple-site-processing-single-site-data-mpsd">Multiple-Site Processing, Single-Site Data (MPSD)</a></li>
<li><a href="#multiple-site-processing-single-site-data-mpsd-1">Multiple-Site Processing, Single-Site Data (MPSD)</a></li>
<li><a href="#restrictions-of-ddbms">Restrictions of DDBMS</a></li>
<li><a href="#distributed-requests-and-distributed-transactions">Distributed Requests and Distributed Transactions</a></li>
<li><a href="#distributed-concurrency-control-2pc-2-phrase-commit">Distributed Concurrency Control (2PC 2 phrase commit)</a></li>
<li><a href="#two-phase-commit-protocol-2pc">Two-Phase Commit Protocol(2PC)</a></li>
<li><a href="#transparency-hide-sth-to-users">Transparency (Hide sth to users)</a></li>
<li><a href="#distributed-database-design">Distributed Database Design</a></li>
<li><a href="#data-fragmentation">Data Fragmentation</a></li>
<li><a href="#data-replication">Data Replication</a></li>
<li><a href="#data-replication-scenarios">Data Replication Scenarios</a></li>
<li><a href="#data-allocation-strategies">Data Allocation Strategies</a></li>
<li><a href="#the-cap-theorem-that-s-what-u-need-consider-when-you-design-a-database">The CAP Theorem (That’s what u need consider when you design a database)</a></li>
<li><a href="#database-connectivity">Database Connectivity</a></li>
<li><a href="#various-connectivity-options">Various connectivity options</a></li>
<li><a href="#components-of-odbc-architecture">Components of ODBC Architecture</a></li>
<li><a href="#object-linking-and-embedding-for-database-ole-db-database-becomes-object">Object Linking and Embedding for Database (OLE-DB) Database becomes object</a></li>
<li><a href="#database-internet-connectivity">Database Internet Connectivity</a></li>
<li><a href="#web-to-database-middleware">Web-to-Database Middleware</a></li>
<li><a href="#client-side-extensions">Client-Side Extensions</a></li>
</ul>
</li>
<li><a href="#performance-tuning-and-query-optimization">Performance Tuning and Query Optimization</a><ul>
<li><a href="#tuning-database-performance-tuning-concepts">Tuning(Database Performance-Tuning Concepts)</a></li>
<li><a href="#performance-tuning-client-and-server">Performance Tuning: Client and Server</a><ul>
<li><a href="#client-side">Client side</a></li>
<li><a href="#server-side">Server side</a></li>
</ul>
</li>
<li><a href="#dbms-architecture">DBMS Architecture</a></li>
<li><a href="#database-query-optimization-modes">Database Query Optimization Modes</a></li>
<li><a href="#classification-of-operation-modes">Classification of Operation Modes</a></li>
<li><a href="#based-on-timing-of-optimization">Based on Timing of Optimization</a></li>
<li><a href="#type-of-information-used-to-optimize">Type of Information Used to Optimize</a></li>
<li><a href="#sample-database-statistics-measurements">Sample Database Statistics Measurements</a></li>
<li><a href="#query-processing">Query Processing</a></li>
<li><a href="#sql-parsing-phase">SQL Parsing Phase</a></li>
<li><a href="#sql-execution-phase">SQL Execution Phase</a></li>
<li><a href="#sql-fetching-phase">SQL Fetching Phase</a></li>
<li><a href="#query-processing-bottlenecks">Query Processing Bottlenecks</a></li>
<li><a href="#indexes-and-query-optimization">Indexes and Query Optimization</a></li>
<li><a href="#indexes-and-query-optimization-1">Indexes and Query Optimization</a></li>
<li><a href="#index-selectivity">index Selectivity</a></li>
<li><a href="#optimizer-choices-statisitc-based">Optimizer Choices -&gt; statisitc-based</a></li>
<li><a href="#using-hints-to-affect-optimizer-choices">Using Hints to Affect Optimizer Choices</a></li>
<li><a href="#conditional-expressions">Conditional Expressions</a></li>
<li><a href="#query-formulation">Query Formulation</a></li>
<li><a href="#dbms-performance-tuning">DBMS Performance Tuning</a></li>
</ul>
</li>
<li><a href="#business-intelligence">Business Intelligence</a><ul>
<li><a href="#business-intelligence-bi">Business Intelligence(BI)</a></li>
<li><a href="#business-intelligence-benefits">Business Intelligence Benefits</a></li>
<li><a href="#decision-support-data">Decision Support Data</a></li>
<li><a href="#decision-support-database-requirements">Decision Support Database Requirements</a></li>
<li><a href="#data-marts">Data Marts</a></li>
<li><a href="#components-of-star-schemas">Components of Star Schemas</a></li>
<li><a href="#performance-improving-techniques-for-the-star-schema">Performance-Improving Techniques for the Star Schema</a></li>
<li><a href="#data-anaytics">Data Anaytics</a></li>
<li><a href="#olap-online-analytical-processing">OLAP-&gt; Online Analytical Processing</a></li>
<li><a href="#relational-online-analytical-processing-rolap">Relational Online Analytical Processing (ROLAP)</a></li>
<li><a href="#multidimensional-online-analytical-processing-molap-pointer-to-pointer-to-formulate-multi-dimensional-database">Multidimensional Online Analytical Processing (MOLAP) pointer to pointer to formulate multi-dimensional database</a></li>
<li><a href="#sql-extensions-for-olap">SQL Extensions for OLAP</a><ul>
<li><a href="#the-rollup-extension-get-upper-domian-data-sorted-by-lower-dimension">The ROLLUP extension(get upper domian data sorted by lower dimension)</a></li>
<li><a href="#the-cube-extension-only-get-total-by-one-dimension-separately">The CUBE extension(only get total by one dimension separately)</a></li>
</ul>
</li>
<li><a href="#data-lake">Data lake</a></li>
</ul>
</li>
<li><a href="#discussion1">Discussion1</a></li>
<li><a href="#discussion-2">Discussion 2</a></li>
</ul>
<!-- tocstop -->

</div>

<h1><span id="introduction">Introduction</span><a href="#introduction" class="header-anchor">#</a></h1><h2><span id="1-the-difference-between-data-and-and-information">1. The difference between data and and information</span><a href="#1-the-difference-between-data-and-and-information" class="header-anchor">#</a></h2><table>
<thead>
<tr>
<th align="left">Data</th>
<th align="left">Information</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Raw fact(Raw data- Not yet been processed to reveal the meaning)</td>
<td align="left">produced by processing data</td>
</tr>
<tr>
<td align="left">Building blocks of information</td>
<td align="left">Reveals the meaning of data</td>
</tr>
<tr>
<td align="left">Data management(Generation, storage, and retrieval of data)</td>
<td align="left">Enables knowledge creation</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Should be accurate, relevant, and timely to enable good decision making</td>
</tr>
</tbody></table>
<ul>
<li>To be simple, Data is raw fact, objective exists in the real word. Information is a kind of processed data. After gathering and processing, data becomes information. For example, the data of phone is pixel but the people can see it is a picture.</li>
</ul>
<ul>
<li>Knowledge is useful information. Something you can do with the information. Knowledge can use the information we found.</li>
</ul>
<h2><span id="2-what-a-database-is-the-various-types-of-databases-and-why-they-are-valuable-assets-for-decision-making">2. What a database is, the various types of databases, and why they are valuable assets for decision making.</span><a href="#2-what-a-database-is-the-various-types-of-databases-and-why-they-are-valuable-assets-for-decision-making" class="header-anchor">#</a></h2><ul>
<li>Database is a shared, integrated computer structure that sotres a collection of:<ul>
<li>End-user data: Raw facts of interest to end user, such as student’s gpa…</li>
<li><strong>Metadata</strong>: Data about data, which the end-user data are integrated and managed<ul>
<li>describe data characteristics and relationships such as what does the GPA mean and some restriction such as $0 \leq GPA \leq 4.0$ and $student-age &gt; 0$. About how we store the information. Or How many tables we have.</li>
</ul>
</li>
</ul>
</li>
<li>Database management system(DBMS)<ul>
<li>Collection of programs</li>
<li>Manages the database structure</li>
<li>Controls access to data stored in the database(who can access database | access restrictions)</li>
</ul>
</li>
<li>Role of the DBMS<ul>
<li>Intermediary between the user and the database</li>
<li>Enables data to be shared</li>
<li>Presents the end user with an integrated view of the data</li>
<li>Receives and translates application requests(what are you searching for) into operations required to fulfill the request</li>
<li>Hides database’s internal complexity from the application programs and users(People can reorganise data in the future)</li>
</ul>
</li>
<li>Advantages of DBMS<ul>
<li>Better data integration and less data inconsistency(pervent having two difference record of the same things)<ul>
<li><strong>Data inconsistency:</strong> Different versions of the same data appear in different places</li>
</ul>
</li>
<li>Increase end-user productivity</li>
<li>Data sharing</li>
<li>Data security &#x2F;&#x2F; Who gonna see what</li>
<li>Data access</li>
<li>Decision making<ul>
<li><strong>Data quality</strong>: Promoting accuracy, validity, and timeliness of data.</li>
</ul>
</li>
</ul>
</li>
<li>Types of databases<ul>
<li>Single-user database: Supports one user at a time (Like a database in your phone&#x2F;Desktop)<ul>
<li>Desktop database: Runs on PC</li>
</ul>
</li>
<li>Multiuser database: Supports multiple users at the same time (Like BOA or Amazon database)<ul>
<li>Workgroup databases: Support a small number of users or a specific department</li>
<li>Enterprise database: Supports many users across many departments</li>
</ul>
</li>
<li>Centralized database: Data is located at a single site</li>
<li>Distributed database: Data is distributed across different sites (Part of database from xxx part of database from xxx different contries) <strong>Note</strong>: It is not copies. Just different parts of one database from different sites. – google uses it</li>
<li>Cloud database: Created and maintained using cloud data services that provide defined performance measures for the database. Companies do not actually using the hardwares. Like UBER, they dont have their physical, their databases live on some cloud.(AWS)</li>
</ul>
</li>
<li>Types of databases (Another way to classify database)<ul>
<li>General-purpose databases: Contains a wide variety of data used in multiple disciplines. Like Oracle database, you can use the database where you want. And you can put anything you want in Oracle. –&gt; general purpose</li>
<li>Discipline-specific databases: Contains data focused on specific subject areas. Like scientists use protein database(PDB -&gt; protein data bank) Every protein molecules are stored in database. Different structure for specific usage. They have their own buliding plans and only the users know what it is or what it represents.</li>
</ul>
</li>
<li>Types of databases (Another way to classify database) -&gt; purly for business point of view<ul>
<li>Operational database: Designed to support a company’s day to day operations. </li>
<li>Analytical database: Stores historical data and business metrics used exclusively for tactical or strategic decision making<ul>
<li>Data warehouse: Stores data in a format optimized for decision support.</li>
</ul>
</li>
<li><strong>Example:</strong> Constantly writing data…. every purchase into Operational database daily. At night, they put the data to one central place called analytical database(used to analytical later) It is constantly reading database.</li>
<li>where do data warehouse caculations<ul>
<li>Online analytical processing(OLAP) Command to go to the warehouse and analysis data<ul>
<li>Enable retrieving, processing, and modeling data from the data warehouse.</li>
</ul>
</li>
<li>Business intelligence: Captures and processes business data to generate information that support decision making. (stock from Operational database to Analytical database piece to piece) -&gt; data mining</li>
</ul>
</li>
</ul>
</li>
<li>Types of databases (Another way to classify database)<ul>
<li>Unstructured data: It exists in their original state (dont have a specific format like musci&#x2F;video files)</li>
<li>Structured data: It results from formatting (like students information stored in each row of studnet table)<ul>
<li>Structure is applied based on type of processing to be performed</li>
</ul>
</li>
<li>Semistructured data: Processed to some extent like document. Generally it is used to describe sth. Between structured and unstructured.</li>
<li>Extensible Markup Language(XML) Json better than xml can be used in structured and unstructured<ul>
<li>Represents data elements in textual format</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2><span id="3-the-importance-of-database-design">3. The importance of database design</span><a href="#3-the-importance-of-database-design" class="header-anchor">#</a></h2><h2><span id="4-how-modern-databases-envolved-from-file-systems">4. How modern databases envolved from file systems</span><a href="#4-how-modern-databases-envolved-from-file-systems" class="header-anchor">#</a></h2><ul>
<li>Early Dbs: file systems<ul>
<li>Manual file systems: Accompulished through a system of file folders and filing cabinets</li>
<li>Computerized File Systems<ul>
<li>Data processing(DP) specialist: Create a computer-based system that would track data and produce required reports</li>
</ul>
</li>
<li>File System Redux: Mdern End-User Productivity Tools(Includes spreadsheet programs such as Microsoft Excel)</li>
</ul>
</li>
<li>File systems<ul>
<li>Data -&gt; Raw facts, such as a Tel number, birth date or customer name. Data have little meaning unless they have been organized in some logical manner. Each cell!</li>
<li>Field -&gt; A character of group of characters(alphabetic or numeric) that has a specific meaning. A field is used to define and store data. Like the definition of the meaning of data in this field.</li>
<li>Record -&gt; A row (contains person’s name, address….)</li>
<li>File -&gt; a collection of record</li>
</ul>
</li>
<li>Problems with Fie System Data Processing<ul>
<li>Lengthy development times</li>
<li>Difficulty of getting quick answers</li>
<li>Complex system administration</li>
<li>Lack of security and limited data sharing</li>
<li>Extensive programming</li>
</ul>
</li>
<li>Structural and Data dependence<ul>
<li>Data dependence<ul>
<li>Data access changes when data storage characteristics chage</li>
</ul>
</li>
<li>Data independence<ul>
<li>Data storage characteristics is changed without affecting the program’s ability to access the data</li>
</ul>
</li>
<li>Practical significance of data dependence is difference between logical and physical format</li>
</ul>
</li>
<li>Data Redundancy<ul>
<li>Unnecessarily storing same data at different places</li>
<li>Islands of information: Scattered data locations<ul>
<li>Increases the probability of having different versions of the same data.</li>
</ul>
</li>
</ul>
</li>
<li>Data Redundancy Implications (the defects of data redundancy)<ul>
<li>Poor data security</li>
<li>Data inconsistency</li>
<li>Increased likelihood of data-entry errors when complex enries are made in different files</li>
<li>Data anomaly: Develops when not all of the required changes in the redundant data are made successfully.<ul>
<li>Update Anomalies (happens when data is already there)</li>
<li>Insertion Anomalies (create data for the first time)</li>
<li>Deletion Anomalies</li>
</ul>
</li>
</ul>
</li>
<li>Database System<ul>
<li>Logically related data stored in a single logical data repository<ul>
<li>Physically distributed among multiple storage facilities</li>
<li>DBMS eliminates most of file system’s problems</li>
</ul>
</li>
<li>Curent generation DBMS software<ul>
<li>Stores data structures, relationships between structures, and access pahts</li>
<li>Defines, stores, and manages all access paths and components.</li>
</ul>
</li>
<li>DBMS Functions<ul>
<li>Data dictionary management</li>
<li>Data storage management<ul>
<li>Per</li>
</ul>
</li>
<li>Data transformation and presentation<ul>
<li>Transforms entrered data to conform required data structures</li>
</ul>
</li>
<li>Security management<ul>
<li>Enforces user security and data privacy</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2><span id="5-flaws-in-file-system-data-management">5. Flaws in file system data management</span><a href="#5-flaws-in-file-system-data-management" class="header-anchor">#</a></h2><h2><span id="6-the-main-components-of-the-database-system">6. The main components of the database system</span><a href="#6-the-main-components-of-the-database-system" class="header-anchor">#</a></h2><h2><span id="7-the-main-functions-of-a-database-management-system-dbms">7. The main functions of a database management system(DBMS)</span><a href="#7-the-main-functions-of-a-database-management-system-dbms" class="header-anchor">#</a></h2><ul>
<li>Data dictionary management &#x3D;&#x3D; meta data example for one column<ul>
<li><strong>Data dictionary</strong>: Stores definitions of the data elements and their relationships</li>
</ul>
</li>
<li>Data storage management<ul>
<li><strong>Performance tuning</strong>: Ensures efficient performance of the database in terms of storage and access speed</li>
</ul>
</li>
<li>Data transformation and presentation<ul>
<li>Transforms entered data to conform to required data structures.</li>
</ul>
</li>
<li>Security management<ul>
<li>Enforces user security and data privacy.</li>
</ul>
</li>
<li>Multiuser access control<ul>
<li>Sophisticated algorithms ensure that multiple users can access the database concurrently without compromising its integrity.</li>
</ul>
</li>
<li>Backup and recovery management<ul>
<li>Enables recovery of the database after a failure</li>
</ul>
</li>
<li>Data integrity management<ul>
<li>Minimizes redundancy and maximizes consistency</li>
</ul>
</li>
<li>Database access languages and application programming interfaces <ul>
<li>Query language: Lets the user specify what must be done without having to specify how </li>
<li>Structured Query Language (SQL): De facto query language and data access standard supported by the majority of DBMS vendors</li>
</ul>
</li>
<li>Database communication interfaces<ul>
<li>Accept end-user requests via multiple, different network environments</li>
</ul>
</li>
<li>Disadvantage of Database Systems<ul>
<li>Increased costs</li>
<li>Management complexity</li>
<li>Maintaining currency</li>
<li>Vendor dependence</li>
<li>Frequent upgrade&#x2F;replacement cycles</li>
</ul>
</li>
</ul>
<h1><span id="data-modeling">Data Modeling</span><a href="#data-modeling" class="header-anchor">#</a></h1><h2><span id="about-data-modeling-and-why-data-models-are-important">About data modeling and why data models are important</span><a href="#about-data-modeling-and-why-data-models-are-important" class="header-anchor">#</a></h2><h3><span id="data-modeling-and-data-models">Data Modeling and Data Models</span><a href="#data-modeling-and-data-models" class="header-anchor">#</a></h3><ul>
<li><strong>Data modeling</strong>: Iterative and progressive process of creating a specific data model for a determined problem domain </li>
<li><strong>Data models</strong>: Simple representations of complex real-world data structures<br>Useful for supporting a specific problem domain</li>
<li><strong>Model</strong> - Abstraction of a real-world object or event</li>
</ul>
<h3><span id="importance-of-data-models">Importance of Data Models</span><a href="#importance-of-data-models" class="header-anchor">#</a></h3><ul>
<li>Are a communication tool </li>
<li>Give an overall view of the database</li>
<li>Organize data for various users</li>
<li>Are an abstraction for the creation of good database</li>
</ul>
<h2><span id="about-the-basic-data-modeling-building-blocks">About the basic data-modeling building blocks</span><a href="#about-the-basic-data-modeling-building-blocks" class="header-anchor">#</a></h2><ul>
<li><strong>Entity</strong>: Unique and distinct object used to collect and store data<ul>
<li><strong>Attribute</strong>: Characteristic of an entity</li>
</ul>
</li>
<li><strong>Relationship</strong>: Describes an association among entities(one row in an entity can relate to how many rows in other entities)<ul>
<li><strong>One-to-many</strong> (1:M)</li>
<li><strong>Many-to-many</strong> (M:N or M:M)</li>
<li><strong>One-to-one</strong> (1:1)</li>
</ul>
</li>
<li><strong>Constraint</strong>: Set of rules to ensure data integrity</li>
</ul>
<h2><span id="what-business-rules-are-and-how-they-influence-database-design">What business rules are and how they influence database design</span><a href="#what-business-rules-are-and-how-they-influence-database-design" class="header-anchor">#</a></h2><ul>
<li>Brief, precise, and unambiguous description of a policy, procedure, or principle</li>
<li>Enable defining the basic building blocks </li>
<li>Describe main and distinguishing characteristics of the data</li>
<li>Sources of Business Rules(sb. write the manual)<ul>
<li>Company managers</li>
<li>Policy makers</li>
<li>Department managers</li>
<li>Written documentation</li>
<li>Direct interviews with end users</li>
</ul>
</li>
<li>Why we need business rules<ul>
<li>Help standardize company’s view of data</li>
<li>Communications tool between users and designers</li>
<li>Allow designer to:<ul>
<li>Understand the nature, role, scope of data, and business processes</li>
<li>Develop appropriate relationship participation rules and constraints</li>
<li>Create an accurate data model</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2><span id="hierarchical-modeling">Hierarchical modeling</span><a href="#hierarchical-modeling" class="header-anchor">#</a></h2><ul>
<li>Manage large amounts of data for complex manufacturing projects</li>
<li>Represented by an upside-down tree which contains segments</li>
<li>Segments: Equivalent of a file system’s record type</li>
<li>Depicts a set of one-to-many (1:M) relationships</li>
<li>Advantage<ul>
<li>Promotes data sharing</li>
<li>Parent&#x2F;child relationship promotes conceptual simplicity and data integrity</li>
<li>Database security is provided and enforced by DBMS</li>
<li>Efficient with 1:M relationships</li>
</ul>
</li>
<li>Disadvantages<ul>
<li>Requires knowledge of physical data storage characteristics</li>
<li>Navigational system requires knowledge of hierarchical path</li>
<li>Changes in structure require changes in all application programs</li>
<li>Implementation limitations </li>
<li>No data definition </li>
<li>Lack of standards</li>
</ul>
</li>
</ul>
<h2><span id="network-modeling">Network modeling</span><a href="#network-modeling" class="header-anchor">#</a></h2><ul>
<li>Represent complex data relationships</li>
<li>Improve database performance and impose a database standard</li>
<li>Depicts both one-to-many (1:M) and many-to-many (M:N) relationships</li>
<li>Advantages<ul>
<li>Conceptual simplicity</li>
<li>Handles more relationship types </li>
<li>Data access is flexible </li>
<li>Data owner&#x2F;member relationship promotes data integrity</li>
<li>Conformance to standards</li>
<li>Includes data definition language (DDL) and data manipulation language (DML)</li>
</ul>
</li>
<li>Disadvantages<ul>
<li>System complexity limits efficiency </li>
<li>Navigational system yields complex implementation, application development, and management</li>
<li>Structural changes require changes in all application programs</li>
</ul>
</li>
</ul>
<h2><span id="difference-between-schema-and-sub-schema">Difference between Schema and Sub Schema</span><a href="#difference-between-schema-and-sub-schema" class="header-anchor">#</a></h2><ul>
<li>Schema is a Conceptual organization of the entire database as viewed by the database administrator(means the whole thing)</li>
<li>SubSchema is a Portion of the database seen by the application programs that produce the desired information from the data within the database.(only a sub part of schema)</li>
</ul>
<h2><span id="difference-between-dml-and-ddl">Difference between DML and DDL</span><a href="#difference-between-dml-and-ddl" class="header-anchor">#</a></h2><ul>
<li>Data manipulation language(DML): Environment in which data can be managed and is used to work with the data in the database(add &#x2F; delete&#x2F; modify&#x2F; query data)</li>
<li>Schema data definition language(DDL): Enables the database administrator to define the schema components (create the structure)</li>
</ul>
<h2><span id="the-relational-model">The Relational Model</span><a href="#the-relational-model" class="header-anchor">#</a></h2><ul>
<li>Produced an automatic transmission database that replaced standard transmission databases </li>
<li>Based on a relation<ul>
<li>Relation or table: Matrix composed of intersecting tuple and attribute(Here we need to note that we have two kinds of relation.One is the relation between different tables. And the other thing is one cell related to rows and columns. For example, one score can relate to one student and it is belonged to gpa column it is an intersection)<ul>
<li>Tuple: Rows</li>
<li>Attribute: Columns</li>
</ul>
</li>
</ul>
</li>
<li>Describes a precise set of data manipulation constructs</li>
<li>Advantage<ul>
<li>Structural independence is promoted using independent tables</li>
<li>Tabular view improves conceptual simplicity</li>
<li>Ad hoc query capability is based on SQL</li>
<li>Isolates the end user from physical-level details </li>
<li>Improves implementation and management simplicity</li>
</ul>
</li>
</ul>
<h2><span id="relational-dbms-database-management-system">Relational DBMS(Database Management System)</span><a href="#relational-dbms-database-management-system" class="header-anchor">#</a></h2><ul>
<li>Performs basic functions provided by the hierarchical and network DBMS systems</li>
<li>Makes the relational data model easier to understand and implement</li>
<li>Hides the complexities of the relational model from the user</li>
</ul>
<h2><span id="how-the-major-data-models-evolved">How the major data models evolved</span><a href="#how-the-major-data-models-evolved" class="header-anchor">#</a></h2><p><img src="/DatabaseRev/EvoDataModel.png" alt="The Evolution of Data Model"></p>
<h2><span id="data-abstraction-levels">Data Abstraction Levels</span><a href="#data-abstraction-levels" class="header-anchor">#</a></h2><p>It means you change sth, the level above this layer will no change</p>
<p>Physical independence means pyhsical model can change but internal Model could not change.</p>
<p>Logical independence means if internal model changes but conceptual could not change. Such as if Internal Model is changed to NoSQL from RDM, nobody will notice that.</p>
<h2><span id="the-external-model">The External Model</span><a href="#the-external-model" class="header-anchor">#</a></h2><ul>
<li>End users’ view of the data environment</li>
<li>ER diagrams are used to represent the external views</li>
<li>External schema: Specific representation of an external view</li>
</ul>
<h2><span id="the-conceptual-model">The Conceptual Model</span><a href="#the-conceptual-model" class="header-anchor">#</a></h2><ul>
<li>Represents a global view of the entire database by the entire organization</li>
<li>Conceptual schema: Basis for the identification and high-level description of the main data objects</li>
<li>Has a macro-level view of data environment</li>
<li>Is software and hardware independent</li>
<li>Logical design: Task of creating a conceptual data model</li>
</ul>
<h2><span id="the-internal-model">The Internal Model</span><a href="#the-internal-model" class="header-anchor">#</a></h2><ul>
<li>Representing database as seen by the DBMS mapping conceptual model to the DBMS</li>
<li><strong>Internal schema</strong>: Specific representation of an internal model<ul>
<li>Uses the database constructs supported by the chosen database</li>
</ul>
</li>
<li>Is software dependent and hardware independent</li>
<li><strong>Logical independence</strong>: Changing internal model without affecting the conceptual model</li>
</ul>
<h2><span id="the-physical-model">The Physical Model</span><a href="#the-physical-model" class="header-anchor">#</a></h2><ul>
<li>Operates at lowest level of abstraction</li>
<li>Describes the way data are saved on storage media such as disks or tapes</li>
<li>Requires the definition of physical storage and data access methods</li>
<li>Relational model aimed at logical level<br>Does not require physical-level details</li>
<li><strong>Physical independence</strong>: Changes in physical model do not affect internal model</li>
</ul>
<h2><span id="about-emerging-alternative-data-models-and-the-need-they-fulfill">About emerging alternative data models and the need they fulfill</span><a href="#about-emerging-alternative-data-models-and-the-need-they-fulfill" class="header-anchor">#</a></h2><h2><span id="how-data-models-can-be-classified-by-their-level-of-abstraction">How data models can be classified by their level of abstraction</span><a href="#how-data-models-can-be-classified-by-their-level-of-abstraction" class="header-anchor">#</a></h2><h1><span id="er">ER</span><a href="#er" class="header-anchor">#</a></h1><h2><span id="entity-relationship-model-erm">Entity Relationship Model (ERM)</span><a href="#entity-relationship-model-erm" class="header-anchor">#</a></h2><ul>
<li>Basis of an entity relationship diagram (ERD) </li>
<li>ERD depicts the:<ul>
<li>Conceptual database as viewed by end user</li>
<li>Database’s main components<ul>
<li>Entities</li>
<li>Attributes</li>
<li>Relationships</li>
</ul>
</li>
</ul>
</li>
<li>Entity - Refers to the entity set and not to a single entity occurrence</li>
</ul>
<h2><span id="attributes">Attributes</span><a href="#attributes" class="header-anchor">#</a></h2><ul>
<li>Characteristics of entities</li>
<li><strong>Required attribute</strong>: Must have a value, cannot be left empty -Id&#x2F;Lastname</li>
<li><strong>Optional attribute</strong>: Does not require a value, can be left empty -secondary Email</li>
<li>Domain - Set of possible values for a given attribute(range the possible like GPA 0-4 name can only be 40chars long ..valid values)</li>
<li><strong>Identifiers</strong>: One or more attributes that uniquely identify each entity instance(must exist and cannot be null like primary key(s))</li>
<li><strong>Compondend attribute</strong>: Attribute that can be subdivided to yield additional attributes(Different from compond. One column can contain more than one colums in it, such as color can contain R,G,B or Name can contain first_name and last_name</li>
<li><strong>Composite identifier</strong>: Primary key composed of more than one attribute</li>
<li><strong>Composite attribute</strong>: composit is like the combinations of several columns same as Composite identifier, but identifier is primary key.</li>
<li><strong>Simple attribute</strong>: Attribute that cannot be subdivided</li>
<li><strong>Single-valued attribute</strong>: Attribute that has only a single value</li>
<li><strong>Multivalued attributes</strong>: Attributes that have many values and require creating:<ul>
<li>Several new attributes, one for each component of the original multivalued attribute</li>
<li>A new entity composed of the original multivalued attribute’s components</li>
</ul>
</li>
<li><strong>Derived attribute</strong>: Attribute whose value is calculated from other attributes<ul>
<li>Derived using an algorithm</li>
</ul>
</li>
<li>Advantages and Disadvantages of Storing Derived Attributes<br><img src="/DatabaseRev/ADVDISDERIATTR.png" alt="Advantages and Disadvantages of Storing Derived Attributes"></li>
</ul>
<h2><span id="relationships">Relationships</span><a href="#relationships" class="header-anchor">#</a></h2><ul>
<li>Association between entities that always operate in both directions</li>
<li><strong>Participants</strong>: Entities that participate in a relationship</li>
<li><strong>Connectivity</strong>: Describes the relationship classification</li>
<li><strong>Cardinality</strong>: Expresses the minimum and maximum number of entity occurrences associated with one occurrence of related entity</li>
<li>Existence Dependence and Existence Independence<table>
<thead>
<tr>
<th align="center">Existence dependence</th>
<th align="center">Existence independence</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Entity exists in the database only when it is associated with another related entity occurrence</td>
<td align="center">Entity exists apart from all of its related entities. Referred to as a strong entity or regular entity</td>
</tr>
<tr>
<td align="center">For example, the Employee(<strong>String entity</strong>&#x2F;<strong>regular entity</strong>) and their children (*** Children is not week entity!!!) Please notice that When a primary is shared between two Entity, the other entity(which owns both its only key and shared key) is <strong>weak entity</strong> And the <strong>relationship between them is strong relationship</strong>.</td>
<td align="center"></td>
</tr>
</tbody></table>
However, if one entity has a foreign key from other entity <strong>there is a weak relationship</strong>. This is not a weak entiy but it is also existence depency.</li>
<li>Relationship Strength<ul>
<li>Weak (non-identifying) relationship<ul>
<li>Primary key of the related entity does not contain a primary key component of the parent entity</li>
</ul>
</li>
<li>Strong (identifying) relationships<ul>
<li>Primary key of the related entity contains a primary key component of the parent entity<br>A strong relationship makes the right side be weak. But the right hand side of a Weak entiy is not weak though it is still existant dependency.</li>
</ul>
</li>
<li>A weak entity has two Conditions<br>+Existence-dependent <ul>
<li>Has a primary key that is partially or totally derived from parent entity in the relationship</li>
</ul>
</li>
</ul>
</li>
<li>Relationship Participation<ul>
<li>Optional participation<ul>
<li>One entity occurrence does not require a corresponding entity occurrence in a particular relationship</li>
</ul>
</li>
<li>Mandatory participation<ul>
<li>One entity occurrence requires a corresponding entity occurrence in a particular relationship</li>
</ul>
</li>
</ul>
</li>
<li>Relationship Degree<ul>
<li>Indicates the number of entities or participants associated with a relationship</li>
<li><strong>Unary relationship</strong>: Association is maintained within a single entity -&gt; Some row in a table has some relationship with some row in the same table<ul>
<li><strong>Recursive relationship</strong>: Relationship exists between occurrences of the same entity set</li>
</ul>
</li>
<li><strong>Binary relationship</strong>: Two entities are associated</li>
<li><strong>Ternary relationship</strong>: Three entities are associated</li>
</ul>
</li>
<li>Associative Entities<ul>
<li>Also known as composite or bridge entities</li>
<li>Used to represent an M:N relationship between two or more entities</li>
<li>Is in a 1:M relationship with the parent entities<ul>
<li>Composed of the primary key attributes of each parent entity</li>
</ul>
</li>
<li>May also contain additional attributes that play no role in connective process</li>
</ul>
</li>
<li>Developing an ER Diagram<ul>
<li>Create a detailed narrative of the organization’s  description of operations</li>
<li>Identify business rules based on the descriptions</li>
<li>Identify main entities and relationships from the business rules</li>
<li>Develop the initial ERD</li>
<li>Identify the attributes and primary keys that adequately describe entities</li>
<li>Revise and review ERD</li>
</ul>
</li>
</ul>
<h1><span id="relational-modeling">Relational Modeling</span><a href="#relational-modeling" class="header-anchor">#</a></h1><h2><span id="a-logical-view-of-data">A Logical View of Data</span><a href="#a-logical-view-of-data" class="header-anchor">#</a></h2><ul>
<li>Relational database model enables logical representation of the data and its relationships</li>
<li>Logical simplicity yields simple and effective database design methodologies </li>
<li>Facilitated by the creation of data relationships based on a logical construct called a relation</li>
</ul>
<h2><span id="keys">Keys</span><a href="#keys" class="header-anchor">#</a></h2><ul>
<li>Consist of one or more attributes that determine other attributes</li>
<li>Used to: <ul>
<li>Ensure that each row in a table is uniquely identifiable</li>
<li>Establish relationships among tables and to ensure the integrity of the data</li>
</ul>
</li>
<li><strong>Primary key (PK)</strong>: Attribute or combination of attributes that uniquely identifies any given row</li>
</ul>
<h2><span id="determination">Determination</span><a href="#determination" class="header-anchor">#</a></h2><ul>
<li>State in which knowing the value of one attribute makes it possible to determine the value of another</li>
<li>Is the basis for establishing the role of a key </li>
<li>Based on the relationships among the attributes</li>
</ul>
<h2><span id="dependencies">Dependencies</span><a href="#dependencies" class="header-anchor">#</a></h2><ul>
<li><strong>Functional dependence</strong>: Value of one or more attributes determines the value of one or more other attributes<ul>
<li><strong>Determinant</strong>: Attribute whose value determines another </li>
<li><strong>Dependent</strong>: Attribute whose value is determined by the other attribute</li>
</ul>
</li>
<li><strong>Full functional dependence</strong>: Entire collection of attributes in the determinant is necessary for the relationship. For example, like first_name and last_name are determinant. So if I want to query sth, I must git all of them</li>
</ul>
<h2><span id="types-of-keys">Types of Keys</span><a href="#types-of-keys" class="header-anchor">#</a></h2><ul>
<li><strong>Composite key</strong>: Key that is composed of more than one attribute</li>
<li><strong>Key attribute</strong>: Attribute that is a part of a key</li>
<li><strong>Entity integrity</strong>: Condition in which each row in the table has its own unique identity <ul>
<li>All of the values in the primary key must be unique</li>
<li>No key attribute in the primary key can contain a null</li>
</ul>
</li>
<li><strong>Null</strong>: Absence of any data value that could represent:<ul>
<li>An unknown attribute value </li>
<li>A known, but missing, attribute value  </li>
<li>A inapplicable condition</li>
</ul>
</li>
<li><strong>Referential integrity</strong>: Every reference to an entity instance by another entity instance is valid (foreign key) if reference is null, it violates the integrity</li>
<li>Superkey: An attribute or combination of attributes that uniquely identifies each row in a table(A superkey is a group of single or multiple keys which identifies rows in a table. A Super key may have additional attributes that are not needed for unique identification.)</li>
<li>Candidate key: A minimal(irreducible) superkey; a superkey that does contain a subset of attributes that is itself a superkey.<br>  It is a set of attributes that uniquely identify tuples in a table. Candidate Key is a super key with no repeated attributes. The Primary key should be selected from the candidate keys. Every table must have at least a single candidate key. A table can have multiple candidate keys but only a single primary key.<ul>
<li>Properties of Candidate key:<ul>
<li>It must contain unique values</li>
<li>Candidate key may have multiple attributes</li>
<li>Must not contain null values</li>
<li>It should contain minimum fields to ensure uniqueness</li>
<li>Uniquely identify each record in a table</li>
</ul>
</li>
</ul>
</li>
<li>Secondary key<ul>
<li>Secondary Key is the key that has not been selected to be the primary key. A secondary key is a non-identifying column or set of columns that can be used to find row in a table. It is only for data retrieval purposes</li>
<li><img src="/DatabaseRev/keys.png" alt="Advantages and Disadvantages of Storing Derived Attributes"></li>
</ul>
</li>
</ul>
<h2><span id="ways-to-handle-nulls">Ways to Handle Nulls</span><a href="#ways-to-handle-nulls" class="header-anchor">#</a></h2><ul>
<li><strong>Flags</strong>: Special codes used to indicate the absence of some value </li>
<li>NOT NULL constraint - Placed on a column to ensure that every row in the table has a value for that column</li>
<li>UNIQUE constraint - Restriction placed on a column to ensure that no duplicate values exist for that column</li>
</ul>
<h2><span id="relational-algebra">Relational Algebra</span><a href="#relational-algebra" class="header-anchor">#</a></h2><ul>
<li>Theoretical way of manipulating table contents using relational operators</li>
<li><strong>Relvar</strong>: Variable that holds a relation</li>
<li>Heading contains the names of the attributes and the body contains the relation</li>
<li>Relational operators have the property of closure<ul>
<li><strong>Closure</strong>: Use of relational algebra operators on existing relations produces new relations</li>
</ul>
</li>
</ul>
<h2><span id="relational-set-operators">Relational Set Operators</span><a href="#relational-set-operators" class="header-anchor">#</a></h2><ul>
<li>Select (Restrict)<ul>
<li>Unary operator that yields a horizontal subset of a table</li>
</ul>
</li>
<li>Project<ul>
<li>Unary operator that yields a vertical subset of a table</li>
</ul>
</li>
<li>Union<ul>
<li>Combines all rows from two tables, excluding duplicate rows</li>
<li>Union-compatible: Tables share the same number of columns, and their corresponding columns share compatible domains</li>
</ul>
</li>
<li>Intersect<ul>
<li>Yields only the rows that appear in both tables</li>
<li>Tables must be union-compatible to yield valid results</li>
</ul>
</li>
<li>Difference <ul>
<li>Yields all rows in one table that are not found in the other table</li>
<li>Tables must be union-compatible to yield valid results</li>
</ul>
</li>
<li>Product <ul>
<li>Yields all possible pairs of rows from two tables</li>
</ul>
</li>
<li>Join<ul>
<li>Allows information to be intelligently combined from two or more tables </li>
<li>Types of Joins<ul>
<li>Natural join: Links tables by selecting only the rows with common values in their common attributes<ul>
<li>Join columns: Common columns -&gt; the columns have exactly the same name. -&gt; If not the same we do not call it nature join</li>
</ul>
</li>
<li>Equijoin: Links tables on the basis of an equality condition that compares specified columns of each table -&gt; &#x3D;&#x3D; !&#x3D; &lt; &gt; &lt;&#x3D; &gt;&#x3D; ….</li>
<li>Theta join: Extension of natural join, denoted by adding a theta subscript after the JOIN symbol</li>
<li>Inner join: Only returns matched records from the tables that are being joined</li>
<li>Outer join: Matched pairs are retained and unmatched values in the other table are left null </li>
<li>Left outer join: Yields all of the rows in the first table, including those that do not have a matching value in the second table </li>
<li>Right outer join: Yields all of the rows in the second table, including those that do not have matching values in the first table</li>
</ul>
</li>
</ul>
</li>
<li>Divide<ul>
<li>Uses one 2-column table as the dividend and one single-column table as the divisor</li>
<li>Output is a single column that contains all values from the second column of the dividend that are associated with every row in the divisor</li>
</ul>
</li>
</ul>
<h2><span id="data-dictionary-and-the-system-catalog-hold-metadata">Data Dictionary and the System Catalog(hold metadata)</span><a href="#data-dictionary-and-the-system-catalog-hold-metadata" class="header-anchor">#</a></h2><ul>
<li><strong>Data dictionary</strong>: Description of all tables in the database created by the user and designer &#x2F;&#x2F; Where is the table located and the characteristic of columns</li>
<li><strong>System catalog</strong>: System data dictionary that describes all objects within the database  &#x2F;&#x2F; the same as data dictionary</li>
<li>Homonyms and synonyms must be avoided to lessen confusion<ul>
<li>Homonym: Same name is used to label different attributes -&gt; Cannot use the same name to describe diff things</li>
<li>Synonym: Different names are used to describe the same attribute -&gt; same</li>
</ul>
</li>
</ul>
<h1><span id="extended-er-eer-gt-advanced-data-modeling">Extended ER (“EER”)-&gt; Advanced data modeling</span><a href="#extended-er-eer-gt-advanced-data-modeling" class="header-anchor">#</a></h1><h2><span id="extended-entity-relationship-model-eerm">Extended Entity Relationship Model (EERM)</span><a href="#extended-entity-relationship-model-eerm" class="header-anchor">#</a></h2><ul>
<li>Result of adding more semantic constructs to the original entity relationship (ER) model</li>
<li><strong>EER diagram (EERD)</strong>: Uses the EER model</li>
</ul>
<h2><span id="entity-supertypes-and-subtypes">Entity Supertypes and Subtypes</span><a href="#entity-supertypes-and-subtypes" class="header-anchor">#</a></h2><ul>
<li><strong>Entity supertype</strong>: Generic entity type related to one or more entity subtypes<ul>
<li>Contains common characteristics</li>
</ul>
</li>
<li><strong>Entity subtype</strong>: Contains unique characteristics of each entity subtype</li>
<li>Criteria to determine the usage<ul>
<li>There must be different, identifiable kinds of the entity in the user’s environment</li>
<li>The different kinds of instances should each have one or more attributes that are unique to that kind of instance</li>
</ul>
</li>
</ul>
<h2><span id="specialization-hierarchy">Specialization Hierarchy</span><a href="#specialization-hierarchy" class="header-anchor">#</a></h2><ul>
<li>Depicts arrangement of higher-level entity supertypes and lower-level entity subtypes</li>
<li>Relationships are described in terms of “is-a” relationships -&gt; Composition can have “Has-a” relation</li>
<li>Subtype exists within the context of a supertype</li>
<li>Every subtype has one supertype to which it is directly related # Cannot have more</li>
<li>Supertype can have many subtypes</li>
<li>Provides the means to:<ul>
<li>Support attribute inheritance</li>
<li>Define a special supertype attribute known as the subtype discriminator</li>
<li>Define disjoint&#x2F;overlapping constraints and complete&#x2F;partial constraints</li>
</ul>
</li>
</ul>
<h2><span id="inheritanc">Inheritanc</span><a href="#inheritanc" class="header-anchor">#</a></h2><ul>
<li>Enables an entity subtype to inherit attributes and relationships of the supertype</li>
<li>All entity subtypes inherit their primary key attribute from their supertype</li>
<li>At the implementation level, supertype and its subtype(s) maintain a 1:1 relationship</li>
<li>Entity subtypes inherit all relationships in which supertype entity participates</li>
<li>Lower-level subtypes inherit all attributes and relationships from its upper-level supertypes</li>
</ul>
<h2><span id="subtype-discriminator">Subtype Discriminator</span><a href="#subtype-discriminator" class="header-anchor">#</a></h2><ul>
<li>Attribute in the supertype entity that determines to which entity subtype the supertype occurrence is related</li>
<li>Default comparison condition is the equality comparison  example:’p’ -&gt; pilot</li>
</ul>
<h2><span id="disjoint-and-overlapping-constraints">Disjoint and Overlapping Constraints</span><a href="#disjoint-and-overlapping-constraints" class="header-anchor">#</a></h2><ul>
<li><strong>Disjoint subtypes</strong>: Contain a unique subset of the supertype entity set<ul>
<li>Known as <strong>nonoverlapping subtypes</strong></li>
<li>Implementation is based on the value of the subtype discriminator attribute in the supertype<br><strong>Overlapping subtypes</strong>: Contain nonunique subsets of the supertype entity set</li>
<li>Implementation requires the use of one discriminator attribute for each subtype</li>
</ul>
</li>
</ul>
<h2><span id="completeness-constraint">Completeness Constraint</span><a href="#completeness-constraint" class="header-anchor">#</a></h2><ul>
<li>Specifies whether each supertype occurrence must also be a member of at least one subtype</li>
<li>Types<ul>
<li><strong>Partial completeness</strong>: Not every supertype occurrence is a member of a subtype</li>
<li><strong>Total completeness</strong>: Every supertype occurrence must be a member of any</li>
</ul>
</li>
</ul>
<h2><span id="entity-cluster">Entity Cluster</span><a href="#entity-cluster" class="header-anchor">#</a></h2><ul>
<li>Virtual entity type used to represent multiple entities and relationships in ERD</li>
<li>Avoid the display of attributes to eliminate complications that result when the inheritance rules change</li>
</ul>
<h1><span id="normalization">Normalization</span><a href="#normalization" class="header-anchor">#</a></h1><h2><span id="normalization-do-normalization-once-a-time-one-entity-a-time">Normalization (Do normalization once a time one entity a time)</span><a href="#normalization-do-normalization-once-a-time-one-entity-a-time" class="header-anchor">#</a></h2><ul>
<li>Evaluating and correcting table structures to minimize data redundancies </li>
<li>Reduces data anomalies</li>
<li>Assigns attributes to tables based on determination</li>
<li>Normal forms<ul>
<li>First normal form (1NF)</li>
<li>Second normal form (2NF)</li>
<li>Third normal form (3NF)</li>
</ul>
</li>
</ul>
<h2><span id="need-for-normalization">Need for Normalization</span><a href="#need-for-normalization" class="header-anchor">#</a></h2><ul>
<li>Used while designing a new database structure<ul>
<li>Analyzes the relationship among the attributes within each entity</li>
<li>Determines if the structure can be improved</li>
</ul>
</li>
<li>Improves the existing data structure and creates an appropriate database design</li>
</ul>
<h2><span id="normalization-process">Normalization Process</span><a href="#normalization-process" class="header-anchor">#</a></h2><ul>
<li>Objective is to ensure that each table conforms to the concept of well-formed relations<ul>
<li>Each table represents a single subject</li>
<li>No data item will be unnecessarily stored in more than one table</li>
<li>All nonprime attributes in a table are wholely dependent on the primary key</li>
<li>Each table is void of insertion, update, and deletion anomalies</li>
</ul>
</li>
<li>Ensures that all tables are in at least 3NF</li>
<li>Higher forms are not likely to be encountered in business environment</li>
<li>Works one relation at a time</li>
<li>Starts by:<ul>
<li>Identifying the dependencies of a relation (table)</li>
<li>Progressively breaking the relation into new set of relations</li>
</ul>
</li>
</ul>
<h2><span id="normal-forms">Normal Forms</span><a href="#normal-forms" class="header-anchor">#</a></h2><table>
<thead>
<tr>
<th align="center">NORMAL FORM</th>
<th align="center">CHARACTERISTIC</th>
</tr>
</thead>
<tbody><tr>
<td align="center">First Normal form(1NF)</td>
<td align="center">Table format, no repeating groups, and PK identified -&gt; Each cell is atomic, cannot be seperated any more</td>
</tr>
<tr>
<td align="center">Second normal form(2NF)</td>
<td align="center">1NF and no partial dependencies</td>
</tr>
<tr>
<td align="center">Third normal form(3NF)</td>
<td align="center">2NF and no transitive dependencies</td>
</tr>
<tr>
<td align="center">*Note: Normalization how-to, in one sentence: work on one relation (table) at a time: identify dependencies, then ‘normalize’ - progressively break it down into smaller relations (tables), based on the dependencies we identify in the original relation</td>
<td align="center"></td>
</tr>
</tbody></table>
<h2><span id="functional-dependence-concepts">Functional Dependence Concepts</span><a href="#functional-dependence-concepts" class="header-anchor">#</a></h2><table>
<thead>
<tr>
<th align="left">Concept</th>
<th align="left">Definition</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Functional dependence</td>
<td align="left">The attribute B is fully functionally dependent on the attribute A if each value of A determines one and only one value of B. -&gt; A determines B</td>
</tr>
<tr>
<td align="left">Functional dependence (Generalized definition)</td>
<td align="left">Attribute A determines attribute B if all of the rows in the table that agree in value for attribute A also agree in value for attribute B.</td>
</tr>
<tr>
<td align="left">Fully functional dependence (composite key)</td>
<td align="left">If attribute B is functionally dependent on a composite key A but not on any Subset of that composite key, the attribute B is fully functionally dependent on A. A is composite Key and any subsets of A is not enough to determine B</td>
</tr>
</tbody></table>
<h2><span id="types-of-functional-dependencies">Types of Functional Dependencies</span><a href="#types-of-functional-dependencies" class="header-anchor">#</a></h2><ul>
<li>Partial dependency: Functional dependence in which the determinant is only part of the primary key (A determines B -&gt; A is determinant)<ul>
<li>Assumption - One candidate key </li>
<li>Straight forward</li>
<li>Easy to identify</li>
<li>It means that the B only fully determined by part of primary key. -&gt; dont need whole compositive key</li>
</ul>
</li>
<li>Transitive dependency: An attribute functionally depends on another nonkey attribute</li>
</ul>
<h2><span id="conversion-to-first-normal-form">Conversion to First Normal Form</span><a href="#conversion-to-first-normal-form" class="header-anchor">#</a></h2><ul>
<li><strong>Repeating group</strong>: Group of multiple entries of same type can exist for any single key attribute occurrence<ul>
<li>Existence proves the presence of data redundancies</li>
</ul>
</li>
<li>Enable reducing data redundancies</li>
<li>Steps<ul>
<li>Eliminate the repeating groups </li>
<li>Identify the primary key </li>
<li>Identify all dependencies</li>
</ul>
</li>
<li><strong>Dependency diagram</strong>: Depicts all dependencies found within given table structure<ul>
<li>Helps to get an overview of all relationships among table’s attributes</li>
<li>Makes it less likely that an important dependency will be overlooked</li>
</ul>
</li>
<li>1NF</li>
<li><img src="/DatabaseRev/1nf.png" alt="1NF"></li>
</ul>
<h2><span id="conversion-to-two-normal-form">Conversion to Two Normal Form</span><a href="#conversion-to-two-normal-form" class="header-anchor">#</a></h2><ul>
<li>Steps <ul>
<li>Make new tables to eliminate partial dependencies</li>
<li>Reassign corresponding dependent attributes</li>
</ul>
</li>
<li>Table is in 2NF when it:<ul>
<li>Is in 1NF</li>
<li>Includes no partial dependencies</li>
</ul>
</li>
<li>2NF</li>
<li><img src="/DatabaseRev/2nf.png" alt="2NF"></li>
</ul>
<h2><span id="conversion-to-third-normal-form">Conversion to Third Normal Form</span><a href="#conversion-to-third-normal-form" class="header-anchor">#</a></h2><ul>
<li>Steps<ul>
<li>Make new tables to eliminate transitive dependencies </li>
<li>Determinant: Any attribute whose value determines other values within a row</li>
<li>Reassign corresponding dependent attributes</li>
</ul>
</li>
<li>Table is in 3NF when it:<ul>
<li>Is in 2NF</li>
<li>Contains no transitive dependencies</li>
</ul>
</li>
<li>3NF</li>
<li><img src="/DatabaseRev/3nf.png" alt="3NF"></li>
</ul>
<h2><span id="requirements-for-good-normalized-set-of-tables">Requirements for Good Normalized Set of Tables</span><a href="#requirements-for-good-normalized-set-of-tables" class="header-anchor">#</a></h2><ul>
<li>Evaluate PK assignments and naming conventions -&gt; create a job_code</li>
<li>evaluate naming conventions -&gt; JOB_CHG_HOUR</li>
<li>Refine attribute atomicity -&gt; EMP_NAME -&gt; first name, last name<ul>
<li><strong>Atomic attribute</strong>: Cannot be further subdivided</li>
<li><strong>Atomicity</strong>: Characteristic of an atomic attribute</li>
</ul>
</li>
<li>Identify new attributes $\And$ new relationships -&gt; EMP_HIREDATE(Add more columns to make it more useful) $\And$ PROJECT can have EMP_NO as FK</li>
<li>Refine primary keys as required for data granularity -&gt; ASSIGN_NUM<ul>
<li><strong>Granularity</strong>: Level of detail represented by the values stored in a table’s row</li>
</ul>
</li>
<li>Maintain historical accuracy $\And$ evaluate using derived attributes -&gt; sotre JOB_CHG_HOUR IN assignment $\And$ ASSIGN_CHARGE (It can be caculatd by xx xx waste space but get better performance))</li>
</ul>
<h2><span id="denormalization">Denormalization</span><a href="#denormalization" class="header-anchor">#</a></h2><ul>
<li>Design goals<ul>
<li>Creation of normalized relations </li>
<li>Processing requirements and speed</li>
</ul>
</li>
<li>Number of database tables expands when tables are decomposed to conform to normalization requirements</li>
<li>Joining a larger number of tables:<ul>
<li>Takes additional input&#x2F;output (I&#x2F;O) operations and processing logic</li>
<li>Reduces system speed</li>
</ul>
</li>
<li>Defects in unnormalized tables<ul>
<li>Data updates are less efficient because tables are larger</li>
<li>Indexing is more cumbersome</li>
<li>No simple strategies for creating virtual tables known as views</li>
</ul>
</li>
</ul>
<h1><span id="transaction-management">Transaction Management</span><a href="#transaction-management" class="header-anchor">#</a></h1><h2><span id="transaction">Transaction</span><a href="#transaction" class="header-anchor">#</a></h2><ul>
<li>Logical unit of work that must be entirely completed or aborted</li>
<li>Consists of:<ul>
<li>SELECT statement </li>
<li>Series of related UPDATE statements</li>
<li>Series of INSERT statements</li>
<li>Combination of SELECT, UPDATE, and INSERT statements</li>
</ul>
</li>
<li><strong>Consistent database state</strong>: All data integrity constraints are satisfied &#x2F;&#x2F; Before transaction, the database is good and clean and after transaction is completed, the transaction will leave the database again in a consistent sate.<ul>
<li>Must begin with the database in a known consistent state to ensure consistency</li>
</ul>
</li>
<li>Formed by two or more database requests<ul>
<li><strong>Database requests</strong>: Equivalent of a single SQL statement in an application program or transaction</li>
</ul>
</li>
<li>Consists of a single SQL statement or a collection of related SQL statements</li>
</ul>
<h2><span id="transaction-properities">Transaction Properities</span><a href="#transaction-properities" class="header-anchor">#</a></h2><ul>
<li><strong>Atomicity</strong>: All operations of a transaction must be completed. If not, the transaction is aborted.</li>
<li><strong>Consistency</strong>: Permanence of database’s consistent state</li>
<li><strong>Isolation</strong>: Data used during transaction cannot be used by second transaction until the first is completed</li>
<li><strong>Durability</strong>: Ensures that once transactions are committed, they cannot be undone or lost</li>
<li><strong>Serializability</strong>: Ensures that the schedule for the concurrent execution of several transactions should yield consistent results</li>
</ul>
<h2><span id="transaction-management-with-sql">Transaction Management with SQL</span><a href="#transaction-management-with-sql" class="header-anchor">#</a></h2><ul>
<li>SQL statements that provide transaction support<ul>
<li>COMMIT </li>
<li>ROLLBACK -&gt; roll back the current transaction to last commit</li>
</ul>
</li>
<li>Transaction sequence must continue until:<ul>
<li>COMMIT statement is reached</li>
<li>ROLLBACK statement is reached</li>
<li>End of program is reached</li>
<li>Program is abnormally terminated</li>
</ul>
</li>
</ul>
<h2><span id="transaction-log">Transaction log</span><a href="#transaction-log" class="header-anchor">#</a></h2><ul>
<li>Keeps track of all transactions that update the database</li>
<li>DBMS uses the information stored in a log for:<ul>
<li>Recovery requirement triggered by a ROLLBACK statement</li>
<li>A program’s abnormal termination</li>
<li>A system failure</li>
</ul>
</li>
</ul>
<h2><span id="concurrency-control">Concurrency Control</span><a href="#concurrency-control" class="header-anchor">#</a></h2><ul>
<li>Coordination of the simultaneous transactions execution in a multiuser database system</li>
<li>Objective - Ensures serializability of transactions in a multiuser database environment</li>
<li>dirty read：一个事务可以读取另一个尚未提交事务的修改数据。</li>
<li>nonrepeatable read：在同一个事务中，同一个查询在T1时间读取某一行，在T2时间重新读取这一行时候，这一行的数据已经发生修改，可能被更新了（update），也可能被删除了（delete）。</li>
<li>phantom read：在同一事务中，同一查询多次进行时候，由于其他插入操作（insert）的事务提交，导致每次返回不同的结果集。</li>
</ul>
<h2><span id="the-scheduler">The Scheduler</span><a href="#the-scheduler" class="header-anchor">#</a></h2><ul>
<li>Establishes the order in which the operations are executed within concurrent transactions <ul>
<li>Interleaves the execution of database operations to ensure serializability and isolation of transactions</li>
</ul>
</li>
<li>Based on concurrent control algorithms to determine the appropriate order</li>
<li>Creates serialization schedule <ul>
<li>Serializable schedule: Interleaved execution of transactions yields the same results as the serial execution of the transactions</li>
</ul>
</li>
</ul>
<h2><span id="concurrency-control-with-locking-methods">Concurrency Control with Locking Methods</span><a href="#concurrency-control-with-locking-methods" class="header-anchor">#</a></h2><ul>
<li>Locking methods - Facilitate isolation of data items used in concurrently executing transactions   </li>
<li><strong>Lock</strong>: Guarantees exclusive use of a data item to a current transaction</li>
<li><strong>Pessimistic locking</strong>: Use of locks based on the assumption that conflict between transactions is likely</li>
<li><strong>Lock manager</strong>: Responsible for assigning and policing the locks used by the transactions</li>
</ul>
<h2><span id="lock-granularity">Lock Granularity</span><a href="#lock-granularity" class="header-anchor">#</a></h2><ul>
<li>Indicates the level of lock use</li>
<li>Levels of locking <ul>
<li>Database-level lock</li>
<li>Table-level lock</li>
<li>Page-level lock<ul>
<li>Page or diskpage: Directly addressable section of a disk</li>
</ul>
</li>
<li>Row-level lock</li>
<li>Field-level lock</li>
</ul>
</li>
</ul>
<h2><span id="lock-types">Lock Types</span><a href="#lock-types" class="header-anchor">#</a></h2><ul>
<li>Binary lock</li>
<li>Has two states, locked (1) and unlocked (0)<ul>
<li>If an object is locked by a transaction, no other transaction can use that object</li>
<li>If an object is unlocked, any transaction can lock the object for its use</li>
</ul>
</li>
<li>Exclusive lock -write<ul>
<li>Exists when access is reserved for the transaction that locked the object</li>
</ul>
</li>
<li>Shared lock -&gt; read<ul>
<li>Exists when concurrent transactions are granted read access on the basis of a common lock</li>
</ul>
</li>
</ul>
<h2><span id="two-phase-locking-2pl-gt-avoid-deadlock">Two-Phase Locking (2PL) -&gt; avoid deadlock</span><a href="#two-phase-locking-2pl-gt-avoid-deadlock" class="header-anchor">#</a></h2><ul>
<li>Defines how transactions acquire and relinquish locks</li>
<li>Guarantees serializability but does not prevent deadlocks </li>
<li>Phases<ul>
<li>Growing phase - Transaction acquires all required locks without unlocking any data</li>
<li>Running operations(middle)</li>
<li>Shrinking phase - Transaction releases all locks and cannot obtain any new lock</li>
</ul>
</li>
<li>Governing rules<ul>
<li>Two transactions cannot have conflicting locks</li>
<li>No unlock operation can precede a lock operation in the same transaction</li>
<li>No data are affected until all locks are obtained</li>
</ul>
</li>
</ul>
<h2><span id="deadlocks">Deadlocks</span><a href="#deadlocks" class="header-anchor">#</a></h2><ul>
<li>Occurs when two transactions wait indefinitely for each other to unlock data<ul>
<li>Known as deadly embrace</li>
</ul>
</li>
<li>Control techniques<ul>
<li>Deadlock prevention possible deadlock detect and kill one of the potential confilct -&gt; timestamp based</li>
<li>Deadlock detection </li>
<li>Deadlock avoidance -&gt; The transaction must obtain all the lock to execute, in the transaction process, no deadlock will occur</li>
</ul>
</li>
<li>Choice of deadlock control method depends on database environment</li>
</ul>
<h2><span id="time-stamping-gt-prevent-deadlock">Time Stamping -&gt; prevent deadlock</span><a href="#time-stamping-gt-prevent-deadlock" class="header-anchor">#</a></h2><ul>
<li>Assigns global, unique time stamp to each transaction<ul>
<li>Produces explicit order in which transactions are submitted to DBMS</li>
</ul>
</li>
<li>Properties<ul>
<li>Uniqueness: Ensures no equal time stamp values exist</li>
<li>Monotonicity: Ensures time stamp values always increases</li>
</ul>
</li>
<li>Disadvantages<ul>
<li>Each value stored in the database requires two additional stamp fields</li>
<li>Increases memory needs</li>
<li>Increases the database’s processing overhead</li>
<li>Demands a lot of system resources</li>
</ul>
</li>
</ul>
<h2><span id="wait-x2f-die-and-wound-x2f-wait-concurrency-control-schema">Wait&#x2F;Die and Wound&#x2F;Wait Concurrency Control Schema</span><a href="#wait-x2f-die-and-wound-x2f-wait-concurrency-control-schema" class="header-anchor">#</a></h2><table>
<thead>
<tr>
<th align="left">Transaction Request Lock</th>
<th align="left">Transaction Owning Lock</th>
<th align="left">WAIT&#x2F;DIE Scheme(People who currently has resources has higher privelege)</th>
<th align="left">Wound&#x2F;Wait Scheme -&gt; Old always first if Old has higher privelege</th>
</tr>
</thead>
<tbody><tr>
<td align="left">T1(11548789)</td>
<td align="left">T2(19562545)</td>
<td align="left">T1 wait until T2 is complete</td>
<td align="left">T1 preempts(rollback) T2 and T2 reschedule</td>
</tr>
<tr>
<td align="left">T2(19562545)</td>
<td align="left">T1(11548789)</td>
<td align="left">T2 dies and reschedule with the same timestamp</td>
<td align="left">T2 waits T1 is completed and T1 releases lock</td>
</tr>
</tbody></table>
<h2><span id="phases-of-optimistic-approach">Phases of Optimistic Approach</span><a href="#phases-of-optimistic-approach" class="header-anchor">#</a></h2><ul>
<li>Read<ul>
<li>Transaction:<ul>
<li>Reads the database</li>
<li>Executes the needed computations</li>
<li>Makes the updates to a private copy of the database values</li>
</ul>
</li>
</ul>
</li>
<li>Validation<ul>
<li>Transaction is validated to ensure that the changes made will not affect the integrity and consistency of the database</li>
</ul>
</li>
<li>Write<ul>
<li>Changes are permanently applied to the database</li>
</ul>
</li>
</ul>
<h1><span id="distributed-dbs">Distributed DBs</span><a href="#distributed-dbs" class="header-anchor">#</a></h1><h2><span id="vertical-scalling-and-horizontal-scalling">Vertical scalling and horizontal scalling</span><a href="#vertical-scalling-and-horizontal-scalling" class="header-anchor">#</a></h2><ul>
<li>Vertical scalling: very bad, it’s take one server and add more and more Gigbyte it run, but it is restricted in one machine</li>
<li>Horizontal scalling: add more and more servers</li>
</ul>
<h2><span id="distributed-processing-and-distributed-databases">Distributed Processing and Distributed Databases</span><a href="#distributed-processing-and-distributed-databases" class="header-anchor">#</a></h2><ul>
<li>Distributed processing: Database’s logical processing is shared among two or more physically independent sites via network</li>
<li>Distributed database: Stores logically related database over two or more physically independent sites via computer network<ul>
<li>Database fragments: Database composed of many parts in distributed database system. EXAMPle: take a table and split it to many pieces</li>
</ul>
</li>
</ul>
<h2><span id="functions-of-distributed-dbms">Functions of Distributed DBMS</span><a href="#functions-of-distributed-dbms" class="header-anchor">#</a></h2><ul>
<li>Receives the request of an application </li>
<li><strong>Validates analyzes</strong>, and decomposes the request</li>
<li>Maps the request</li>
<li>Decomposes request into several I&#x2F;O operations</li>
<li>Searches and validates data</li>
<li>Ensures consistency, security, and integrity</li>
<li>Validates data for specific conditions</li>
<li>Presents data in required format</li>
</ul>
<h2><span id="ddbms-components">DDBMS Components</span><a href="#ddbms-components" class="header-anchor">#</a></h2><ul>
<li>Computer workstations or remote devices</li>
<li>Network hardware and software components</li>
<li>Communications media</li>
<li><strong>Transaction processor (TP)</strong>: Software component of a system that requests data -&gt; access the database and get the query fullfill(make a request)</li>
<li>Known as <strong>transaction manager (TM)</strong> or <strong>application processor (AP)</strong></li>
<li><strong>Data processor (DP)</strong> or <strong>data manager (DM)</strong> -&gt; Only serve data dont care where the request come from</li>
<li>Software component on a system that stores and retrieves data from its location</li>
</ul>
<h2><span id="single-site-processing-single-site-data-mpsd-pretty-simple">Single-Site Processing, Single-Site Data(MPSD) pretty simple</span><a href="#single-site-processing-single-site-data-mpsd-pretty-simple" class="header-anchor">#</a></h2><h2><span id="multiple-site-processing-single-site-data-mpsd">Multiple-Site Processing, Single-Site Data (MPSD)</span><a href="#multiple-site-processing-single-site-data-mpsd" class="header-anchor">#</a></h2><ul>
<li>Multiple processes run on different computers sharing a single data repository</li>
<li>Require network file server running conventional applications <ul>
<li>Accessed through LAN</li>
</ul>
</li>
<li><strong>Client&#x2F;server architecture</strong><br>Reduces network traffic<br>Processing is distributed<br>Supports data at multiple sites</li>
</ul>
<h2><span id="multiple-site-processing-single-site-data-mpsd">Multiple-Site Processing, Single-Site Data (MPSD)</span><a href="#multiple-site-processing-single-site-data-mpsd" class="header-anchor">#</a></h2><ul>
<li>Fully distributed database management system<ul>
<li>Support multiple data processors and transaction processors at multiple sites</li>
</ul>
</li>
<li>Classification of DDBMS depending on the level of support for various types of databases<ul>
<li>Homogeneous: Integrate multiple instances of same DBMS over a network -&gt; all databases are in the same model(all oracle&#x2F;mysql)</li>
<li>Heterogeneous: Integrate different types of DBMSs -&gt; can have different vendors(oracle, mysql,sqlite) but must follow the same relational model</li>
<li>Fully heterogeneous: Support different DBMSs, each supporting different data model (some maybe noSQL data&#x2F;graph&#x2F;kv pairs)</li>
</ul>
</li>
</ul>
<h2><span id="restrictions-of-ddbms">Restrictions of DDBMS</span><a href="#restrictions-of-ddbms" class="header-anchor">#</a></h2><ul>
<li>Remote access is provided on a read-only basis</li>
<li>Restrictions on the number of remote tables that may be accessed in a single transaction</li>
<li>Restrictions on the number of distinct databases that may be accessed</li>
<li>Restrictions on the database model that may be accessed</li>
</ul>
<h2><span id="distributed-requests-and-distributed-transactions">Distributed Requests and Distributed Transactions</span><a href="#distributed-requests-and-distributed-transactions" class="header-anchor">#</a></h2><ul>
<li>Remote request<ul>
<li>Single SQL statement accesses data processed by a single remote database processor</li>
</ul>
</li>
<li>Remote transaction<ul>
<li>Accesses data at single remote site composed of several requests</li>
</ul>
</li>
<li>Distributed transaction<ul>
<li>Requests data from several different remote sites on network</li>
</ul>
</li>
<li>Distributed request<ul>
<li>Single SQL statement references data at several DP sites</li>
</ul>
</li>
</ul>
<h2><span id="distributed-concurrency-control-2pc-2-phrase-commit">Distributed Concurrency Control (2PC 2 phrase commit)</span><a href="#distributed-concurrency-control-2pc-2-phrase-commit" class="header-anchor">#</a></h2><ul>
<li>Concurrency control is important in distributed databases environment<ul>
<li>Due to multi-site multiple-process operations that create inconsistencies and deadlocked transactions</li>
</ul>
</li>
</ul>
<h2><span id="two-phase-commit-protocol-2pc">Two-Phase Commit Protocol(2PC)</span><a href="#two-phase-commit-protocol-2pc" class="header-anchor">#</a></h2><ul>
<li><p>Guarantees if a portion of a transaction operation cannot be committed, all changes made at the other sites will be undone </p>
<ul>
<li>To maintain a consistent database state</li>
</ul>
</li>
<li><p>Requires that each DP’s transaction log entry be written before database fragment is updated</p>
</li>
<li><p><strong>DO-UNDO-REDO protocol</strong>: Roll transactions back and forward with the help of the system’s transaction log entries</p>
</li>
<li><p><strong>Write-ahead protocol</strong>: Forces the log entry to be written to permanent storage before actual operation takes place </p>
</li>
<li><p>Defines operations between <strong>coordinator</strong> and <strong>subordinates</strong></p>
</li>
<li><p>Phases of implementation</p>
<ul>
<li><ol>
<li>Preparation -&gt; request if others can commit or not(failure happends)</li>
</ol>
</li>
<li><ol start="2">
<li>The final COMMIT -&gt; Tell all others they can commit</li>
</ol>
</li>
</ul>
</li>
<li><p>Details:</p>
</li>
<li><p>第一阶段：准备<br>协调器发送一个PREPARE TO COMMIT信息给所有的从属者。</p>
<p>从属者接到这个信息，使用先写协议，写入事务日志并发送一个确认信息（YES&#x2F;PREPARED TO COMMIT或NO&#x2F;NO PREPARED）给协调器。<br>协调器确保所有节点要么提交，要么取消。<br>如果所有节点为PREPARED TO COMMIT，事务调转到第二阶段。如果有一个或多个节点为NO或NO PREPARED协调器就给所有从属者发送一个ABORT。</p>
<p>第二阶段：最后的提交</p>
<p>协调器广播一个COMMIT信息给所有从属者并等待回复。<br>每个从属者接收到COMMIT信息并且使用DO协议更性数据库。<br>从属者回复一个 COMMITTED或者NOT COMMITTED信息给协调器。<br>如果一个或者多个从属者没有提交，协调器就发送一个ABORT消息，这样就使它们都取消所有的操作。</p>
<p>两阶段提交的目的是为了确保每个节点都提交事务自己所操作的部分；否则，事务就取消。如果其中一个节点提交失败，就用事务日志来恢复数据库的信息，而且使用的是DO-UNDO-REDO协议来恢复（记住使用先写协议更新日志信息）。</p>
</li>
<li><p>CUBRID -&gt; how transaction manager&#x2F;distribute a good example</p>
</li>
</ul>
<h2><span id="transparency-hide-sth-to-users">Transparency (Hide sth to users)</span><a href="#transparency-hide-sth-to-users" class="header-anchor">#</a></h2><ul>
<li>Distribution transparency: The users dont know the databases are distrubuted<ul>
<li>Allows management of physically dispersed database as if centralized(好像是centralized的)</li>
<li>Levels<ul>
<li>Fragmentation transparency </li>
<li>Location transparency </li>
<li>Local mapping transparency</li>
</ul>
</li>
</ul>
</li>
<li>Transaction transparency: The users dont know what parts of transaction happens where<ul>
<li>Ensures database transactions will maintain distributed database’s integrity and consistency</li>
<li>Ensures transaction completed only when all database sites involved complete their part</li>
<li>Distributed database systems require complex mechanisms to manage transactions</li>
</ul>
</li>
<li>Failure transparency: If the query go to one place, the place is down, they the user will not feel that. reroute to other copies<ul>
<li>Ensures the system will operate in case of network failure</li>
<li>Considerations for resolving requests in a distributed data environment<ul>
<li>Data distribution</li>
<li>Data replication<ul>
<li><strong>Replica transparency</strong>: DDBMS’s ability to hide multiple copies of data from the user</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Performance transparency: Hide latency.<ul>
<li>Allows a DDBMS to perform as if it were a centralized database</li>
</ul>
</li>
<li>Network and node availability<ul>
<li><strong>Network latency</strong>: delay imposed by the amount of time required for a data packet to make a round trip</li>
<li><strong>Network partitioning</strong>: delay imposed when nodes become suddenly unavailable due to a network failure</li>
</ul>
</li>
<li>Heterogeneity transparency: dont know what operating system&#x2F; database system …</li>
</ul>
<h2><span id="distributed-database-design">Distributed Database Design</span><a href="#distributed-database-design" class="header-anchor">#</a></h2><ul>
<li><strong>Data fragmentation</strong>: How to partition database into fragments</li>
<li><strong>Data replication</strong>: Which fragments to replicate</li>
<li><strong>Data allocation</strong>: Where to locate those fragments and replicas</li>
</ul>
<h2><span id="data-fragmentation">Data Fragmentation</span><a href="#data-fragmentation" class="header-anchor">#</a></h2><ul>
<li>Breaks single object into many segments<br>Information is stored in distributed data catalog (DDC)</li>
<li>Strategies<ul>
<li><strong>Horizontal fragmentation</strong>: Division of a relation into subsets (fragments) of tuples (rows)</li>
<li><strong>Vertical fragmentation</strong>: Division of a relation into attribute (column) subsets</li>
<li><strong>Mixed fragmentation</strong>: Combination of horizontal and vertical strategies</li>
</ul>
</li>
</ul>
<h2><span id="data-replication">Data Replication</span><a href="#data-replication" class="header-anchor">#</a></h2><ul>
<li>Data copies stored at multiple sites served by a computer network</li>
<li><strong>Mutual consistency rule</strong>: Replicated data fragments should be identical</li>
<li>Styles of replication -&gt; How to make changes propogate<ul>
<li>Push replication -&gt; send changes to others</li>
<li>Pull replication -&gt; pull others’ changes</li>
</ul>
</li>
<li>Helps restore lost data</li>
</ul>
<h2><span id="data-replication-scenarios">Data Replication Scenarios</span><a href="#data-replication-scenarios" class="header-anchor">#</a></h2><ul>
<li>Fully replicated database<ul>
<li>Stores multiple copies of each database fragment at multiple sites</li>
</ul>
</li>
<li>Partially replicated database<ul>
<li>Stores multiple copies of some database fragments at multiple sites</li>
</ul>
</li>
<li>Unreplicated database<ul>
<li>Stores each database fragment at a single site</li>
</ul>
</li>
</ul>
<h2><span id="data-allocation-strategies">Data Allocation Strategies</span><a href="#data-allocation-strategies" class="header-anchor">#</a></h2><ul>
<li>Centralized data allocation<ul>
<li>Entire database stored at one site</li>
</ul>
</li>
<li>Partitioned data allocation<ul>
<li>Database is divided into two or more disjoined fragments and stored at two or more sites</li>
</ul>
</li>
<li>Replicated data allocation<ul>
<li>Copies of one or more database fragments are stored at several sites</li>
</ul>
</li>
</ul>
<h2><span id="the-cap-theorem-that-s-what-u-need-consider-when-you-design-a-database">The CAP Theorem (That’s what u need consider when you design a database)</span><a href="#the-cap-theorem-that-s-what-u-need-consider-when-you-design-a-database" class="header-anchor">#</a></h2><ul>
<li>CAP stands for:<ul>
<li>Consistency: Are all partitions of data keeping the same </li>
<li>Availability: if some nodes are down, the system can still work</li>
<li>Partition tolerance: the cluster continues to function even if there is a “partition” (communication break) between two nodes (both nodes are up, but can’t communicate). -&gt; Continue to work even some nodes fail</li>
</ul>
</li>
<li><strong>Basically available, soft state, eventually consistent (BASE)</strong><ul>
<li>Data changes are not immediate but propagate slowly through the system until all replicas are consistent</li>
</ul>
</li>
</ul>
<h2><span id="database-connectivity">Database Connectivity</span><a href="#database-connectivity" class="header-anchor">#</a></h2><p><strong>Database middleware</strong>: Provides an interface between the application program and the database<br><strong>Data repository&#x2F;source</strong> - Data management application used to store data generated by an application program<br><strong>Universal Data Access (UDA)</strong>: Collection of technologies used to access any type of data source and manage the data through a common interface<br>ODBC, OLE-DB, ADO.NET form the backbone of MS UDA architecture</p>
<h2><span id="various-connectivity-options">Various connectivity options</span><a href="#various-connectivity-options" class="header-anchor">#</a></h2><ul>
<li><p>Native SQL(provided by vendors)</p>
<ul>
<li>Connection interface provided by database vendors, which is unique to each vendor</li>
<li>Interfaces are optimized for particular vendor’s DBMS<ul>
<li>Maintenance is a burden for the programmer</li>
</ul>
</li>
</ul>
</li>
<li><p>M’soft: 1.ODBC(Open database connectivity(Microsoft’s implementation of a superset of SQL Access Group)), DAO(Data Access Object)+JET, RDO(Remote Data Object)</p>
<ul>
<li>ODBC<ul>
<li>Open Database Connectivity (ODBC):Microsoft’s implementation of a superset of SQL Access Group Call Level Interface (CLI) standard for database access</li>
<li>Widely supported database connectivity interface</li>
<li>Allows Windows application to access relational data sources by using SQL via standard application programming interface (API)</li>
</ul>
</li>
<li>Data Access Objects(DAO)<ul>
<li>Object-oriented API used to access MS Access, MS FoxPro, and dBase databases from Visual Basic programs</li>
<li>Provides an optimized interface that expose functionality of Jet data engine to programmers</li>
<li>DAO interface can be used to access other relational style data sources</li>
<li>Jet is a wrapper of DAO</li>
</ul>
</li>
<li>Remote Data Objects (RDO)<ul>
<li>Higher-level object-oriented application interface used to access remote database servers</li>
</ul>
</li>
<li>Dynamic-link libraries (DLLs)<ul>
<li>Implements ODBC, DAO, and RDO as shared code that is dynamically linked to the Windows operating environment</li>
</ul>
</li>
</ul>
</li>
<li><p>M’soft: OLE-DB(open linking embeding db)</p>
</li>
<li><p>M’soft: ADO.NET(Access Data Object)</p>
</li>
<li><p>JDBC(from Sum)</p>
</li>
</ul>
<h2><span id="components-of-odbc-architecture">Components of ODBC Architecture</span><a href="#components-of-odbc-architecture" class="header-anchor">#</a></h2><ul>
<li>High-level ODBC API through which application programs access ODBC functionality -&gt; face to program</li>
<li>Driver manager that is in charge of managing all database connections -&gt; face to table</li>
<li>ODBC driver that communicates directly to DBMS</li>
</ul>
<h2><span id="object-linking-and-embedding-for-database-ole-db-database-becomes-object">Object Linking and Embedding for Database (OLE-DB) Database becomes object</span><a href="#object-linking-and-embedding-for-database-ole-db-database-becomes-object" class="header-anchor">#</a></h2><p>Before: OMG(object management group)<br>CORBA: COMMON OBJECT REQUEST BREAKER ARCHITECHTURE -&gt; Object exchange from different os regardless different memory</p>
<ul>
<li>Database middleware that adds object-oriented functionality for access to data</li>
<li>Series of COM(component object model) objects provides low-level database connectivity for applications</li>
<li>Types of objects based on functionality<ul>
<li>Consumers(request data)</li>
<li>Providers(produce data)</li>
</ul>
</li>
<li>Does not provide support for scripting languages</li>
<li>ActiveX Data Objects (ADO): Provides:</li>
<li>High-level application-oriented interface to interact with OLE-DB, DAO, and RDO</li>
<li>Unified interface to access data from any programming language that uses the underlying OLE-DB objects</li>
<li>ADO.NET<ul>
<li>Data access component of Microsoft’s .NET application development framework</li>
</ul>
</li>
<li>Microsoft’s .NET framework<ul>
<li>Component-based platform for developing distributed, heterogeneous, interoperable applications </li>
<li>Manipulates any type of data using any combination of network, operating system, and programming language</li>
</ul>
</li>
<li>Features critical for the development of distributed applications<ul>
<li>DataSet: Disconnected memory-resident representation of database</li>
<li>XML support <ul>
<li>DataSet is internally stored in XML format</li>
<li>Data in DataSet is made persistent as XML documents</li>
<li>DataSet is internally stored in XML format</li>
<li>Data in DataSet made persistent as XML documents</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2><span id="database-internet-connectivity">Database Internet Connectivity</span><a href="#database-internet-connectivity" class="header-anchor">#</a></h2><ul>
<li>Allows new innovative services that:<ul>
<li>Permit rapid response by bringing new services and products to market quickly</li>
<li>Increase customer satisfaction through creation of web-based support services</li>
<li>Allow anywhere, anytime data access using mobile smart devices via the Internet</li>
<li>Yield fast and effective information dissemination through universal access</li>
</ul>
</li>
</ul>
<h2><span id="web-to-database-middleware">Web-to-Database Middleware</span><a href="#web-to-database-middleware" class="header-anchor">#</a></h2><ul>
<li>Web server is the main hub through which Internet services are accessed</li>
<li><strong>Server-side extension</strong>: Program that interacts directly with the web server<ul>
<li>Known as <strong>web-to-database middleware</strong></li>
<li>Provides its services to the web server in a way that is totally transparent to the client browser</li>
</ul>
</li>
<li>Middleware must be well integrated</li>
</ul>
<h2><span id="client-side-extensions">Client-Side Extensions</span><a href="#client-side-extensions" class="header-anchor">#</a></h2><ul>
<li>Add functionality to Web browser</li>
<li>Types <ul>
<li>Plug-in: External application automatically invoked by the browser when needed</li>
<li>Java and JavaScript: Embedded in web page<ul>
<li>Downloaded with the Web page and activated by an event</li>
</ul>
</li>
</ul>
</li>
<li>ActiveX and VBScript: Embedded in web page<ul>
<li>Downloaded with page and activated by event</li>
<li>Oriented to Windows applications</li>
</ul>
</li>
</ul>
<h1><span id="performance-tuning-and-query-optimization">Performance Tuning and Query Optimization</span><a href="#performance-tuning-and-query-optimization" class="header-anchor">#</a></h1><h2><span id="tuning-database-performance-tuning-concepts">Tuning(Database Performance-Tuning Concepts)</span><a href="#tuning-database-performance-tuning-concepts" class="header-anchor">#</a></h2><ul>
<li>Goal of database performance is to execute queries as fast as possible</li>
<li>Database performance tuning: Set of activities and procedures that reduce response time of database system</li>
<li>Fine-tuning the performance of a system requires that all factors must operate at optimum level with minimal bottlenecks</li>
</ul>
<h2><span id="performance-tuning-client-and-server">Performance Tuning: Client and Server</span><a href="#performance-tuning-client-and-server" class="header-anchor">#</a></h2><h3><span id="client-side">Client side</span><a href="#client-side" class="header-anchor">#</a></h3><ul>
<li>SQL performance tuning: Generates SQL query that returns correct answer in least amount of time -&gt; suppose A and B and C-&gt; A should fail many times. Re-arranging sql query language<ul>
<li>Using minimum amount of resources at server</li>
</ul>
</li>
</ul>
<h3><span id="server-side">Server side</span><a href="#server-side" class="header-anchor">#</a></h3><ul>
<li>DBMS performance tuning: DBMS environment configured to respond to clients’ requests as fast as possible<ul>
<li>Optimum use of existing resources</li>
</ul>
</li>
</ul>
<h2><span id="dbms-architecture">DBMS Architecture</span><a href="#dbms-architecture" class="header-anchor">#</a></h2><ul>
<li>All data in a database are stored in <strong>data files</strong><ul>
<li>Data files automatically <strong>expand</strong> in predefined increments known as extends</li>
</ul>
</li>
<li>Data files are grouped in <strong>file groups</strong> or <strong>table spaces</strong><ul>
<li><strong>Table space</strong> or <strong>file group</strong>: Logical grouping of several data files that store data with similar characteristics</li>
</ul>
</li>
<li><strong>Data cache</strong> or <strong>buffer cache</strong>: Shared, reserved memory area<ul>
<li>Stores most recently accessed data blocks in RAM</li>
</ul>
</li>
<li><strong>SQL cache</strong> or <strong>procedure cache</strong>: Stores most recently executed SQL statements or PL&#x2F;SQL procedures</li>
<li>DBMS retrieves data from permanent storage and places them in RAM <strong>Input&#x2F;output request</strong>: Low-level data access operation that reads or writes data to and from computer devices</li>
<li>Data cache is faster than working with data files </li>
<li>Majority of performance-tuning activities focus on minimizing I&#x2F;O operations</li>
<li><strong>Listener</strong> The listener process listens for clients’ requests and handles the processing of the SQL requests to other DBMS processes. Once a request is received, the listener passes the request to the appropriate user process</li>
<li><strong>User</strong> The DBSM creates a user process to manager each client session. Therefore, when you log on to the DBMS, you are assigned a user process. This process handles all requests you submit to the server. There are many user processes-at least onper logged-in client.</li>
<li><strong>Scheduler</strong> The scheduler process organizes the concurrent execution of SQL requests.</li>
<li><strong>Lock Mnager</strong> This process manages all locks placed on database objects, including disk pages</li>
<li><strong>Optimizer</strong> The optimizer analyzes SQL queries and finds the most efficient way to access the data. &#x2F;&#x2F; How can we make it better.</li>
</ul>
<h2><span id="database-query-optimization-modes">Database Query Optimization Modes</span><a href="#database-query-optimization-modes" class="header-anchor">#</a></h2><ul>
<li>Algorithms proposed for query optimization are based on:<ul>
<li>Selection of the optimum order to achieve the fastest execution time &#x2F;&#x2F; The order to visit each table</li>
<li>Selection of sites to be accessed to minimize communication costs</li>
</ul>
</li>
<li>Evaluated on the basis of: <ul>
<li>Operation mode</li>
<li>Timing of its optimization</li>
<li>Type of information(used for optimization)</li>
</ul>
</li>
</ul>
<h2><span id="classification-of-operation-modes">Classification of Operation Modes</span><a href="#classification-of-operation-modes" class="header-anchor">#</a></h2><ul>
<li>Automatic query optimization: DBMS finds the most cost-effective access path without user intervention</li>
<li>Manual query optimization: Requires that the optimization be selected and scheduled by the end user or programmer</li>
</ul>
<h2><span id="based-on-timing-of-optimization">Based on Timing of Optimization</span><a href="#based-on-timing-of-optimization" class="header-anchor">#</a></h2><ul>
<li><strong>Static query optimization</strong>: best optimization strategy is selected when the query is compiled by the DBMS<ul>
<li>Takes place at compilation time</li>
</ul>
</li>
<li><strong>Dynamic query optimization</strong>: Access strategy is dynamically determined by the DBMS at run time, using the most up-to-date information about the database<ul>
<li>Takes place at execution time: more processing ahead</li>
</ul>
</li>
</ul>
<h2><span id="type-of-information-used-to-optimize">Type of Information Used to Optimize</span><a href="#type-of-information-used-to-optimize" class="header-anchor">#</a></h2><ul>
<li><strong>Statistically based query optimization algorithm</strong>: Statistics are used by the DBMS to determine the best access strategy</li>
<li>Statistical information is generated by DBMS through: <ul>
<li><strong>Dynamic statistical generation mode - auto eval</strong></li>
<li><strong>Manual statistical generation mode - via user</strong></li>
</ul>
</li>
<li><strong>Rule-based query optimization algorithm</strong>: based on a set of user-defined rules to determine the best query access strategy</li>
</ul>
<h2><span id="sample-database-statistics-measurements">Sample Database Statistics Measurements</span><a href="#sample-database-statistics-measurements" class="header-anchor">#</a></h2><p><img src="/DatabaseRev/SampleDatabaseStatic.png" alt="Advantages and Disadvantages of Storing Derived Attributes"></p>
<h2><span id="query-processing">Query Processing</span><a href="#query-processing" class="header-anchor">#</a></h2><ul>
<li>Parsing<ul>
<li>DBMS parses the SQL query and chooses the most efficient access&#x2F;execution plan</li>
</ul>
</li>
<li>Execution<ul>
<li>DBMS executes the SQL query using the chosen execution plan</li>
</ul>
</li>
<li>Fetching<ul>
<li>DBMS fetches the data and sends the result set back to the client</li>
</ul>
</li>
</ul>
<h2><span id="sql-parsing-phase">SQL Parsing Phase</span><a href="#sql-parsing-phase" class="header-anchor">#</a></h2><ul>
<li>Query is broken down into smaller units</li>
<li>Original SQL query transformed into slightly different version of original SQL code which is fully equivalent and more efficient</li>
<li><strong>Query optimizer</strong>: Analyzes SQL query and finds most efficient way to access data</li>
<li><strong>Access plans</strong>: DBMS-specific and translate client’s SQL query into a series of complex I&#x2F;O operations</li>
<li>If access plan already exists for query in SQL cache, DBMS reuses it</li>
<li>If not, optimizer evaluates various plans and chooses one to be placed in SQL cache for use</li>
</ul>
<h2><span id="sql-execution-phase">SQL Execution Phase</span><a href="#sql-execution-phase" class="header-anchor">#</a></h2><ul>
<li>All I&#x2F;O operations indicated in the access plan are executed<ul>
<li>Locks are acquired</li>
<li>Data are retrieved and placed in data cache</li>
<li>Transaction management commands are processed</li>
</ul>
</li>
</ul>
<h2><span id="sql-fetching-phase">SQL Fetching Phase</span><a href="#sql-fetching-phase" class="header-anchor">#</a></h2><ul>
<li>Rows of resulting query result set are returned to client<ul>
<li>DBMS may use temporary table space to store temporary data</li>
<li>Database server coordinates the movement of the result set rows from the server cache to the client cache</li>
</ul>
</li>
</ul>
<h2><span id="query-processing-bottlenecks">Query Processing Bottlenecks</span><a href="#query-processing-bottlenecks" class="header-anchor">#</a></h2><ul>
<li>Delay introduced in the processing of an I&#x2F;O operation that slows the system</li>
<li>Caused by the: <ul>
<li>CPU</li>
<li>RAM</li>
<li>Hard disk</li>
<li>Network</li>
<li>Application code</li>
</ul>
</li>
</ul>
<h2><span id="indexes-and-query-optimization">Indexes and Query Optimization</span><a href="#indexes-and-query-optimization" class="header-anchor">#</a></h2><ul>
<li>Indexes<ul>
<li>Help speed up data access</li>
<li>Facilitate searching, sorting, using aggregate functions, and join operations</li>
<li>Ordered set of values that contain the index key and pointers</li>
<li>More efficient than a full table scan</li>
</ul>
</li>
</ul>
<h2><span id="indexes-and-query-optimization">Indexes and Query Optimization</span><a href="#indexes-and-query-optimization" class="header-anchor">#</a></h2><ul>
<li>Data sparsity: Number of different values a column could have; low sparsity &#x3D;&gt; index might be useless</li>
<li>Data structures used to implement indexes: <ul>
<li>Hash indexes -&gt; Bitl generate short-link by hash function</li>
<li>B-tree indexes</li>
<li>Bitmap indexes</li>
</ul>
</li>
<li>DBMSs determine best type of index to use</li>
</ul>
<h2><span id="index-selectivity">index Selectivity</span><a href="#index-selectivity" class="header-anchor">#</a></h2><ul>
<li>Measure of the likelihood that an index will be used in query processing. So we strive to create indexes that have high selectivity.</li>
<li>Indexes are used when a subset of rows from a large table is to be selected based on a given condition</li>
<li>Index cannot always be used to improve performance</li>
<li><strong>Function-based index</strong>: Based on a specific SQL function or expression(eg. EMP_SALARY + EMP_COMMISSION)</li>
<li>Indexes are useful when<ul>
<li>an indexable column occurs in a WHERE or HAVING search expression</li>
<li>an indexable column appears in a GROUP BY or ORDER BY clause</li>
<li>MAX or MIN is applied to an indexable column</li>
<li>there is high data sparsity on an indexable column</li>
</ul>
</li>
<li>Worth creating indexes on single columns that appear in WHERE, HAVING, ORDER BY, GROUP BY and join conditions.</li>
</ul>
<h2><span id="optimizer-choices-gt-statisitc-based">Optimizer Choices -&gt; statisitc-based</span><a href="#optimizer-choices-gt-statisitc-based" class="header-anchor">#</a></h2><ul>
<li><strong>Rule-based optimizer</strong>: Uses preset rules and points to determine the best approach to execute a query</li>
<li><strong>Cost-based optimizer</strong>: Uses algorithms based on statistics about objects being accessed to determine the best approach to execute a query(collect all kinds of costs and choose on lowest cost)</li>
</ul>
<h2><span id="using-hints-to-affect-optimizer-choices">Using Hints to Affect Optimizer Choices</span><a href="#using-hints-to-affect-optimizer-choices" class="header-anchor">#</a></h2><ul>
<li>Optimizer might not choose the best execution plan<ul>
<li>Makes decisions based on existing statistics, which might be old</li>
<li>Might choose less-efficient decisions</li>
</ul>
</li>
<li>Optimizer hints: Special instructions for the optimizer, embedded in the SQL command text</li>
<li>Example</li>
<li><img src="/DatabaseRev/optimizerHints.png" alt="Optimizer Hints"></li>
</ul>
<h2><span id="conditional-expressions">Conditional Expressions</span><a href="#conditional-expressions" class="header-anchor">#</a></h2><ul>
<li>Equality comparisons are faster than inequality comparisons</li>
<li>Transform conditional expressions to use literals</li>
<li>Write equality conditions first when using multiple conditional expressions</li>
<li>When using multiple AND conditions, write the condition most likely to be false first</li>
<li>When using multiple OR conditions, put the condition most likely to be true first</li>
<li>Avoid the use of NOT logical operator</li>
</ul>
<h2><span id="query-formulation">Query Formulation</span><a href="#query-formulation" class="header-anchor">#</a></h2><ul>
<li>Identify what columns and computations are required §Identify source tables</li>
<li>Determine how to join tables</li>
<li>Determine what selection criteria are needed</li>
<li>Determine the order in which to display the output</li>
</ul>
<h2><span id="dbms-performance-tuning">DBMS Performance Tuning</span><a href="#dbms-performance-tuning" class="header-anchor">#</a></h2><ul>
<li>Managing DBMS processes in primary memory and the structures in physical storage</li>
<li>DBMS performance tuning at server end focuses on setting parameters used for:<ul>
<li>Data cache</li>
<li>SQL cache</li>
<li>Sort cache</li>
<li>Optimizer mode</li>
</ul>
</li>
<li><strong>In-memory database</strong>: Store large portions of the database in primary storage</li>
<li>Recommendations for physical storage of databases:<ul>
<li>Use RAID (Redundant Array of Independent Disks) to provide a balance between performance improvement and fault tolerance</li>
<li>Minimize disk contention</li>
<li>Put high-usage tables in their own table spaces</li>
<li>Assign separate data files in separate storage volumes for indexes, system, and high-usage tables</li>
</ul>
</li>
<li>Take advantage of the various table storage organizations in the database</li>
<li>Index-organized table or clustered index table: Stores the end-user data and the index data in consecutive locations in permanent storage</li>
<li>Partition tables based on usage</li>
<li>Use denormalized tables where appropriate </li>
<li>Store computed and aggregate attributes in tables</li>
</ul>
<h1><span id="business-intelligence">Business Intelligence</span><a href="#business-intelligence" class="header-anchor">#</a></h1><h2><span id="business-intelligence-bi">Business Intelligence(BI)</span><a href="#business-intelligence-bi" class="header-anchor">#</a></h2><ul>
<li>Comprehensive, cohesive, integrated set of tools and processes<ul>
<li>Captures, collects, integrates, stores, and analyzes data</li>
</ul>
</li>
<li>Generates and presents information to support business decision making</li>
<li>Allows a business to transform:<ul>
<li>Data into information</li>
<li>Information into knowledge</li>
<li>Knowledge into wisdom</li>
</ul>
</li>
<li>ETL: extraction transformation and loading</li>
<li>QUERY &amp; Reporting : include ml algorithm</li>
<li>Governance: How often to upadte warehouse</li>
<li>Management: How ETL happens<br><img src="/DatabaseRev/BUSINESS_INTELLIGENCE_FRAMEWORK.png" alt="Optimizer Hints"></li>
</ul>
<h2><span id="business-intelligence-benefits">Business Intelligence Benefits</span><a href="#business-intelligence-benefits" class="header-anchor">#</a></h2><ul>
<li>Improve decision making</li>
<li>Integrating architecture</li>
<li>Common user interface for data reporting and analysis</li>
<li>Common data repository fosters single version of company data</li>
<li>Imporeve organizational performance</li>
</ul>
<h2><span id="decision-support-data">Decision Support Data</span><a href="#decision-support-data" class="header-anchor">#</a></h2><ul>
<li>Effectiveness of BI depends on quality of data gathered at operational level</li>
<li>Operational data<ul>
<li>Seldom well-suited for decision support tasks</li>
<li>Stored in relational database with highly normalized structures</li>
<li>Optimized to support transactions representing daily operations</li>
</ul>
</li>
<li>Differ from operational data in:</li>
<li>Time span</li>
<li>Granularity<ul>
<li><strong>Drill down</strong>: Decomposing a data to a lower level </li>
<li><strong>Roll up</strong>: Aggregating a data into a higher level</li>
</ul>
</li>
<li>Dimensionality</li>
</ul>
<h2><span id="decision-support-database-requirements">Decision Support Database Requirements</span><a href="#decision-support-database-requirements" class="header-anchor">#</a></h2><ul>
<li>Database schema<ul>
<li>Must support complex, non-normalized data representations</li>
<li>Data must be aggregated and summarized</li>
<li>Queries must be able to extract multidimensional time slices</li>
</ul>
</li>
<li>Data extraction and loading<ul>
<li>Allow batch and scheduled data extraction</li>
<li>Support different data sources and check for inconsistent data or data validation rules</li>
<li>Support advanced integration, aggregation, and classification</li>
</ul>
</li>
<li>Database size should support<ul>
<li>Very large databases (VLDBs) </li>
<li>Advanced storage technologies </li>
<li>Multiple-processor technologies</li>
</ul>
</li>
</ul>
<h2><span id="data-marts">Data Marts</span><a href="#data-marts" class="header-anchor">#</a></h2><ul>
<li>Small, single-subject data warehouse subset</li>
<li>Provide decision support to a small group of people</li>
<li>Benefits over data warehouses</li>
<li>Lower cost and shorter implementation time § Technologically advanced</li>
<li>Inevitable people issues</li>
</ul>
<h2><span id="components-of-star-schemas">Components of Star Schemas</span><a href="#components-of-star-schemas" class="header-anchor">#</a></h2><ul>
<li>Facts<ul>
<li>Numeric values that represent a specific business aspect</li>
</ul>
</li>
<li>Dimensions <ul>
<li>Qualifying characteristics that provide additional perspectives to a given fact</li>
</ul>
</li>
<li>Attributes<ul>
<li>Used to search, filter, and classify facts</li>
<li><strong>Slice and dice</strong>: Ability to focus on slices of the data cube for more detailed analysis.</li>
</ul>
</li>
<li>Attribute hierarchy<ul>
<li>Provides a top-down data organization</li>
</ul>
</li>
</ul>
<h2><span id="performance-improving-techniques-for-the-star-schema">Performance-Improving Techniques for the Star Schema</span><a href="#performance-improving-techniques-for-the-star-schema" class="header-anchor">#</a></h2><ul>
<li>Normalizing dimensional tables<ul>
<li><strong>Snowflake schema</strong>: Dimension tables can have their own dimension tables</li>
</ul>
</li>
<li>Maintaining multiple fact tables to represent different aggregation levels</li>
<li>Denormalizing fact tables</li>
</ul>
<h2><span id="data-anaytics">Data Anaytics</span><a href="#data-anaytics" class="header-anchor">#</a></h2><ul>
<li>Encompasses a wide range of mathematical, statistical, and modeling techiques to extract knowledge from data<ul>
<li>subset of BI functionality</li>
</ul>
</li>
<li>Classfication of tools<ul>
<li><strong>Explanatory analytics</strong>: Focuses on discovering and explaining data characteristics and relationships based on existing data</li>
<li><strong>Predictive analytics</strong>: Focuses on predicting future outcomes with a high degree of accuracy</li>
</ul>
</li>
</ul>
<h2><span id="olap-gt-online-analytical-processing">OLAP-&gt; Online Analytical Processing</span><a href="#olap-gt-online-analytical-processing" class="header-anchor">#</a></h2><ul>
<li>Advanced data analysis environment that supports decision making, business modeling, and operations research</li>
<li>Characteristics:<ul>
<li>Multidimensional data analysis techniques</li>
<li>Advanced database support</li>
<li>Easy-to-use end-user interfaces</li>
</ul>
</li>
</ul>
<h2><span id="relational-online-analytical-processing-rolap">Relational Online Analytical Processing (ROLAP)</span><a href="#relational-online-analytical-processing-rolap" class="header-anchor">#</a></h2><ul>
<li>Provides OLAP functionality using relational databases and familiar relational tools to store and analyze multidimensional data</li>
<li>Extensions added to traditional RDBMS technology</li>
<li>Multidimensional data schema support within the RDBMS</li>
<li>Data access language and query performance optimized for multidimensional data</li>
<li>Support for very large databases (VLDBs)</li>
</ul>
<h2><span id="multidimensional-online-analytical-processing-molap-pointer-to-pointer-to-formulate-multi-dimensional-database">Multidimensional Online Analytical Processing (MOLAP) pointer to pointer to formulate multi-dimensional database</span><a href="#multidimensional-online-analytical-processing-molap-pointer-to-pointer-to-formulate-multi-dimensional-database" class="header-anchor">#</a></h2><ul>
<li>Extends OLAP functionality to multidimensional database management systems (MDBMSs)</li>
<li><strong>MDBMS</strong>: Uses proprietary techniques store data in matrix-like n-dimensional arrays</li>
<li>End users visualize stored data as a 3D data cube §Grow to n dimensions, becoming hypercubes</li>
<li>Held in memory in a cube cache to speed access</li>
<li><strong>Sparsity</strong>: Measures the density of the data held in the data cube<br><img src="/DatabaseRev/R-M-OLAP.png" alt="R:MOLAP"></li>
</ul>
<h2><span id="sql-extensions-for-olap">SQL Extensions for OLAP</span><a href="#sql-extensions-for-olap" class="header-anchor">#</a></h2><h3><span id="the-rollup-extension-get-upper-domian-data-sorted-by-lower-dimension">The ROLLUP extension(get upper domian data sorted by lower dimension)</span><a href="#the-rollup-extension-get-upper-domian-data-sorted-by-lower-dimension" class="header-anchor">#</a></h3><ul>
<li>Used with GROUP BY clause to generate aggregates by different dimensions</li>
<li>Enables subtotal for each column listed except for the last one, which gets a grand total</li>
<li>Order of column list important</li>
</ul>
<h3><span id="the-cube-extension-only-get-total-by-one-dimension-separately">The CUBE extension(only get total by one dimension separately)</span><a href="#the-cube-extension-only-get-total-by-one-dimension-separately" class="header-anchor">#</a></h3><ul>
<li>Used with GROUP BY clause to generate aggregates by the listed columns</li>
<li>Includes the last column</li>
</ul>
<h2><span id="data-lake">Data lake</span><a href="#data-lake" class="header-anchor">#</a></h2><ul>
<li>A traditional data warehouse is an ETL-based, historical record of transactions - very RDB-like</li>
<li>A ‘modern’ alternative is a ‘data lake’, which offers a more continuous form of analytics, driven by the rise of unstructed data, streaming, cloud storage, etc. In a data lake, data is NOT ETLd, rather, it is stored in its ‘raw’ (“natural”) form [even incomplete, untransformed…].</li>
</ul>
<h1><span id="discussion1">Discussion1</span><a href="#discussion1" class="header-anchor">#</a></h1><ul>
<li>Data - origins?<ul>
<li>copper</li>
<li>parchment</li>
<li>leaves</li>
<li>stone</li>
</ul>
</li>
<li>Data - tech?<ul>
<li>hologram</li>
<li>…</li>
</ul>
</li>
<li>Data vs info vs knowledge<ul>
<li>info is by Searching sorting … calculation - computation of data(collected from somewhere) |exact information</li>
<li>knowledge is useful information</li>
</ul>
</li>
<li>Modeling<ul>
<li>Why? leave the part I dont want (abstraction) features!</li>
</ul>
</li>
<li>Relational -&gt; relating different entity</li>
<li>Another example of a ‘unary’ relationship? (employee table manager)</li>
<li>Another example of a ternary relationship? (manufactory)</li>
<li>Instead of TinyCollege, consider USC - more entities?</li>
<li>Why is full functional dependence a good thing?</li>
<li>Diff between entity and referential integrity, in terms of…</li>
<li>Examples of ‘blind’ (non-identifying) keys in RL?</li>
<li>How can we use tables to model unary relationships?<ul>
<li>one the same table a column called manager column -&gt; point to itself’s employee_id -&gt; drawback if many people donot have manager, it would be sparse column</li>
<li>use two tables -&gt; make a table called manager_employee which only has two cols (employee1, employee2) em1 -&gt; employeers, em2-&gt; managers</li>
</ul>
</li>
<li>Closure - where else?</li>
<li>Why is closure a good property?</li>
<li>Set diff is non-commutative - what else is?</li>
<li>What is the conceptual shift, from a ‘spreadsheet DB’ to a relational one?</li>
</ul>
<h1><span id="discussion-2">Discussion 2</span><a href="#discussion-2" class="header-anchor">#</a></h1><ul>
<li><p>SQL: ____ Oriented Programming - what? What else?</p>
<ul>
<li>imperative programming: use for loop to accomplish the same goal. SQL is not but java c c++ is</li>
<li>Object Oriented -&gt; take data and method of data package them together</li>
<li>Functional programming language: put function as input in and get function out as output. SQL is functional oriented</li>
<li><ul>
<li>Function oriented programming language</li>
</ul>
</li>
<li><ul>
<li>Set oriented language -&gt; SQL engine figuer out how to do 21:46</li>
</ul>
</li>
<li><ul>
<li>Declearative … tell what u want fine control</li>
</ul>
</li>
<li>Aspect oriented programming -&gt; AOP<ul>
<li>aspect means some tasks a program need to do. draw, email, send to printer</li>
<li>get all the task classes together and make an internface</li>
<li>if we implement the interface called aspect</li>
<li>SQL is also domain specific language DSL</li>
</ul>
</li>
</ul>
</li>
<li><p>Pattern matching - <a target="_blank" rel="noopener" href="https://www.rexegg.com/regex-quickstart.html">https://www.rexegg.com/regex-quickstart.html</a> _-&gt; single word % -&gt; more than one word</p>
</li>
<li><p>More datatypes?</p>
<ul>
<li>Color type</li>
<li>currency type</li>
</ul>
</li>
<li><p>Breaking closure -&gt; It cannot chain further stop chaining operation</p>
</li>
<li><p>RL(real life) situations (not DB) where transactions are done sequentially?</p>
<ul>
<li>dating cannot date with many peoples</li>
</ul>
</li>
<li><p>Robert rules room how to make sure everybody get a chance to speak</p>
</li>
<li><p>DB cases in RL where interleaving in inevitable?</p>
<ul>
<li>travel book ticket</li>
<li>buy books from amazon</li>
<li>Linkedin Job</li>
</ul>
</li>
<li><p>Database state, during lost updates vs inconsistent analysis?</p>
<ul>
<li>lost updates -&gt; t2 override t1’s modification -&gt; data destroy&#x2F; table is not always fine.</li>
<li>inconsistent analysis -&gt; nonrepeatable read -&gt; integrate of table not harm. table not change the datastructure.</li>
</ul>
</li>
<li><p>Serial schedule - how many exist, for n serializable transactions?</p>
<ul>
<li>rearrange many transactions very important</li>
<li>transaction isolation level -&gt; 4 levels for example, allow dirty read allow nonrepeatable read …<ul>
<li>avoid dirty read</li>
<li>avoid nonrepeatable read</li>
<li>avoid phantom read</li>
</ul>
</li>
</ul>
</li>
<li><p>Why not make all schedules serial? -&gt; consider performance</p>
</li>
<li><p>2PL(Static&#x2F;Conservative) vs Strict 2PL(“S2PL”){hold on some writes and release all the reads, release read lock } vs Rigorous(Stricter&#x2F;StrongStrict&#x2F;SS2PL!)(hold on all the lock until commit complete)</p>
</li>
<li><p>Newton and his 2 cats</p>
</li>
<li><p>Replication - three reasons?</p>
<ul>
<li>failure reasons</li>
<li>network-balancing</li>
<li></li>
</ul>
</li>
<li><p>Replication tradeoffs with consistency? -&gt; amazon</p>
</li>
<li><p>2PC - failure, how? rollback hang</p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Jiaming Xu</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":"enable","tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
